{
  "url": "https://api.github.com/repos/facebook/react/issues/3037",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/3037/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/3037/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/3037/events",
  "html_url": "https://github.com/facebook/react/issues/3037",
  "id": 56504510,
  "node_id": "MDU6SXNzdWU1NjUwNDUxMA==",
  "number": 3037,
  "title": "React doesn't eval on Java 8 Nashorn JavaScript Engine",
  "user": {
    "login": "winterbe",
    "id": 485033,
    "node_id": "MDQ6VXNlcjQ4NTAzMw==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/485033?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/winterbe",
    "html_url": "https://github.com/winterbe",
    "followers_url": "https://api.github.com/users/winterbe/followers",
    "following_url": "https://api.github.com/users/winterbe/following{/other_user}",
    "gists_url": "https://api.github.com/users/winterbe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/winterbe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/winterbe/subscriptions",
    "organizations_url": "https://api.github.com/users/winterbe/orgs",
    "repos_url": "https://api.github.com/users/winterbe/repos",
    "events_url": "https://api.github.com/users/winterbe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/winterbe/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2015-02-04T09:44:41Z",
  "updated_at": "2016-11-18T15:51:53Z",
  "closed_at": "2015-02-26T23:37:54Z",
  "author_association": "NONE",
  "body": "Nashorn is the new JavaScript Engine shipped with Java 8. Nashorn compiles JavaScript to Java Bytecode, so it runs natively on the JVM.\n\nUnfortunately React doesn't evaluate properly on Nashorn due to the fact that Nashorn doesn't support any kind of module system like AMD out of the box.\n\nThis code creates a new nashorn engine and evaluates React on the JVM:\n\n``` java\nScriptEngine nashorn = new ScriptEngineManager().getEngineByName(\"nashorn\");\nnashorn.eval(\"load('https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.js')\");\n```\n\nRunning the above code results in the following error:\n\n```\nCaused by: https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.js:4 TypeError: Cannot set property \"React\" of undefined\n    at jdk.nashorn.internal.runtime.ECMAErrors.error(ECMAErrors.java:58)\n    at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:214)\n    at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:186)\n    at jdk.nashorn.internal.runtime.ECMAErrors.typeError(ECMAErrors.java:173)\n    at jdk.nashorn.internal.runtime.Undefined.lookupTypeError(Undefined.java:128)\n    at jdk.nashorn.internal.runtime.Undefined.lookup(Undefined.java:119)\n    at jdk.nashorn.internal.runtime.linker.NashornLinker.getGuardedInvocation(NashornLinker.java:98)\n    at jdk.internal.dynalink.support.CompositeTypeBasedGuardingDynamicLinker.getGuardedInvocation(CompositeTypeBasedGuardingDynamicLinker.java:176)\n    at jdk.internal.dynalink.support.CompositeGuardingDynamicLinker.getGuardedInvocation(CompositeGuardingDynamicLinker.java:124)\n    at jdk.internal.dynalink.support.LinkerServicesImpl.getGuardedInvocation(LinkerServicesImpl.java:144)\n    at jdk.internal.dynalink.DynamicLinker.relink(DynamicLinker.java:232)\n    at jdk.nashorn.internal.scripts.Script$react.L:4(https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.js:4)\n    at jdk.nashorn.internal.scripts.Script$react.runScript(https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.js:4)\n    at jdk.nashorn.internal.runtime.ScriptFunctionData.invoke(ScriptFunctionData.java:535)\n    at jdk.nashorn.internal.runtime.ScriptFunction.invoke(ScriptFunction.java:209)\n    at jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:378)\n    at jdk.nashorn.internal.runtime.Context.evaluateSource(Context.java:983)\n    at jdk.nashorn.internal.runtime.Context.load(Context.java:680)\n    at jdk.nashorn.internal.objects.Global.load(Global.java:877)\n    at jdk.nashorn.internal.scripts.Script$\\^eval\\_.runScript(<eval>:1)\n    at jdk.nashorn.internal.runtime.ScriptFunctionData.invoke(ScriptFunctionData.java:535)\n    at jdk.nashorn.internal.runtime.ScriptFunction.invoke(ScriptFunction.java:209)\n    at jdk.nashorn.internal.runtime.ScriptRuntime.apply(ScriptRuntime.java:378)\n    at jdk.nashorn.api.scripting.NashornScriptEngine.evalImpl(NashornScriptEngine.java:568)\n    ... 34 more\n```\n\nSimple workaround is to create a variable `window` referencing the the global context `this`:\n\n``` java\nScriptEngine nashorn = new ScriptEngineManager().getEngineByName(\"nashorn\");\nnashorn.eval(\"var window = this;\");     // workaround\nnashorn.eval(\"load('https://cdnjs.cloudflare.com/ajax/libs/react/0.12.2/react.js')\");\n```\n\nBTW: Here's a fully working isomorphic java example of your CommentBox tutorial: \n\nhttps://github.com/winterbe/spring-react-example\n\nThe CommentBox is initially rendered on the server with Nashorn.\n",
  "closed_by": {
    "login": "sophiebits",
    "id": 6820,
    "node_id": "MDQ6VXNlcjY4MjA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6820?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sophiebits",
    "html_url": "https://github.com/sophiebits",
    "followers_url": "https://api.github.com/users/sophiebits/followers",
    "following_url": "https://api.github.com/users/sophiebits/following{/other_user}",
    "gists_url": "https://api.github.com/users/sophiebits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sophiebits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sophiebits/subscriptions",
    "organizations_url": "https://api.github.com/users/sophiebits/orgs",
    "repos_url": "https://api.github.com/users/sophiebits/repos",
    "events_url": "https://api.github.com/users/sophiebits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sophiebits/received_events",
    "type": "User",
    "site_admin": false
  }
}

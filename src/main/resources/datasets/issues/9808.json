{
  "url": "https://api.github.com/repos/facebook/react/issues/9808",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/9808/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/9808/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/9808/events",
  "html_url": "https://github.com/facebook/react/issues/9808",
  "id": 232044630,
  "node_id": "MDU6SXNzdWUyMzIwNDQ2MzA=",
  "number": 9808,
  "title": "Problem with unstable_renderSubtreeIntoContainer and refs",
  "user": {
    "login": "cassln",
    "id": 5557300,
    "node_id": "MDQ6VXNlcjU1NTczMDA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/5557300?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cassln",
    "html_url": "https://github.com/cassln",
    "followers_url": "https://api.github.com/users/cassln/followers",
    "following_url": "https://api.github.com/users/cassln/following{/other_user}",
    "gists_url": "https://api.github.com/users/cassln/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cassln/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cassln/subscriptions",
    "organizations_url": "https://api.github.com/users/cassln/orgs",
    "repos_url": "https://api.github.com/users/cassln/repos",
    "events_url": "https://api.github.com/users/cassln/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cassln/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2017-05-29T14:57:29Z",
  "updated_at": "2017-06-21T23:31:13Z",
  "closed_at": "2017-06-13T11:23:03Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\nReport a bug.\r\n\r\n**What is the current behavior?**\r\nI use the usual technique of portals with unstable_renderSubtreeIntoContainer. Also I need to control portal children with `refs` (using legacy syntax I know).\r\n\r\nThe problem is `unstable_renderSubtreeIntoContainer` is async and can be called after `componentDidUpdate`. When refs are used in `componentDidUpdate`, they can be undefined due to async nature of `unstable_renderSubtreeIntoContainer`.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem via https://jsfiddle.net or similar (template: https://jsfiddle.net/84v837e9/).**\r\n[Demo](https://jsfiddle.net/cassln/cusus029/2/). Open the browser console and press \"add\" button. You will got this error:\r\n```\r\nUncaught TypeError: Cannot read property 'getBoundingClientRect' of undefined\r\n    at App.componentDidUpdate (<anonymous>:33:64)\r\n    at measureLifeCyclePerf (react-dom.js:4581)\r\n    at react-dom.js:5235\r\n    at CallbackQueue.notifyAll (react-dom.js:948)\r\n    at ReactReconcileTransaction.close (react-dom.js:11454)\r\n    at ReactReconcileTransaction.closeAll (react-dom.js:14882)\r\n    at ReactReconcileTransaction.perform (react-dom.js:14829)\r\n    at ReactUpdatesFlushTransaction.perform (react-dom.js:14816)\r\n    at ReactUpdatesFlushTransaction.perform (react-dom.js:12936)\r\n    at Object.flushBatchedUpdates (react-dom.js:13019)\r\n```\r\nIt causes because of, according to logs\r\n```\r\ncomponentDidUpdate\r\ncomplete unstable_renderSubtreeIntoContainer\r\n```\r\n`componentDidUpdate` called before `unstable_renderSubtreeIntoContainer` callback.\r\n\r\n**What is the expected behavior?**\r\nAre needed defined `refs` in `componentDidUpdate`. In the general case, a completely completed render.\r\n\r\nI know about pattern with using `unstable_renderSubtreeIntoContainer` callback, but this is not preferred solution. Because of I have quite complex combination of two libraries and don't have access to `unstable_renderSubtreeIntoContainer` callback. If someone is interested in libs, this is [react-autocomplete](https://github.com/reactjs/react-autocomplete) and [react-tether](https://github.com/souporserious/react-tether).\r\n\r\nThere may be a way with avoiding rerender and saving the refs from the first render?\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\nI'm using v15.4.2.\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

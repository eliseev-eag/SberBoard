{
  "url": "https://api.github.com/repos/facebook/react/issues/14265",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14265/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14265/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14265/events",
  "html_url": "https://github.com/facebook/react/pull/14265",
  "id": 381955761,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjMxNzg1Mzg0",
  "number": 14265,
  "title": "Update escaping of attribute and text HTML characters in SSR",
  "user": {
    "login": "trueadm",
    "id": 1519870,
    "node_id": "MDQ6VXNlcjE1MTk4NzA=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/1519870?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/trueadm",
    "html_url": "https://github.com/trueadm",
    "followers_url": "https://api.github.com/users/trueadm/followers",
    "following_url": "https://api.github.com/users/trueadm/following{/other_user}",
    "gists_url": "https://api.github.com/users/trueadm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/trueadm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/trueadm/subscriptions",
    "organizations_url": "https://api.github.com/users/trueadm/orgs",
    "repos_url": "https://api.github.com/users/trueadm/repos",
    "events_url": "https://api.github.com/users/trueadm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/trueadm/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-11-18T12:30:50Z",
  "updated_at": "2019-06-12T08:51:59Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/14265",
    "html_url": "https://github.com/facebook/react/pull/14265",
    "diff_url": "https://github.com/facebook/react/pull/14265.diff",
    "patch_url": "https://github.com/facebook/react/pull/14265.patch"
  },
  "body": "I noticed when profiling parts of ReactDOM, I noticed that the escaping of HTML characters in SSR was particularly slow. Looking into it more, I changed the implementation to a much faster one that uses `String.prototype.indexOf` rather than RegEx (`indexOf` was faster in Chrome/Firefox and Safari) and also opted to use a similar implementation to other libraries when it comes to the escaping of characters. I then noticed something interesting: we are escaping characters that no longer need to be escaped.\r\n\r\nFor DOM node attributes, we don't need to escape single quotes or left/right angle brackets. You can try this out yourself in all the different browsers (I never tested IE8). For text nodes, you don't need to escape single or double quotes, again this can be validated in all browsers using the DOM API. You can see for yourself below:\r\n\r\n```js\r\nvar x = document.createElement('div');\r\nx.textContent = `'\"><&`;\r\nconsole.log(x.outerHTML);\r\n\r\nvar y = document.createElement('div');\r\ny.setAttribute(\"foo\", `'\"><&`);\r\nconsole.log(y.outerHTML);\r\n```\r\n\r\nNot only does this improve SSR render performance it also improves hydration when checking if the text nodes have changed, as before we'd mismatch in far more cases where there was a difference in the diffing due to escaped characters of a text node value not matching that of what React derives.\r\n\r\nThe difference in SSR rendering before (this is using the `hacker-news` benchmark in `scripts`):\r\n\r\n```\r\n// Before:\r\nhacker-news 17.2ms\r\n// After:\r\nhacker-news 14.4ms\r\n```\r\n\r\nUsing the `color-picker` benchmark from Marko:\r\n\r\n```\r\n// Before:\r\nreact x 6,857 ops/sec ±0.73% (94 runs sampled)\r\n// After:\r\nreact x 7,485 ops/sec ±0.44% (93 runs sampled)\r\n```",
  "closed_by": null
}

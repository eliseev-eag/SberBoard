{
  "url": "https://api.github.com/repos/facebook/react/issues/12781",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/12781/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/12781/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/12781/events",
  "html_url": "https://github.com/facebook/react/issues/12781",
  "id": 322184943,
  "node_id": "MDU6SXNzdWUzMjIxODQ5NDM=",
  "number": 12781,
  "title": "The strange lifecycle of  forwardRef children",
  "user": {
    "login": "xiaoshuangLi",
    "id": 12060054,
    "node_id": "MDQ6VXNlcjEyMDYwMDU0",
    "avatar_url": "https://avatars3.githubusercontent.com/u/12060054?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/xiaoshuangLi",
    "html_url": "https://github.com/xiaoshuangLi",
    "followers_url": "https://api.github.com/users/xiaoshuangLi/followers",
    "following_url": "https://api.github.com/users/xiaoshuangLi/following{/other_user}",
    "gists_url": "https://api.github.com/users/xiaoshuangLi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/xiaoshuangLi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xiaoshuangLi/subscriptions",
    "organizations_url": "https://api.github.com/users/xiaoshuangLi/orgs",
    "repos_url": "https://api.github.com/users/xiaoshuangLi/repos",
    "events_url": "https://api.github.com/users/xiaoshuangLi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/xiaoshuangLi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-05-11T06:40:57Z",
  "updated_at": "2018-05-11T14:02:39Z",
  "closed_at": "2018-05-11T14:02:39Z",
  "author_association": "NONE",
  "body": "**Do you want to request a feature or report a bug?**\r\n\r\nbug\r\n\r\n**Demo code**\r\n\r\n```jsx\r\nimport React, { Component, forwardRef } from 'react';\r\n\r\nclass Inp extends Component {\r\n  state = { value: '' }\r\n\r\n  static getDerivedStateFromProps(nextProps, prevState) {\r\n    console.log('3 --- receive props');\r\n    return {\r\n      value: nextProps.value,\r\n    };\r\n  }\r\n\r\n  onChange = (e) => {\r\n    console.log('1 --- onChange');\r\n    this.setState({\r\n      value: e.target.value,\r\n    }, () => {\r\n      console.log('2 --- after setState');\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const { value, onChange, ...others } = this.props;\r\n\r\n    return (\r\n      <input type=\"text\" value={this.state.value} onChange={this.onChange} {...others} />\r\n    );\r\n  }\r\n}\r\n\r\n\r\nconst InpWithRef = forwardRef((props, ref) => (\r\n  <Inp ref={ref} {...props} />\r\n));\r\n\r\n\r\nclass Test extends Component {\r\n  render() {\r\n    return (\r\n      <InpWithRef />\r\n    );\r\n  }\r\n}\r\n\r\n```\r\n\r\n**What is the current behavior?**\r\n\r\nWhen I type something in the ```Input```, will trigger ```onChange``` => ```setState``` => ```getDerivedStateFromProps``` => ```the callback of setState```.You can see it in the console.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nHere is a [demo](https://codepen.io/xiaoshuang/pen/OZZLVG?editors=0010).\r\n\r\n**What is the expected behavior?**\r\n\r\nThe expected behavior: ```onChange``` => ```setState``` => ```the callback of setState``` => ```getDerivedStateFromProps```\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\n```\r\nreact: 16.3.2,\r\nreacr-dom: 16.3.1,\r\n```",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/6067",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/6067/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/6067/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/6067/events",
  "html_url": "https://github.com/facebook/react/issues/6067",
  "id": 134696906,
  "node_id": "MDU6SXNzdWUxMzQ2OTY5MDY=",
  "number": 6067,
  "title": "Proposal: componentWillPrepareUnmount (continueCallback)",
  "user": {
    "login": "ksandin",
    "id": 805006,
    "node_id": "MDQ6VXNlcjgwNTAwNg==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/805006?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ksandin",
    "html_url": "https://github.com/ksandin",
    "followers_url": "https://api.github.com/users/ksandin/followers",
    "following_url": "https://api.github.com/users/ksandin/following{/other_user}",
    "gists_url": "https://api.github.com/users/ksandin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ksandin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ksandin/subscriptions",
    "organizations_url": "https://api.github.com/users/ksandin/orgs",
    "repos_url": "https://api.github.com/users/ksandin/repos",
    "events_url": "https://api.github.com/users/ksandin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ksandin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2016-02-18T21:06:56Z",
  "updated_at": "2016-02-24T20:04:54Z",
  "closed_at": "2016-02-24T20:04:54Z",
  "author_association": "NONE",
  "body": "_EDIT: After discussion in this thread I've amended `componentWillRemount` to the proposal._\n\nI've been working a lot with animations in combination with react lately and while most lifecycle methods make transitions on components a walk in the park, I've struggled to get the scenario of unmounting a pleasant experience. In the end though I've come up with a lifecycle method proposal that could be incredibly powerful: `componentWillPrepareUnmount (continueCallback)` and `componentWillRemount`.\n\nWhat they would do, when declared on a component, is to delay the actual unmount just as if nothing happened, until the component itself calls the provided callback, which then would resume the actual unmounting. If a component in a pending unmount state is restored before the actual unmount takes place, the unmount is canceled and the component treats the change as a regular update (`componentWillUpdate` fires, etc), with the addition of `componentWillRemount` being called to give you the chance to react specifically to this event.\n\n> Edge case mitigation: Ancestors override descendants. If an ancestor of a component using \"unmount preparation\" unmounts the descendant unmounts instantly without preparation, unless the ancestor also utilizes `componentWillPrepareUnmount`, which would give it some arbitrary time to prepare.\n\nThis would allow us to gracefully perform an animation on our components right before they're really unmounted, letting component specific code decide how it should disappear.\n\nFor example:\n\n``` javascript\nvar styles = {\n    // .. some styling\n};\n\nvar tweenOptions = {\n    // .. some tween options\n};\n\n/**\n * A menu item that fades in and scales up on mount \n * and then fades out and scales down on unmount.\n */\nclass MenuItem extends React.Component {\n    componentWillMount () {\n        this.tweens = {\n            opacity: new Tween(0, tweenOptions),\n            scaleY: new Tween(0, tweenOptions)\n        };\n        this.animateShow();\n    }\n\n    componentWillPrepareUnmount (continueCallback) {\n        Promise.all([\n            this.tweens.opacity.to(0),\n            this.tweens.scaleY.to(0)\n        ]).then(continueCallback);\n    }\n\n    componentWillRemount () {\n        this.animateShow();\n    }\n\n    animateShow () {\n        this.tweens.opacity.to(1);\n        this.tweens.scaleY.to(1);\n    }\n\n    render () {\n        return (\n            <surface style={{...styles, this.tweens}}>\n                {this.props.label}\n            </surface>\n        );\n    }\n}\n```\n\nAnd the usage:\n\n``` javascript\nclass Menu extends React.Component {\n    render () {\n        var itemElements = this.props.items.map((item) => {\n            return <MenuItem key={item.id} label={item.label}/>;\n        });\n        return (\n            <surface style={{flexDirection: \"row\"}}>\n                {itemElements}\n            </surface>\n        );\n    }\n}\n\nMenu.propTypes = {\n    items: React.PropTypes.arrayOf(\n        React.PropTypes.shape({\n            id: React.PropTypes.any,\n            label: React.PropTypes.string\n        })\n    ).isRequired\n};\n```\n\nWhat do you think?\n",
  "closed_by": {
    "login": "jimfb",
    "id": 9595985,
    "node_id": "MDQ6VXNlcjk1OTU5ODU=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/9595985?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jimfb",
    "html_url": "https://github.com/jimfb",
    "followers_url": "https://api.github.com/users/jimfb/followers",
    "following_url": "https://api.github.com/users/jimfb/following{/other_user}",
    "gists_url": "https://api.github.com/users/jimfb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jimfb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jimfb/subscriptions",
    "organizations_url": "https://api.github.com/users/jimfb/orgs",
    "repos_url": "https://api.github.com/users/jimfb/repos",
    "events_url": "https://api.github.com/users/jimfb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jimfb/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/6483",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/6483/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/6483/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/6483/events",
  "html_url": "https://github.com/facebook/react/issues/6483",
  "id": 147387816,
  "node_id": "MDU6SXNzdWUxNDczODc4MTY=",
  "number": 6483,
  "title": "Setting the selection range of a text input only works asynchronously",
  "user": {
    "login": "jchitel",
    "id": 530108,
    "node_id": "MDQ6VXNlcjUzMDEwOA==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/530108?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jchitel",
    "html_url": "https://github.com/jchitel",
    "followers_url": "https://api.github.com/users/jchitel/followers",
    "following_url": "https://api.github.com/users/jchitel/following{/other_user}",
    "gists_url": "https://api.github.com/users/jchitel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jchitel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jchitel/subscriptions",
    "organizations_url": "https://api.github.com/users/jchitel/orgs",
    "repos_url": "https://api.github.com/users/jchitel/repos",
    "events_url": "https://api.github.com/users/jchitel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jchitel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 155984160,
      "node_id": "MDU6TGFiZWwxNTU5ODQxNjA=",
      "url": "https://api.github.com/repos/facebook/react/labels/Status:%20Unconfirmed",
      "name": "Status: Unconfirmed",
      "color": "d4c5f9",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2016-04-11T10:45:22Z",
  "updated_at": "2016-04-16T03:47:16Z",
  "closed_at": "2016-04-16T03:47:16Z",
  "author_association": "NONE",
  "body": "Hello,\n\nI'm trying to implement a text field and have fine control over its behavior. The state of a text field includes its value and the selection range, so I pass those in as properties. The selection range isn't exposed as an HTML attribute of a text input, but you can set it using the underlying DOM element object. I can get that value using the \"ref\" attribute, and set it in `componentDidUpdate()`, like so (note that I'm using [Elemental UI's FormInput component](https://github.com/elementalui/elemental/blob/master/src/components/FormInput.js), which is just a wrapper around a regular input):\n\n``` javascript\nimport React from 'react';\nimport { FormInput } from 'elemental';\n\nexport default class FineControlTextField extends React.Component {\n    static propTypes = {\n        value: React.PropTypes.string.isRequired,\n        onKeyPress: React.PropTypes.func.isRequired,\n        selection: React.PropTypes.object.isRequired,\n    };\n\n    componentDidUpdate() {\n        setTimeout(() => {\n            this.input.setSelectionRange(this.props.selection.start, this.props.selection.end);\n        }, 0);\n    }\n\n    render() {\n        const props = {\n            type: 'text',\n            value: this.props.value,\n            onKeyDown: this.props.onKeyPress,\n            onKeyPress: (e) => { e.stopPropagation(); e.preventDefault(); },\n            onKeyUp: (e) => { e.stopPropagation(); e.preventDefault(); },\n            ref: (ref) => this.input = ref && ref.refs.input,\n        };\n\n        return (<FormInput {...props} />);\n    }\n}\n```\n- I'm using Redux, so all properties you see are coming from the Redux store.\n- I don't actually change the selection yet, so the value is always `{ start: 0, end: 0 }`. Thus, I should expect the cursor to sit at the start of the field and not move.\n- At the moment, the `onKeyPress` function passed into the component just dispatches a Redux action that adds an 'a' to the end of the text. It also calls `stopPropagation` and `preventDefault` because I thought those might help me, but they didn't.\n\nYou'll notice that I had to put the `this.input.setSelectionRange()` in a `setTimeout`. If I don't do this, the call does nothing. However, this isn't a complete solution because the cursor gets moved to the end of the input regardless, so when I press keys, the cursor moves to the end of the input, then my selection gets called and the cursor quickly moves back to the beginning. Since it works asynchronously, I can deduce that React likely sets the selection range itself after `componentDidUpdate()` is called.\n\nIs there any way that I can have more control over this behavior? This isn't a common use case so I can understand that there isn't an exposed API for setting the selection range. But is there some workaround or something I'm not aware of that I need to do to get this to work?\n",
  "closed_by": {
    "login": "jimfb",
    "id": 9595985,
    "node_id": "MDQ6VXNlcjk1OTU5ODU=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/9595985?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jimfb",
    "html_url": "https://github.com/jimfb",
    "followers_url": "https://api.github.com/users/jimfb/followers",
    "following_url": "https://api.github.com/users/jimfb/following{/other_user}",
    "gists_url": "https://api.github.com/users/jimfb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jimfb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jimfb/subscriptions",
    "organizations_url": "https://api.github.com/users/jimfb/orgs",
    "repos_url": "https://api.github.com/users/jimfb/repos",
    "events_url": "https://api.github.com/users/jimfb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jimfb/received_events",
    "type": "User",
    "site_admin": false
  }
}

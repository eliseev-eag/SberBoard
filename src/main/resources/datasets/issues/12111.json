{
  "url": "https://api.github.com/repos/facebook/react/issues/12111",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/12111/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/12111/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/12111/events",
  "html_url": "https://github.com/facebook/react/issues/12111",
  "id": 292405519,
  "node_id": "MDU6SXNzdWUyOTI0MDU1MTk=",
  "number": 12111,
  "title": "Document the use of setState in componentWillUnmount",
  "user": {
    "login": "pronebird",
    "id": 704044,
    "node_id": "MDQ6VXNlcjcwNDA0NA==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/704044?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pronebird",
    "html_url": "https://github.com/pronebird",
    "followers_url": "https://api.github.com/users/pronebird/followers",
    "following_url": "https://api.github.com/users/pronebird/following{/other_user}",
    "gists_url": "https://api.github.com/users/pronebird/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pronebird/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pronebird/subscriptions",
    "organizations_url": "https://api.github.com/users/pronebird/orgs",
    "repos_url": "https://api.github.com/users/pronebird/repos",
    "events_url": "https://api.github.com/users/pronebird/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pronebird/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 40929155,
      "node_id": "MDU6TGFiZWw0MDkyOTE1NQ==",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Question",
      "name": "Type: Question",
      "color": "cc317c",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2018-01-29T13:25:26Z",
  "updated_at": "2018-08-13T08:59:26Z",
  "closed_at": "2018-01-29T15:10:02Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\n\r\nFeature\r\n\r\n**What is the current behavior?**\r\n\r\nExcerpt from documentation:\r\n\r\n>componentWillUnmount() is invoked immediately before a component is unmounted and destroyed. Perform any necessary cleanup in this method, such as invalidating timers, canceling network requests, or cleaning up any subscriptions that were created in componentDidMount().\r\n\r\nhttps://reactjs.org/docs/react-component.html\r\n\r\nThe docs don't mention if `setState` can be used in `componentWillUnmount`. \r\n\r\nConsider the following example where the `state.showGreeting` is undone by timer over time. But since the timer has to be invalidated in `componentWillUnmount` there no other place to reset the state:\r\n\r\n```\r\nclass HelloWorld extends Component {\r\n  state = {\r\n    showGreeting: false\r\n  };\r\n\r\n  onClick() {\r\n    this.setState({ showGreeting: true })\r\n\r\n    this._timer = setTimeout(() => this.setState({ showGreeting: false }), 3000)\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    clearTimeout(this._timer)\r\n\r\n    // is it legal?\r\n    this.setState({ showGreeting: false })\r\n  }\r\n}\r\n```\r\n\r\nIs it legal to call `setState` from `componentWillUnmount`? Given that it can be asynchronous it feels that `setState` may not be invoked until after component is actually unmounted which may produce a warning in my understanding, until.. `componentWillUnmount` actually pumps up the state's dispatch queue manually to ensure that all state changes land in component before it's too late.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\n**What is the expected behavior?**\r\n\r\nNot sure\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\n16.2 / Webkit",
  "closed_by": {
    "login": "pronebird",
    "id": 704044,
    "node_id": "MDQ6VXNlcjcwNDA0NA==",
    "avatar_url": "https://avatars2.githubusercontent.com/u/704044?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pronebird",
    "html_url": "https://github.com/pronebird",
    "followers_url": "https://api.github.com/users/pronebird/followers",
    "following_url": "https://api.github.com/users/pronebird/following{/other_user}",
    "gists_url": "https://api.github.com/users/pronebird/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pronebird/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pronebird/subscriptions",
    "organizations_url": "https://api.github.com/users/pronebird/orgs",
    "repos_url": "https://api.github.com/users/pronebird/repos",
    "events_url": "https://api.github.com/users/pronebird/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pronebird/received_events",
    "type": "User",
    "site_admin": false
  }
}

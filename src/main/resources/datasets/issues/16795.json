{
  "url": "https://api.github.com/repos/facebook/react/issues/16795",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/16795/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/16795/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/16795/events",
  "html_url": "https://github.com/facebook/react/pull/16795",
  "id": 494191797,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MzE3OTkzNzc4",
  "number": 16795,
  "title": "Follow-up to initial Trusted Types support",
  "user": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-09-16T17:54:16Z",
  "updated_at": "2019-10-14T16:54:53Z",
  "closed_at": "2019-09-17T15:06:27Z",
  "author_association": "MEMBER",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/16795",
    "html_url": "https://github.com/facebook/react/pull/16795",
    "diff_url": "https://github.com/facebook/react/pull/16795.diff",
    "patch_url": "https://github.com/facebook/react/pull/16795.patch"
  },
  "body": "This addresses a few things I've noticed since merging #16157.\r\n\r\n* At FB we might want the flag to be dynamic while we're experimenting (e.g. depending on the user). We'd like to avoid overhead on every call for people who aren't opted in. So I want to check for TT flag early and branch based on that instead of doing it in `toStringOrTrustedType`.\r\n  - My change sets `toStringOrTrustedType` to `toString` directly, and then adds the TT checks on top when the flag is on. I've inlined `isTrustedTypesValue` into that branch since it wasn't useful by itself.\r\n* I've added a global to Flow to remove the suppressions.\r\n* I'm destructuring `isHTML` and friends early to avoid property access hit in the hot path. I'm assuming `trustedTypes` methods don't care about `this` values. This might make mocking a bit more difficult but IMO this makes sense because we decide early on whether to use them or not. As opposed to TT support potentially \"turning on\" later in the app. This does mean, however, that TT needs to be initialized before ReactDOM to be acknowledged.\r\n* I've revamped the tests so that they actually verify that we pass the TT objects to the DOM sinks. I've checked that replacing every `toStringOrTrustedType` call with `'' + value` now fails a particular test so we're covering them all.\r\n* I've restructured `setInnerHTML` a bit to remove the duplicate `innerHTML` assignment which is easy to accidentally mess up. The special path now has an early return.",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

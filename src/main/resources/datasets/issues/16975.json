{
  "url": "https://api.github.com/repos/facebook/react/issues/16975",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/16975/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/16975/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/16975/events",
  "html_url": "https://github.com/facebook/react/issues/16975",
  "id": 501018473,
  "node_id": "MDU6SXNzdWU1MDEwMTg0NzM=",
  "number": 16975,
  "title": "React functional component is taking snapshot of state at the time of registering handler on websocket",
  "user": {
    "login": "sidvanarse",
    "id": 56041206,
    "node_id": "MDQ6VXNlcjU2MDQxMjA2",
    "avatar_url": "https://avatars0.githubusercontent.com/u/56041206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sidvanarse",
    "html_url": "https://github.com/sidvanarse",
    "followers_url": "https://api.github.com/users/sidvanarse/followers",
    "following_url": "https://api.github.com/users/sidvanarse/following{/other_user}",
    "gists_url": "https://api.github.com/users/sidvanarse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sidvanarse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sidvanarse/subscriptions",
    "organizations_url": "https://api.github.com/users/sidvanarse/orgs",
    "repos_url": "https://api.github.com/users/sidvanarse/repos",
    "events_url": "https://api.github.com/users/sidvanarse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sidvanarse/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-10-01T16:47:54Z",
  "updated_at": "2019-10-01T21:08:40Z",
  "closed_at": "2019-10-01T19:15:23Z",
  "author_association": "NONE",
  "body": "react functional component is taking snapshot of usestate at the time of subscription.\r\n\r\nFor ex. PFB code.\r\n\r\nIf i click setSocketHandler button and then press setWelcomeString button. Now if i receive message over socket when i log welcomestring variable it is empty even thpugh i set it buttonclicked function.\r\n\r\nBut if i click setWelcomeString button first and then click setSocketHandler button. Now if i receive message on socket Welcome is getting logged on console.\r\n\r\nI have seen same behaviour in project so just created this simple app to prove.\r\n\r\nIf i use class component which is commented below.. everything works fine.\r\n\r\nSo my question is why react functional component is working on a state at the time of reg and not on actual state at the time message is received.\r\n\r\nCant we use state variables in functional component in callbacks?\r\n\r\nThis is very weird. How to make it work in functional component correctly.\r\n\r\nPFB code:\r\n\r\n```js\r\nimport React, { useEffect, useState } from \"react\";\r\nimport logo from \"./logo.svg\";\r\nimport \"./App.css\";\r\nconst io = require(\"socket.io-client\");\r\nconst socket = io.connect(\"http://localhost:3000/\");\r\n\r\nconst App: React.FunctionComponent = () => {\r\n  const [welcomeString, setWelcomeString] = useState(\"\");\r\n\r\n  const buttonCliecked = () => {\r\n    console.log(\"clocked button\");\r\n    setWelcomeString(\"Welcome\");\r\n  };\r\n\r\n  const onsockethandlerclicked = () => {\r\n    console.log(\"socket handler clicked\");\r\n    socket.on(\"out\", () => {\r\n      console.log(\"Recived message\");\r\n      console.log(welcomeString);\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <header className=\"component-header\">User Registration</header>\r\n      <label>{welcomeString}</label>\r\n      <button onClick={buttonCliecked}>setWelcomeString</button>\r\n      <button onClick={onsockethandlerclicked}>setSocketHandler</button>\r\n    </div>\r\n  );\r\n};\r\n\r\n/*class App extends React.Component {\r\n\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            welcomeString:\"\"\r\n        }\r\n    }\r\n\r\n\r\n    buttonCliecked = () => {\r\n        console.log(\"clocked button\");\r\n        this.setState({ welcomeString:\"Welcome\"})\r\n    }\r\n\r\n\r\n    onsockethandlerclicked = () => {\r\n        console.log(\"socket handler clicked\");\r\n        socket.on('out', () => {\r\n            console.log(\"Recived message\")\r\n            console.log(this.state.welcomeString);\r\n        });\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <div>\r\n                <header className=\"component-header\">User Registration</header>\r\n                <label>{this.state.welcomeString}</label>\r\n                <button onClick={this.buttonCliecked}>setwelcomestring</button>\r\n                <button onClick={this.onsockethandlerclicked}>setSocketHandler</button>\r\n            </div>\r\n        );\r\n    }\r\n}*/\r\n\r\nexport default App;\r\n```",
  "closed_by": {
    "login": "sidvanarse",
    "id": 56041206,
    "node_id": "MDQ6VXNlcjU2MDQxMjA2",
    "avatar_url": "https://avatars0.githubusercontent.com/u/56041206?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sidvanarse",
    "html_url": "https://github.com/sidvanarse",
    "followers_url": "https://api.github.com/users/sidvanarse/followers",
    "following_url": "https://api.github.com/users/sidvanarse/following{/other_user}",
    "gists_url": "https://api.github.com/users/sidvanarse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sidvanarse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sidvanarse/subscriptions",
    "organizations_url": "https://api.github.com/users/sidvanarse/orgs",
    "repos_url": "https://api.github.com/users/sidvanarse/repos",
    "events_url": "https://api.github.com/users/sidvanarse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sidvanarse/received_events",
    "type": "User",
    "site_admin": false
  }
}

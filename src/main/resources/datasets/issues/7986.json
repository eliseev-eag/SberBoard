{
  "url": "https://api.github.com/repos/facebook/react/issues/7986",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/7986/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/7986/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/7986/events",
  "html_url": "https://github.com/facebook/react/issues/7986",
  "id": 183233850,
  "node_id": "MDU6SXNzdWUxODMyMzM4NTA=",
  "number": 7986,
  "title": "Event listeners stop working if container moved to new document",
  "user": {
    "login": "robertknight",
    "id": 2458,
    "node_id": "MDQ6VXNlcjI0NTg=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/2458?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/robertknight",
    "html_url": "https://github.com/robertknight",
    "followers_url": "https://api.github.com/users/robertknight/followers",
    "following_url": "https://api.github.com/users/robertknight/following{/other_user}",
    "gists_url": "https://api.github.com/users/robertknight/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/robertknight/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/robertknight/subscriptions",
    "organizations_url": "https://api.github.com/users/robertknight/orgs",
    "repos_url": "https://api.github.com/users/robertknight/repos",
    "events_url": "https://api.github.com/users/robertknight/events{/privacy}",
    "received_events_url": "https://api.github.com/users/robertknight/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2016-10-15T21:24:19Z",
  "updated_at": "2017-11-09T06:29:32Z",
  "closed_at": "2017-10-04T13:58:13Z",
  "author_association": "CONTRIBUTOR",
  "body": "**Do you want to request a _feature_ or report a _bug_?**\n\nReport a bug\n\n**What is the current behavior?**\n\nIn React >= v15.0.0, if a container is moved to a different document and then the component tree is re-rendered, event listeners stop working.\n\nIn React <= 0.14.8 it was possible to move a container from one document to another via `document.adoptNode` and have the state of rendered components preserved and event listeners continued to work.\n\n**Steps to reproduce**\n\nUsing test.html from https://gist.github.com/robertknight/a676fb552e8a8b4605e22fb7e4d54364\n1. Click the counter button a few times\n2. Click the 'Move to iframe' button\n3. Click the counter a few more times. Note that the counter no longer responds to clicks.\n\n**What is the expected behavior?**\n\nClicking the counter continues to increment it after it is moved to the iframe. This works in React v0.14.8 but not React >= v15.0.0\n\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\n\nIssue bisects to https://github.com/facebook/react/commit/796f8c353c2a68104672c61ec2cee457bf2de490 , which changed the logic that adds event listeners to use the cached Document value in  `instance._nativeContainerInfo._ownerDocument` instead of `container.ownerDocument`.\n\nThis hack resolves the issue:\n\n``` patch\ndiff --git a/src/renderers/dom/shared/ReactDOMContainerInfo.js b/src/renderers/dom/shared/ReactDOMContainerInfo.js\nindex cbee0b5..16933fd 100644\n--- a/src/renderers/dom/shared/ReactDOMContainerInfo.js\n+++ b/src/renderers/dom/shared/ReactDOMContainerInfo.js\n@@ -17,7 +17,9 @@ var DOC_NODE_TYPE = 9;\n\n function ReactDOMContainerInfo(node) {\n   var info = {\n-    _ownerDocument: node.nodeType === DOC_NODE_TYPE ? node : node.ownerDocument,\n+    get _ownerDocument() {\n+      return node.nodeType === DOC_NODE_TYPE ? node : node.ownerDocument;\n+    },\n     _tag: node.nodeName.toLowerCase(),\n     _namespaceURI: node.namespaceURI,\n   };\n```\n\n**Notes**\n\nThe original use case was preserving the state of components in an app that runs in a Chrome popup window when the pop closes, which unloads the window. The workaround involves moving the DOM node to the background page when the popup is closed and back again when it is next opened.\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

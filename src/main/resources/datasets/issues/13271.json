{
  "url": "https://api.github.com/repos/facebook/react/issues/13271",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/13271/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/13271/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/13271/events",
  "html_url": "https://github.com/facebook/react/pull/13271",
  "id": 344635440,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjAzOTg1Mzk4",
  "number": 13271,
  "title": "Add continued callbacks to scheduler",
  "user": {
    "login": "flarnie",
    "id": 1114467,
    "node_id": "MDQ6VXNlcjExMTQ0Njc=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1114467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/flarnie",
    "html_url": "https://github.com/flarnie",
    "followers_url": "https://api.github.com/users/flarnie/followers",
    "following_url": "https://api.github.com/users/flarnie/following{/other_user}",
    "gists_url": "https://api.github.com/users/flarnie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/flarnie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/flarnie/subscriptions",
    "organizations_url": "https://api.github.com/users/flarnie/orgs",
    "repos_url": "https://api.github.com/users/flarnie/repos",
    "events_url": "https://api.github.com/users/flarnie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/flarnie/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2018-07-25T22:54:19Z",
  "updated_at": "2018-07-31T02:03:47Z",
  "closed_at": "2018-07-31T00:09:12Z",
  "author_association": "CONTRIBUTOR",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/13271",
    "html_url": "https://github.com/facebook/react/pull/13271",
    "diff_url": "https://github.com/facebook/react/pull/13271.diff",
    "patch_url": "https://github.com/facebook/react/pull/13271.patch"
  },
  "body": "**Problem:**\r\n\r\nWe want to use JS Scheduler to coordinate non-React JS with React, so that we don't get low priority background JS work blocking a React render, like so - \r\n<img width=\"557\" alt=\"screen shot 2018-07-25 at 1 17 30 pm\" src=\"https://user-images.githubusercontent.com/1114467/43231438-3d5b9ee6-9021-11e8-8f54-365b3a09c973.png\">\r\n\r\nRight now, even if the \"lazy load JS\" callback calls 'scheduleWork', it will only get pushed forward one frame, and could still run before React finishes high priority render work. The current implementation just does a naive FIFO ordering unless a callback reaches it's expiration time.\r\n\r\nWe want React's callback to keep getting run over and over until it's done, and *then* run any other work, like so - \r\n<img width=\"548\" alt=\"screen shot 2018-07-25 at 1 18 50 pm\" src=\"https://user-images.githubusercontent.com/1114467/43231475-65ef64c8-9021-11e8-851c-de78148b4194.png\">\r\n\r\n**Initial Solution:**\r\n@acdlite and I discussed adding some API to allow a \"continued\" callback, so that the scheduler knows to put the next segment of work for that callback at the head of the list rather than the tail.\r\n\r\nI'm open to changing the API for this, adding a new option just seemed like the least invasive way, since adding a new method to the JS Scheduler would mean potentially injecting a new method into the renderers.\r\n\r\n**More Solutions:**\r\nI see a need for the JS Scheduler to know about different priorities in the future; any callback should be given a priority, and the priorities should mirror the ones used internally by React, that we've discussed before. I can go into why we need this if it's not clear.\r\n\r\nI'm not sure that we will still need/want the `continued` option after adding support for priorities, but think we might. React's single recurring callback does seem like it should be treated as one continued unit of work.\r\n\r\n**TODO next:**\r\nI want to add an integration test, simulating the situation from the above diagrams. Wondering what directory would be best for adding a test of actually using the JS Scheduler and React together. And if there might be something simpler than copying all of the timer mocks from the current JS Scheduler test.",
  "closed_by": {
    "login": "flarnie",
    "id": 1114467,
    "node_id": "MDQ6VXNlcjExMTQ0Njc=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1114467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/flarnie",
    "html_url": "https://github.com/flarnie",
    "followers_url": "https://api.github.com/users/flarnie/followers",
    "following_url": "https://api.github.com/users/flarnie/following{/other_user}",
    "gists_url": "https://api.github.com/users/flarnie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/flarnie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/flarnie/subscriptions",
    "organizations_url": "https://api.github.com/users/flarnie/orgs",
    "repos_url": "https://api.github.com/users/flarnie/repos",
    "events_url": "https://api.github.com/users/flarnie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/flarnie/received_events",
    "type": "User",
    "site_admin": false
  }
}

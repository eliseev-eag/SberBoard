{
  "url": "https://api.github.com/repos/facebook/react/issues/2205",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/2205/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/2205/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/2205/events",
  "html_url": "https://github.com/facebook/react/issues/2205",
  "id": 43086482,
  "node_id": "MDU6SXNzdWU0MzA4NjQ4Mg==",
  "number": 2205,
  "title": "TestUtils Simulate.click() used in multiple spec files causes test failures when using Jasmine.",
  "user": {
    "login": "iamrandys",
    "id": 6568413,
    "node_id": "MDQ6VXNlcjY1Njg0MTM=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/6568413?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iamrandys",
    "html_url": "https://github.com/iamrandys",
    "followers_url": "https://api.github.com/users/iamrandys/followers",
    "following_url": "https://api.github.com/users/iamrandys/following{/other_user}",
    "gists_url": "https://api.github.com/users/iamrandys/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iamrandys/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iamrandys/subscriptions",
    "organizations_url": "https://api.github.com/users/iamrandys/orgs",
    "repos_url": "https://api.github.com/users/iamrandys/repos",
    "events_url": "https://api.github.com/users/iamrandys/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iamrandys/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2014-09-18T02:26:10Z",
  "updated_at": "2014-09-19T01:05:30Z",
  "closed_at": "2014-09-19T01:04:26Z",
  "author_association": "NONE",
  "body": "I have two spec files that successfully run when they execute separately OR when one does not call Simulate.click().  If both of them execute the Simulate.click(), the click command is essentially ignored in the seconds spec file that runs.  If the same spec file has to Simulate.click() calls in two different tests, it works fine.\n\nI removed everything except these to spec files and simplified my karma.conf to verify that it is an issue with Simulate.click().\n\nI am using:\n\n```\n  \"react\": \"~0.11.0\",\n  \"karma\": \"^0.12.21\",\n  \"karma-bro\": \"^0.7.0\",\n  \"karma-jasmine\": \"^0.2.2\",\n  \"karma-chrome-launcher\": \"^0.1.4\",\n```\n\nFirst spec file that runs:\n\n```\n/** @jsx React.DOM */\n\nvar React = require('react/addons');\nvar TestUtils = require('react/lib/ReactTestUtils');\n\ndescribe('Button component', function () {\n    var Button;\n\n    beforeEach(function () {\n        Button = require('../button');\n        console.log('BUTTON BEGIN');\n    });\n\n    afterEach(function () {\n        console.log('BUTTON END');\n    });\n\n\n    it('should call onClick callback', function (done) {\n        var rendered = TestUtils.renderIntoDocument(\n            <Button onClick={function () {\n                done();\n            }}>hello</Button>\n        );\n        var domComponent = TestUtils.findRenderedComponentWithType(rendered, Button);\n\n        TestUtils.Simulate.click(domComponent.getDOMNode());\n    });\n});\n```\n\nSecond spec file that runs:\n\n```\n/** @jsx React.DOM */\n\nvar React = require('react/addons');\nvar TestUtils = require('react/lib/ReactTestUtils');\n\ndescribe('Calendar', function () {\n    var Calendar;\n    var moment;\n\n    beforeEach(function () {\n        moment = require('moment');\n        Calendar = require('../calendar');\n        console.log('CALENDAR BEGIN');\n    });\n\n    afterEach(function () {\n        console.log('CALENDAR END');\n    });\n\n    it('should display October when next is clicked', function () {\n        var displayDate = moment({month: 8, day: 1, year: 2014});\n        var rendered = TestUtils.renderIntoDocument(\n            <Calendar displayDate={displayDate} />\n        );\n        var nextButton = TestUtils.findRenderedDOMComponentWithClass(rendered, 'calendar--next-button');\n\n        TestUtils.Simulate.click(nextButton);\n\n        var domComponent = TestUtils.findRenderedComponentWithType(rendered, Calendar);\n        expect(domComponent.getDOMNode().textContent).toEqual('<October 2014>2829301234567891011121314151617181920212223242526272829303112345678');\n    });\n\n    it('should display August when previous is clicked', function () {\n        var displayDate = moment({month: 8, day: 1, year: 2014});\n        var rendered = TestUtils.renderIntoDocument(\n            <Calendar displayDate={displayDate} />\n        );\n        var previousButton = TestUtils.findRenderedDOMComponentWithClass(rendered, 'calendar--previous-button');\n\n        TestUtils.Simulate.click(previousButton);\n\n        var domComponent = TestUtils.findRenderedDOMComponentWithClass(rendered, 'calendar');\n        expect(domComponent.getDOMNode().textContent).toEqual('<August 2014>272829303112345678910111213141516171819202122232425262728293031123456');\n    });\n});\n```\n\nOutput when run together:\n\n```\n> ./node_modules/karma/bin/karma start karma.conf.js\n\nLOG: 'BUTTON BEGIN'\nLOG: 'BUTTON END'\nLOG: 'CALENDAR BEGIN'\nLOG: 'CALENDAR END'\nChrome 37.0.2062 (Mac OS X 10.9.4) Calendar should display October when next is clicked FAILED\n    Expected '<September 2014>311234567891011121314151617181920212223242526272829301234567891011' to equal '<October 2014>2829301234567891011121314151617181920212223242526272829303112345678'.\n    Error: Expected '<September 2014>311234567891011121314151617181920212223242526272829301234567891011' to equal '<October 2014>2829301234567891011121314151617181920212223242526272829303112345678'.\n        at Object.<anonymous> (/var/folders/bp/gb8knv2n6sj1gt8mnsqwpckr0000gn/T/e71ef582adaec8926a36a5cce6c7b9892aafd3ba.browserify:61:59 <- /Users/iamrandys/work/swa-ui-app/components-core/ui/__tests__/calendar.js:30:0)\nLOG: 'CALENDAR BEGIN'\nLOG: 'CALENDAR END'\nChrome 37.0.2062 (Mac OS X 10.9.4) Calendar should display August when previous is clicked FAILED\n    Expected '<September 2014>311234567891011121314151617181920212223242526272829301234567891011' to equal '<August 2014>272829303112345678910111213141516171819202122232425262728293031123456'.\n    Error: Expected '<September 2014>311234567891011121314151617181920212223242526272829301234567891011' to equal '<August 2014>272829303112345678910111213141516171819202122232425262728293031123456'.\n        at Object.<anonymous> (/var/folders/bp/gb8knv2n6sj1gt8mnsqwpckr0000gn/T/e71ef582adaec8926a36a5cce6c7b9892aafd3ba.browserify:74:59 <- /Users/iamrandys/work/swa-ui-app/components-core/ui/__tests__/calendar.js:43:0)\nChrome 37.0.2062 (Mac OS X 10.9.4): Executed 3 of 3 (2 FAILED) (0.86 secs / 0.206 secs)\n```\n\nWhen we comment out Simulate.click() in the first test, everything passes.\n\n```\n/** @jsx React.DOM */\n\nvar React = require('react/addons');\nvar TestUtils = require('react/lib/ReactTestUtils');\n\ndescribe('Button component', function () {\n    var Button;\n\n    beforeEach(function () {\n        Button = require('../button');\n        console.log('BUTTON BEGIN');\n    });\n\n    afterEach(function () {\n        console.log('BUTTON END');\n    });\n\n\n    it('should call onClick callback', function () {\n        var rendered = TestUtils.renderIntoDocument(\n            <Button onClick={function () {\n                done();\n            }}>hello</Button>\n        );\n        var domComponent = TestUtils.findRenderedComponentWithType(rendered, Button);\n\n        //TestUtils.Simulate.click(domComponent.getDOMNode()); // <--- COMMENTED OUT\n    });\n});\n```\n\nThe tests pass:\n\n```\n> ./node_modules/karma/bin/karma start karma.conf.js\n\nLOG: 'BUTTON BEGIN'\nLOG: 'BUTTON END'\nLOG: 'CALENDAR BEGIN'\nLOG: 'CALENDAR END'\nLOG: 'CALENDAR BEGIN'\nLOG: 'CALENDAR END'\nChrome 37.0.2062 (Mac OS X 10.9.4): Executed 3 of 3 SUCCESS (0.185 secs / 0.175 secs)\n```\n",
  "closed_by": {
    "login": "iamrandys",
    "id": 6568413,
    "node_id": "MDQ6VXNlcjY1Njg0MTM=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/6568413?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iamrandys",
    "html_url": "https://github.com/iamrandys",
    "followers_url": "https://api.github.com/users/iamrandys/followers",
    "following_url": "https://api.github.com/users/iamrandys/following{/other_user}",
    "gists_url": "https://api.github.com/users/iamrandys/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iamrandys/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iamrandys/subscriptions",
    "organizations_url": "https://api.github.com/users/iamrandys/orgs",
    "repos_url": "https://api.github.com/users/iamrandys/repos",
    "events_url": "https://api.github.com/users/iamrandys/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iamrandys/received_events",
    "type": "User",
    "site_admin": false
  }
}

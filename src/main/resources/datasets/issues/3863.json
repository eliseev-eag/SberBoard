{
  "url": "https://api.github.com/repos/facebook/react/issues/3863",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/3863/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/3863/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/3863/events",
  "html_url": "https://github.com/facebook/react/issues/3863",
  "id": 75798859,
  "node_id": "MDU6SXNzdWU3NTc5ODg1OQ==",
  "number": 3863,
  "title": "Error: Invariant Violation: dangerouslyRenderMarkup(…): Cannot render markup in a worker thread",
  "user": {
    "login": "MoonTahoe",
    "id": 5952082,
    "node_id": "MDQ6VXNlcjU5NTIwODI=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/5952082?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MoonTahoe",
    "html_url": "https://github.com/MoonTahoe",
    "followers_url": "https://api.github.com/users/MoonTahoe/followers",
    "following_url": "https://api.github.com/users/MoonTahoe/following{/other_user}",
    "gists_url": "https://api.github.com/users/MoonTahoe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MoonTahoe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MoonTahoe/subscriptions",
    "organizations_url": "https://api.github.com/users/MoonTahoe/orgs",
    "repos_url": "https://api.github.com/users/MoonTahoe/repos",
    "events_url": "https://api.github.com/users/MoonTahoe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MoonTahoe/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 139734344,
      "node_id": "MDU6TGFiZWwxMzk3MzQzNDQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/Component:%20Test%20Utils",
      "name": "Component: Test Utils",
      "color": "eb6420",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2015-05-13T01:07:56Z",
  "updated_at": "2015-05-18T20:44:26Z",
  "closed_at": "2015-05-18T20:44:26Z",
  "author_association": "NONE",
  "body": "## The Error\n\nI've read the other issues that relate to this issue and I am requiring React after globally defining window and document...\n\n```\n1) Reduced Test Case  Tests that Fail when Component changes state and renders \"before each\" hook:\n Error: Invariant Violation: dangerouslyRenderMarkup(...): Cannot render markup in a worker thread. Make sure `window` and `document` are available globally before requiring React when unit testing or use React.renderToString for server rendering.\n  at Context.<anonymous> (test/Reduced-spec.js:47:32)\n```\n## The Component : Reduced.js\n\n``` javascript\nvar React = require('react');\n\nvar Reduced = React.createClass({\n\n  getInitialState() {\n      console.log(\"start off with editing as false\");\n      return {editing: false};\n  },\n\n  edit() {\n      console.log(\"Setting State to Edit\");\n      this.setState({editing: true});\n  },\n\n  render() {\n      console.log(\"Rendering\");\n      return (\n          <span onClick={this.edit}>\n            {(this.state.editing) ? \"Editing\" : \"Click To Edit\"}\n          </span>\n      );\n  }\n\n});\n\nmodule.exports = Reduced;\n```\n## The Tests : 1-pass, 1-fail\n\n``` javascript\n    var React, TestUtils, jsdom, Reduced, expect;\n\n    describe('Reduced Test Case', function () {\n\n        before(function () {\n\n            jsdom = require('jsdom');\n            global.document = jsdom.jsdom('<!doctype html><html><body></body></html>');\n            global.window = global.document.parentWindow;\n\n            React = require('react/addons');\n            TestUtils = React.addons.TestUtils;\n\n            Reduced = require('./Reduced');\n\n            expect = require('chai').expect;\n\n            this.component = TestUtils.renderIntoDocument(\n                <Reduced />\n            );\n\n            var root = TestUtils.findRenderedDOMComponentWithTag(this.component, 'span');\n            this.el = root.getDOMNode();\n\n        });\n\n        describe(\"Tests Pass without simulate\", function () {\n\n            it(\"Root Element Reads 'Click To Edit'\", function () {\n                expect(this.el.innerHTML).to.equal('Click To Edit');\n            });\n\n        });\n\n        describe(\"Tests that Fail when Component changes state and renders\", function () {\n\n            beforeEach(function () {\n\n                //\n                //  Simulate invokes edit, invokes set state, invokes render, then error occures\n                //\n\n                TestUtils.Simulate.click(this.el);\n\n            });\n\n            it(\"Root Element Reads 'Editing'\", function () {\n                expect(this.el.innerHTML).to.equal('Editing');\n            });\n\n        });\n\n    });\n```\n## The Results\n\n```\n> mocha --compilers js:babel/register\n\nReduced Test Case - @current\n  start off with editing as false\n  Rendering\n\nTests Pass without simulate\n  ✓ Root Element Reads 'Click To Edit'\n\nTests that Fail when Component changes state and renders\n  Setting State to Edit\n  Rendering \n\n  1) \"before each\" hook\n\n\n1 passing (379ms)\n1 failing\n\n1) Reduced Test Case Tests that Fail when Component changes state and renders \"before each\" hook:\nError: Invariant Violation: dangerouslyRenderMarkup(...): Cannot render markup in a worker thread. Make sure `window` and `document` are available globally before requiring React when unit testing or use React.renderToString for server rendering.\nat Context.<anonymous> (test/Reduced-spec.js:47:32)\n```\n\nWhy does this happen?  Is there a way to fix it?\n",
  "closed_by": {
    "login": "zpao",
    "id": 8445,
    "node_id": "MDQ6VXNlcjg0NDU=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/8445?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zpao",
    "html_url": "https://github.com/zpao",
    "followers_url": "https://api.github.com/users/zpao/followers",
    "following_url": "https://api.github.com/users/zpao/following{/other_user}",
    "gists_url": "https://api.github.com/users/zpao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zpao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zpao/subscriptions",
    "organizations_url": "https://api.github.com/users/zpao/orgs",
    "repos_url": "https://api.github.com/users/zpao/repos",
    "events_url": "https://api.github.com/users/zpao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zpao/received_events",
    "type": "User",
    "site_admin": false
  }
}

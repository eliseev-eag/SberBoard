{
  "url": "https://api.github.com/repos/facebook/react/issues/14869",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14869/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14869/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14869/events",
  "html_url": "https://github.com/facebook/react/issues/14869",
  "id": 411086827,
  "node_id": "MDU6SXNzdWU0MTEwODY4Mjc=",
  "number": 14869,
  "title": "useLayoutEffect executes prematurely within Suspense",
  "user": {
    "login": "ryancogswell",
    "id": 287804,
    "node_id": "MDQ6VXNlcjI4NzgwNA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/287804?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ryancogswell",
    "html_url": "https://github.com/ryancogswell",
    "followers_url": "https://api.github.com/users/ryancogswell/followers",
    "following_url": "https://api.github.com/users/ryancogswell/following{/other_user}",
    "gists_url": "https://api.github.com/users/ryancogswell/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ryancogswell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ryancogswell/subscriptions",
    "organizations_url": "https://api.github.com/users/ryancogswell/orgs",
    "repos_url": "https://api.github.com/users/ryancogswell/repos",
    "events_url": "https://api.github.com/users/ryancogswell/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ryancogswell/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 710722093,
      "node_id": "MDU6TGFiZWw3MTA3MjIwOTM=",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Needs%20Investigation",
      "name": "Type: Needs Investigation",
      "color": "fbca04",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-02-16T16:16:18Z",
  "updated_at": "2019-02-18T14:47:17Z",
  "closed_at": "2019-02-18T14:47:17Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\nThis is a bug.\r\n\r\n**What is the current behavior?**\r\nIf two components are within `React.Suspense` and the first uses `useLayoutEffect` and the second is lazy loaded, `useLayoutEffect` for the first component is executing before it has been fully rendered to the DOM. If it tries to get its own height via a ref, it gets zero.\r\nThis issue began as a question on StackOverflow: https://stackoverflow.com/questions/54720741/react-hooks-lazy-loading-breaks-uselayouteffect\r\nMy answer on that question may add a little more context, but I have tried to include the important details here.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\nThis sandbox demonstrates the bug: https://codesandbox.io/s/40kw74nyk9\r\nThis sandbox shows a hackish workaround further demonstrating the timing of what is occurring: https://codesandbox.io/s/2v9l70r9o0\r\nIn the examples `AppBarHeader` is the component for which we want the height via a ref within `useLayoutEffect` and `Counter` is the lazy-loaded sibling. In the second example, I get it to \"work\" by triggering a re-render of `AppBarHeader` via `useLayoutEffect` in `Counter`.\r\n\r\n**What is the expected behavior?**\r\n`useLayoutEffect` should not execute until the element is fully rendered in the DOM such that its height can be successfully obtained.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\nReact 16.8.2 (also verified behavior in 16.8.0)\r\nI don't believe the issue is browser-specific. I've reproduced it on Chrome, Firefox, and Edge.\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

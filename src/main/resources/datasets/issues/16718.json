{
  "url": "https://api.github.com/repos/facebook/react/issues/16718",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/16718/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/16718/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/16718/events",
  "html_url": "https://github.com/facebook/react/issues/16718",
  "id": 491369779,
  "node_id": "MDU6SXNzdWU0OTEzNjk3Nzk=",
  "number": 16718,
  "title": "Feature Request: Lazy evaluation of useEffect dependencies.",
  "user": {
    "login": "Izhaki",
    "id": 880132,
    "node_id": "MDQ6VXNlcjg4MDEzMg==",
    "avatar_url": "https://avatars1.githubusercontent.com/u/880132?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Izhaki",
    "html_url": "https://github.com/Izhaki",
    "followers_url": "https://api.github.com/users/Izhaki/followers",
    "following_url": "https://api.github.com/users/Izhaki/following{/other_user}",
    "gists_url": "https://api.github.com/users/Izhaki/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Izhaki/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Izhaki/subscriptions",
    "organizations_url": "https://api.github.com/users/Izhaki/orgs",
    "repos_url": "https://api.github.com/users/Izhaki/repos",
    "events_url": "https://api.github.com/users/Izhaki/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Izhaki/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-09-09T23:13:30Z",
  "updated_at": "2019-09-10T15:36:05Z",
  "closed_at": "2019-09-10T15:36:05Z",
  "author_association": "NONE",
  "body": "# Current Behaviour \r\n\r\nThe dependencies to `useEffect` are given as an array:\r\n\r\n```js\r\nuseEffect(\r\n  () => { ... }\r\n  [deps],\r\n);\r\n```\r\n\r\nSo they are evaluated as soon as the hook is declared.\r\n\r\n# Desired Behaviour \r\n\r\nThe dependencies can also be given as a function, so these can be evaluated *after the children have been rendered*:\r\n\r\n```js\r\nuseEffect(\r\n  () => { ... }\r\n  () => [deps],\r\n);\r\n```\r\n\r\n# Rationale\r\n\r\nSometimes an effect in an ancestor is conditional on its descendants changing. Phrased alternatively, sometimes the effect dependencies of an ancestor are those of its dependents. \r\n\r\nBut if we are to compose the descendants (via the `children` prop), the ancestor has no knowledge  of the descendants' dependencies.\r\n\r\n# Simple Example (SVG)\r\n\r\n*Note: This is ultra-simplified example and an ultra-specific case of a generic behaviour/mechanism.*\r\n\r\n## Result\r\n\r\n![image](https://user-images.githubusercontent.com/880132/64571118-b8a74c80-d35a-11e9-9a28-754ad9f7293e.png)\r\n\r\n## Code\r\n\r\nEssential code only, removing HOCs and props:\r\n\r\n```js\r\n<Hexagon>\r\n  <Text value=\"Text\"/>\r\n</Hexagon>\r\n```\r\n\r\n## Constraints\r\n\r\n- BBox = BoundingBox\r\n- You can only query the DOM for the BBox of the text after it has been mounted.\r\n- The `Hexagon`'s shape should update based on its contents.\r\n- As previously mentioned, the `Hexagon` should not know that its `children` are `Text` - it just query the BBox of the element containing its `children`.\r\n\r\n## Solution\r\n\r\n### Descendant notifies change \r\n\r\nSomething like this in `Text` (an HOC really):\r\n\r\n```js\r\nconst {onChanged} = useContext(ChangeContext);\r\n\r\nuseEffect(() => {\r\n onChanged()\r\n}, [props.value]); \r\n```\r\n\r\n### Ancestor being notified\r\n\r\nWhenever a descendant fires onChange a `ref` in the ancestor is mutated:\r\n\r\n```js\r\ndescendantsChanged.current = true;\r\n```\r\n\r\nHow this happens is an implementation detail I can share.\r\n\r\nThe important point is that by the time we hit `useEffect` in Hexagon, it has the knowledge one of its descendants has changed.\r\n\r\n### The missing link\r\n\r\nIssue is, this won't work:\r\n\r\n```js\r\nuseEffect(\r\n  () => { /* query children bbox here */ }\r\n  [descendantsChanged.current],\r\n);\r\n```\r\n\r\nWhereas this will (I guess):\r\n```js\r\nuseEffect(\r\n  () => { /* query children bbox here */ }\r\n  () => [descendantsChanged.current],\r\n);\r\n```\r\n\r\n# Complex example (HTML)\r\n\r\nWhen the text of a port (eg, `out`) changes, the box of the 'chip' has to be queried:\r\n\r\n![image](https://user-images.githubusercontent.com/880132/64572456-4dac4480-d35f-11e9-8512-19f86fb752f9.png)\r\n\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "bvaughn",
    "id": 29597,
    "node_id": "MDQ6VXNlcjI5NTk3",
    "avatar_url": "https://avatars0.githubusercontent.com/u/29597?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bvaughn",
    "html_url": "https://github.com/bvaughn",
    "followers_url": "https://api.github.com/users/bvaughn/followers",
    "following_url": "https://api.github.com/users/bvaughn/following{/other_user}",
    "gists_url": "https://api.github.com/users/bvaughn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bvaughn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bvaughn/subscriptions",
    "organizations_url": "https://api.github.com/users/bvaughn/orgs",
    "repos_url": "https://api.github.com/users/bvaughn/repos",
    "events_url": "https://api.github.com/users/bvaughn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bvaughn/received_events",
    "type": "User",
    "site_admin": false
  }
}

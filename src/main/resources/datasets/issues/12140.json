{
  "url": "https://api.github.com/repos/facebook/react/issues/12140",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/12140/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/12140/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/12140/events",
  "html_url": "https://github.com/facebook/react/issues/12140",
  "id": 293923872,
  "node_id": "MDU6SXNzdWUyOTM5MjM4NzI=",
  "number": 12140,
  "title": "Safari 11 errors when using Fragment upon hydrating",
  "user": {
    "login": "Merri",
    "id": 976619,
    "node_id": "MDQ6VXNlcjk3NjYxOQ==",
    "avatar_url": "https://avatars1.githubusercontent.com/u/976619?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Merri",
    "html_url": "https://github.com/Merri",
    "followers_url": "https://api.github.com/users/Merri/followers",
    "following_url": "https://api.github.com/users/Merri/following{/other_user}",
    "gists_url": "https://api.github.com/users/Merri/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Merri/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Merri/subscriptions",
    "organizations_url": "https://api.github.com/users/Merri/orgs",
    "repos_url": "https://api.github.com/users/Merri/repos",
    "events_url": "https://api.github.com/users/Merri/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Merri/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-02-02T15:24:12Z",
  "updated_at": "2018-02-02T16:00:14Z",
  "closed_at": "2018-02-02T15:57:46Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\nThis is a bug.\r\n\r\n**What is the current behavior?**\r\nSafari 11 (both Mac OS X and iOS) throws error 130:\r\n\r\n```\r\nElement type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: object.\r\n```\r\n\r\nI have not been able to make a reduced test case but I'm reporting this in hope that someone else also has this issue and is able to figure out what is the root cause.\r\n\r\nCurrently the best I have figured out is that when in **production** universal rendering scenario and using React.Fragment together with elements that use context (like a component connected to Redux) Safari 11 errors during client side hydration. For example, in one case I had code like this:\r\n\r\n```jsx\r\n    <Fragment>\r\n        <div onClick={activateModal}>Open modal</div>\r\n        {isModalActive && <Modal />}\r\n    </Fragment>\r\n```\r\n\r\nWhich errored in Safari 11 until I replaced the Fragment with a div. In this case the Modal component was also connected to Redux and returned node using `createPortal`.\r\n\r\nIn another scenario we have CMS content using a custom renderer where JSON is transformed for React rendering and with some components there is a complex context based logic where using Fragments anywhere causes error in Safari 11. Similarly the issue was fixed by replacing Fragment with a div or a span depending on case.\r\n\r\nCurrently the only things I have been able to track together is the use of Fragments and context. It is possible that the bug requires some other condition but we have a large complex project, and I'm not an Apple user, which complicates things for me. It is also very inconvenient that this bug only happens with production React and bundle which results in very unhelpful error messages.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\nThis is my current best **attempt** in isolating the issue, but it does **not** replicate it: https://codepen.io/Merri/pen/xYZKez\r\n\r\n**What is the expected behavior?**\r\nSafari 11 should not throw during hydrate when using a mixture of Fragment and context.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\nReact 16.2 (production only, no issue with development version)\r\nSafari 11 (Safari 10 works fine)",
  "closed_by": {
    "login": "Merri",
    "id": 976619,
    "node_id": "MDQ6VXNlcjk3NjYxOQ==",
    "avatar_url": "https://avatars1.githubusercontent.com/u/976619?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Merri",
    "html_url": "https://github.com/Merri",
    "followers_url": "https://api.github.com/users/Merri/followers",
    "following_url": "https://api.github.com/users/Merri/following{/other_user}",
    "gists_url": "https://api.github.com/users/Merri/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Merri/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Merri/subscriptions",
    "organizations_url": "https://api.github.com/users/Merri/orgs",
    "repos_url": "https://api.github.com/users/Merri/repos",
    "events_url": "https://api.github.com/users/Merri/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Merri/received_events",
    "type": "User",
    "site_admin": false
  }
}

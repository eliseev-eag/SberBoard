{
  "url": "https://api.github.com/repos/facebook/react/issues/3768",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/3768/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/3768/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/3768/events",
  "html_url": "https://github.com/facebook/react/issues/3768",
  "id": 71615954,
  "node_id": "MDU6SXNzdWU3MTYxNTk1NA==",
  "number": 3768,
  "title": "Updating state fails in componentDidMount client side, when using server side rendering",
  "user": {
    "login": "mikecardwell",
    "id": 330908,
    "node_id": "MDQ6VXNlcjMzMDkwOA==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/330908?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mikecardwell",
    "html_url": "https://github.com/mikecardwell",
    "followers_url": "https://api.github.com/users/mikecardwell/followers",
    "following_url": "https://api.github.com/users/mikecardwell/following{/other_user}",
    "gists_url": "https://api.github.com/users/mikecardwell/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mikecardwell/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mikecardwell/subscriptions",
    "organizations_url": "https://api.github.com/users/mikecardwell/orgs",
    "repos_url": "https://api.github.com/users/mikecardwell/repos",
    "events_url": "https://api.github.com/users/mikecardwell/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mikecardwell/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2015-04-28T15:07:36Z",
  "updated_at": "2015-05-01T18:23:27Z",
  "closed_at": "2015-05-01T18:23:27Z",
  "author_association": "NONE",
  "body": "I'm trying to render a React component on the server side as html, serve that up, and then re-render\nclient side. I've included a cut down example below whereby \"The time is x\" is displayed, where x\nis updated once per second.\n\nGiven this simple class:\n\n``` javascript\nReact.createClass({\n\n    getInitialState: function () {\n        return {\n            now: 0\n        };\n    },\n\n    componentDidMount: function () {\n        this.setNow();\n        this.pid = setInterval(this.setNow, 1000);\n    },\n\n    componentWillUnmount: function componentWillUnmount() {\n        clearTimeout(this.pid);\n    },\n\n    setNow: function () {\n        this.setState({ now: (new Date()) + '' });\n    },\n\n    render: function () {\n        return (\n            <div>\n                The time is {this.state.now}\n            </div>\n        );\n    }\n\n});\n```\n\nThe server side HTML is generated correctly with a suitable data-reactid attribute.\n\nOn the client side, the first line in componentDidMount causes an error. \"0\" is displayed for the first second, but then is updated as expected once per second after that. The error message logged to the console is:\n\n> Error: Invariant Violation: findComponentRoot(..., .1ba6uva93i8.1.0.1): Unable to find element. This probably means the DOM was unexpectedly mutated (e.g., by the browser), usually due to forgetting a &lt;tbody&gt; when using tables, nesting tags like &lt;form&gt;, &lt;p&gt;, or &lt;a&gt;, or using non-SVG elements in an &lt;svg&gt; parent. Try inspecting the child nodes of the element with React ID ``.\n\nThe documentation for componentDidMount states: \"Invoked once, only on the client (not on the server), immediately after the initial rendering occurs.\" - This implies to me that it should be perfectly safe to update the state here to diverge from the state encoded in the initial server side HTML representation... If I replace the \"this.setNow()\" with \"setTimeout(this.setNow, 1)\" that fixes things, but it seems like a nasty hack to me.\n",
  "closed_by": {
    "login": "jimfb",
    "id": 9595985,
    "node_id": "MDQ6VXNlcjk1OTU5ODU=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/9595985?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jimfb",
    "html_url": "https://github.com/jimfb",
    "followers_url": "https://api.github.com/users/jimfb/followers",
    "following_url": "https://api.github.com/users/jimfb/following{/other_user}",
    "gists_url": "https://api.github.com/users/jimfb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jimfb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jimfb/subscriptions",
    "organizations_url": "https://api.github.com/users/jimfb/orgs",
    "repos_url": "https://api.github.com/users/jimfb/repos",
    "events_url": "https://api.github.com/users/jimfb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jimfb/received_events",
    "type": "User",
    "site_admin": false
  }
}

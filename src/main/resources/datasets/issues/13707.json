{
  "url": "https://api.github.com/repos/facebook/react/issues/13707",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/13707/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/13707/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/13707/events",
  "html_url": "https://github.com/facebook/react/issues/13707",
  "id": 362571420,
  "node_id": "MDU6SXNzdWUzNjI1NzE0MjA=",
  "number": 13707,
  "title": "Pass the refs to `getDerivedStateFromProps`?",
  "user": {
    "login": "theuselessdeveloper",
    "id": 9385045,
    "node_id": "MDQ6VXNlcjkzODUwNDU=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/9385045?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/theuselessdeveloper",
    "html_url": "https://github.com/theuselessdeveloper",
    "followers_url": "https://api.github.com/users/theuselessdeveloper/followers",
    "following_url": "https://api.github.com/users/theuselessdeveloper/following{/other_user}",
    "gists_url": "https://api.github.com/users/theuselessdeveloper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/theuselessdeveloper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/theuselessdeveloper/subscriptions",
    "organizations_url": "https://api.github.com/users/theuselessdeveloper/orgs",
    "repos_url": "https://api.github.com/users/theuselessdeveloper/repos",
    "events_url": "https://api.github.com/users/theuselessdeveloper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/theuselessdeveloper/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2018-09-21T11:23:16Z",
  "updated_at": "2018-09-24T14:04:40Z",
  "closed_at": "2018-09-24T09:46:13Z",
  "author_association": "NONE",
  "body": "I was wondering if it's a good idea to pass the refs to `getDerivedStateFromProps`. I understand why passing the instance is not welcomed, but there are some edge cases where the next state is calculated based on refs.\r\n\r\nTake a look at the example below:\r\n```javascript\r\nconst getFlyoutPosition = ({\r\n  idealDirection,\r\n  margin = parseInt(staticTooltip.margin, 10),\r\n  relativeOffset,\r\n  triggerRect\r\n}) => {\r\n  const windowSize = {\r\n    height: window.innerHeight,\r\n    width: window.innerWidth,\r\n    scrollX: 0,\r\n    scrollY: 0\r\n  };\r\n\r\n  // Here `this.flyoutRef` is needed to get the element dimensions and use them to calculate the next state\r\n  // At the moment there is no way to access the refs in `getDerivedStateFromProps`\r\n  const flyoutSize = {\r\n    height: this.flyoutRef ? this.flyoutRef.clientHeight : 0,\r\n    width: this.flyoutRef ? this.flyoutRef.clientWidth : 0\r\n  };\r\n\r\n  const mainDir = getMainDir(flyoutSize, idealDirection, triggerRect, windowSize, margin);\r\n  const base = baseOffsets(relativeOffset, flyoutSize, mainDir, triggerRect, windowSize, margin);\r\n  const flyoutOffset = {\r\n    top: base.top,\r\n    left: base.left\r\n  };\r\n\r\n  return { flyoutOffset, mainDir };\r\n};\r\n\r\nexport default class extends Component {\r\n  state = {\r\n    flyoutOffset: {\r\n      top: undefined,\r\n      right: undefined,\r\n      bottom: undefined,\r\n      left: undefined\r\n    },\r\n    mainDir: null,\r\n  };\r\n\r\n  static getDerivedStateFromProps = getFlyoutPosition\r\n\r\n  setFlyoutRef = (c) => { this.flyoutRef = c; }\r\n\r\n  flyoutRef;\r\n\r\n  render() {\r\n    const { flyoutOffset } = this.state;\r\n    const { children } = this.props;\r\n\r\n    return (\r\n      <div\r\n        ref={this.setFlyoutRef}\r\n        style={{ position: 'absolute', ...flyoutOffset }}\r\n      >\r\n        {children}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n```\r\n\r\nI think we should consider passing refs to `getDerivedStateFromProps` as sometimes the state may be based on values from the DOM.\r\n\r\nPlease let me know if I should create a PR.",
  "closed_by": {
    "login": "theuselessdeveloper",
    "id": 9385045,
    "node_id": "MDQ6VXNlcjkzODUwNDU=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/9385045?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/theuselessdeveloper",
    "html_url": "https://github.com/theuselessdeveloper",
    "followers_url": "https://api.github.com/users/theuselessdeveloper/followers",
    "following_url": "https://api.github.com/users/theuselessdeveloper/following{/other_user}",
    "gists_url": "https://api.github.com/users/theuselessdeveloper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/theuselessdeveloper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/theuselessdeveloper/subscriptions",
    "organizations_url": "https://api.github.com/users/theuselessdeveloper/orgs",
    "repos_url": "https://api.github.com/users/theuselessdeveloper/repos",
    "events_url": "https://api.github.com/users/theuselessdeveloper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/theuselessdeveloper/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/14713",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14713/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14713/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14713/events",
  "html_url": "https://github.com/facebook/react/issues/14713",
  "id": 403692596,
  "node_id": "MDU6SXNzdWU0MDM2OTI1OTY=",
  "number": 14713,
  "title": "useLayoutEffect gets the initial state from useState instead of the current state when its input list never changes when an async method is fired",
  "user": {
    "login": "madou",
    "id": 6801309,
    "node_id": "MDQ6VXNlcjY4MDEzMDk=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6801309?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/madou",
    "html_url": "https://github.com/madou",
    "followers_url": "https://api.github.com/users/madou/followers",
    "following_url": "https://api.github.com/users/madou/following{/other_user}",
    "gists_url": "https://api.github.com/users/madou/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/madou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/madou/subscriptions",
    "organizations_url": "https://api.github.com/users/madou/orgs",
    "repos_url": "https://api.github.com/users/madou/repos",
    "events_url": "https://api.github.com/users/madou/events{/privacy}",
    "received_events_url": "https://api.github.com/users/madou/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-01-28T08:10:59Z",
  "updated_at": "2019-01-28T22:45:57Z",
  "closed_at": "2019-01-28T22:44:51Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\n\r\nReport a bug.\r\n\r\n**What is the current behavior?**\r\n\r\nWhen using `useLayoutEffect` (having it fire only once during mount, and once during unmount), setting state outside of it and then having an async method run inside of it, results in it not being able to `useState` as expected. Instead of getting the latest value - it always gets the initial value.\r\n\r\nCodesandbox here: https://codesandbox.io/s/9jm66px2z4\r\nActual usage here: https://github.com/madou/react-peer/blob/master/src/use-peer-state.tsx#L29\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\n**What is the expected behavior?**\r\n\r\nThat it would get the current state when the async code is run. If I don't supply a input list to the hook it works as expected - however at the cost of repeated cleanup/initialisation.\r\n\r\nI'm looking from the synonymous `componentDidMount()`/`componentWillUnmount()` hooks - was thinking using `useLayoutEffect` like so would do it.\r\n\r\nAm I using it as expected? Is there a proper way to use it?\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nUsing `16.8.0-alpha.1`.\r\n\r\nCheers,",
  "closed_by": {
    "login": "madou",
    "id": 6801309,
    "node_id": "MDQ6VXNlcjY4MDEzMDk=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6801309?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/madou",
    "html_url": "https://github.com/madou",
    "followers_url": "https://api.github.com/users/madou/followers",
    "following_url": "https://api.github.com/users/madou/following{/other_user}",
    "gists_url": "https://api.github.com/users/madou/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/madou/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/madou/subscriptions",
    "organizations_url": "https://api.github.com/users/madou/orgs",
    "repos_url": "https://api.github.com/users/madou/repos",
    "events_url": "https://api.github.com/users/madou/events{/privacy}",
    "received_events_url": "https://api.github.com/users/madou/received_events",
    "type": "User",
    "site_admin": false
  }
}

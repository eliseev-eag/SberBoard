{
  "url": "https://api.github.com/repos/facebook/react/issues/16964",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/16964/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/16964/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/16964/events",
  "html_url": "https://github.com/facebook/react/issues/16964",
  "id": 500420271,
  "node_id": "MDU6SXNzdWU1MDA0MjAyNzE=",
  "number": 16964,
  "title": "React Child Component with Array Props Updating Incorrectly",
  "user": {
    "login": "msgraber",
    "id": 13192942,
    "node_id": "MDQ6VXNlcjEzMTkyOTQy",
    "avatar_url": "https://avatars3.githubusercontent.com/u/13192942?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/msgraber",
    "html_url": "https://github.com/msgraber",
    "followers_url": "https://api.github.com/users/msgraber/followers",
    "following_url": "https://api.github.com/users/msgraber/following{/other_user}",
    "gists_url": "https://api.github.com/users/msgraber/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/msgraber/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/msgraber/subscriptions",
    "organizations_url": "https://api.github.com/users/msgraber/orgs",
    "repos_url": "https://api.github.com/users/msgraber/repos",
    "events_url": "https://api.github.com/users/msgraber/events{/privacy}",
    "received_events_url": "https://api.github.com/users/msgraber/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2019-09-30T17:40:16Z",
  "updated_at": "2019-10-01T15:37:59Z",
  "closed_at": "2019-10-01T15:37:59Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\nBug\r\n\r\n**What is the current behavior?**\r\nA child Component with array Props update incorrectly when the array is updated in the parent with setState.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nThe child is declared in the parent Component render as follows (Alarms is the child Component, filteredStatus is the array):\r\n\r\n<div key={1} className={'1'}>\r\n  <span className='text'><b>{locationName} <i>Status</i></b></span>\r\n  <Alarms filteredStatus={this.state.filteredStatus}/>\r\n</div>\r\nThe child displays the array as a table.\r\n\r\npublic generate = () => {\r\n    return this.props.filteredStatus.map(status =>\r\n    {\r\n      return (\r\n      <TableRow key={status.location}>\r\n        <TableCell align=\"left\">\r\n          {(status.severity === 40) && <ErrorIcon style={{ fill: '#FF3333'}}/>}\r\n          {(status.severity === 30) && <NotificationIcon style={{ fill: 'FFA033'}}/>}\r\n          {(status.severity === 20) && <WarningIcon style={{ fill: 'FFE033'}}/>}\r\n        </TableCell>\r\n        <TableCell align=\"left\">{status.description}</TableCell>\r\n        <TableCell align=\"left\">{status.timestamp}</TableCell>\r\n        <TableCell align=\"left\">{status.location}</TableCell>\r\n\r\n        {/* <div className=\"ListBtn\">\r\n          <Tooltip title={\"Clear '\" + alarm.who + \"'\"}>\r\n            <Avatar>\r\n              <IconButton aria-label=\"Delete\" onClick={this.openClearAlarmConfirmDialog.bind(this, alarm)} >\r\n                <DeleteIcon />\r\n              </IconButton>\r\n            </Avatar>\r\n          </Tooltip>\r\n        </div> */}\r\n      </TableRow>\r\n      );\r\n    });\r\n  }\r\n\r\n  public render() {\r\n    return (\r\n      <div>\r\n        {/* <Paper> */}\r\n          <Table>\r\n            <TableHead>\r\n              <TableCell align=\"left\">Severity</TableCell>\r\n              <TableCell align=\"left\">Description</TableCell>\r\n              <TableCell align=\"left\">Timestamp</TableCell>\r\n              <TableCell align=\"left\">Location</TableCell>\r\n            </TableHead>\r\n            <TableBody>\r\n              {this.generate()}\r\n            </TableBody>\r\n          </Table>\r\n        {/* </Paper> */}\r\n      </div>\r\n    );\r\n  }\r\n\r\n\r\nfilteredStatus is declared in the parent Component state as...\r\n\r\n    interface IState {\r\n      dtName: string;\r\n      dtDesc: string;\r\n      dtInfo: IDrivetrainInfo;\r\n      drillDownIndex: number;\r\n      componentName: string;\r\n      navLocations: string[];\r\n      filteredStatus: Status[];\r\n      nullStatus: Status[];\r\n      locationStatus: Status;\r\n    }\r\n\r\nStatus is a user defined class...\r\n\r\n\r\n    export class Status {\r\n        public location: string;\r\n        public timestamp: string;\r\n        public severity: number;\r\n        public description: string;\r\n    }\r\nThe filteredStatus is updated in the parent from a timer... A new array of Status is created and assigned to the state.filtered status as follows:\r\n\r\nthis.setState({filteredStatus: this.localStatus});\r\nWhat happens is that the updated table doesn't correctly show the new array of components. The new array appears to be merged with the old array. I added the size of the array to the child display and at times the size shows 0 while the list shows 15 elements.\r\n\r\nI was able to work around this problem by first setting the filteredStatus to a null array, then the new array as follows:\r\n\r\nconst nullStatus = Array<Status>();\r\nthis.setState({filteredStatus: nullStatus});\r\nthis.setState({filteredStatus: this.localStatus});\r\nI may be doing something wrong, but this appears to be a problem with the rendering of the array props in the child Component.\r\n\r\n**What is the expected behavior?**\r\nThe child array should display the elements of the array correctly.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\nReact: \"^16.8.5\",\r\nChrome browser. \r\n",
  "closed_by": {
    "login": "bvaughn",
    "id": 29597,
    "node_id": "MDQ6VXNlcjI5NTk3",
    "avatar_url": "https://avatars0.githubusercontent.com/u/29597?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bvaughn",
    "html_url": "https://github.com/bvaughn",
    "followers_url": "https://api.github.com/users/bvaughn/followers",
    "following_url": "https://api.github.com/users/bvaughn/following{/other_user}",
    "gists_url": "https://api.github.com/users/bvaughn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bvaughn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bvaughn/subscriptions",
    "organizations_url": "https://api.github.com/users/bvaughn/orgs",
    "repos_url": "https://api.github.com/users/bvaughn/repos",
    "events_url": "https://api.github.com/users/bvaughn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bvaughn/received_events",
    "type": "User",
    "site_admin": false
  }
}

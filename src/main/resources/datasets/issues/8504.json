{
  "url": "https://api.github.com/repos/facebook/react/issues/8504",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/8504/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/8504/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/8504/events",
  "html_url": "https://github.com/facebook/react/issues/8504",
  "id": 193741783,
  "node_id": "MDU6SXNzdWUxOTM3NDE3ODM=",
  "number": 8504,
  "title": "Performance monitoring does not record any behaviour on page reload",
  "user": {
    "login": "bokkibear",
    "id": 4399619,
    "node_id": "MDQ6VXNlcjQzOTk2MTk=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/4399619?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bokkibear",
    "html_url": "https://github.com/bokkibear",
    "followers_url": "https://api.github.com/users/bokkibear/followers",
    "following_url": "https://api.github.com/users/bokkibear/following{/other_user}",
    "gists_url": "https://api.github.com/users/bokkibear/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bokkibear/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bokkibear/subscriptions",
    "organizations_url": "https://api.github.com/users/bokkibear/orgs",
    "repos_url": "https://api.github.com/users/bokkibear/repos",
    "events_url": "https://api.github.com/users/bokkibear/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bokkibear/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2016-12-06T10:57:04Z",
  "updated_at": "2016-12-06T11:58:28Z",
  "closed_at": "2016-12-06T11:53:54Z",
  "author_association": "NONE",
  "body": "Bug: Using `?react_perf` appears to correctly switch on performance monitoring, but no React measures show up in the timeline.\r\n\r\nTo reproduce:\r\n\r\n1. In Chrome, go to any page with non-production React code and add the `?react_perf` query string as described in https://facebook.github.io/react/blog/#profiling-components-with-chrome-timeline. For example: https://jsfiddle.net/f9oc9Ldy/3/?react_perf\r\n\r\n2. Open Chrome DevTools and click to the \"Timeline\" tab\r\n\r\n3. Refresh the page\r\n\r\n4. When the page has refreshed, look at the timeline and note that there aren't any react-specific marks.\r\n\r\n5. In the console, do `performance.getEntriesByType(\"measure\")` - you'll get an empty array, when you should get actual performance measures.\r\n\r\nTested with React 15.4.1 on Chrome. I'd expect to see React-specific events (e.g. `mount` events for the React components) in the timeline, and to be able to access performance measures from the console.\r\n\r\nLooking in the code, it appears that all recorded performance measures are immediately deleted, which may be causing this issue. See https://github.com/facebook/react/blob/master/src/renderers/shared/ReactDebugTool.js\r\n\r\n```\r\n  const markEnd = function(debugID, markType) {\r\n    if (!shouldMark(debugID)) {\r\n      return;\r\n    }\r\n\r\n    var markName = `${debugID}::${markType}`;\r\n    var displayName = ReactComponentTreeHook.getDisplayName(debugID) || 'Unknown';\r\n\r\n    // Chrome has an issue of dropping markers recorded too fast:\r\n    // https://bugs.chromium.org/p/chromium/issues/detail?id=640652\r\n    // To work around this, we will not report very small measurements.\r\n    // I determined the magic number by tweaking it back and forth.\r\n    // 0.05ms was enough to prevent the issue, but I set it to 0.1ms to be safe.\r\n    // When the bug is fixed, we can `measure()` unconditionally if we want to.\r\n    var timeStamp = performanceNow();\r\n    if (timeStamp - lastMarkTimeStamp > 0.1) {\r\n      var measurementName = `${displayName} [${markType}]`;\r\n      performance.measure(measurementName, markName);\r\n    }\r\n\r\n    performance.clearMarks(markName);\r\n    performance.clearMeasures(measurementName);\r\n  };\r\n```\r\n\r\nImmediately after every measurement, we instruct the browser to clear the same measure (by name) - so it seems like no measurements ever take place. Removing the final two lines of the function restores expected behaviour.",
  "closed_by": {
    "login": "bokkibear",
    "id": 4399619,
    "node_id": "MDQ6VXNlcjQzOTk2MTk=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/4399619?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bokkibear",
    "html_url": "https://github.com/bokkibear",
    "followers_url": "https://api.github.com/users/bokkibear/followers",
    "following_url": "https://api.github.com/users/bokkibear/following{/other_user}",
    "gists_url": "https://api.github.com/users/bokkibear/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bokkibear/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bokkibear/subscriptions",
    "organizations_url": "https://api.github.com/users/bokkibear/orgs",
    "repos_url": "https://api.github.com/users/bokkibear/repos",
    "events_url": "https://api.github.com/users/bokkibear/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bokkibear/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/3497",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/3497/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/3497/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/3497/events",
  "html_url": "https://github.com/facebook/react/issues/3497",
  "id": 64029915,
  "node_id": "MDU6SXNzdWU2NDAyOTkxNQ==",
  "number": 3497,
  "title": "ReactTransitionGroup: setState in _handleDoneLeaving is problematic",
  "user": {
    "login": "fvanclef",
    "id": 69688,
    "node_id": "MDQ6VXNlcjY5Njg4",
    "avatar_url": "https://avatars1.githubusercontent.com/u/69688?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fvanclef",
    "html_url": "https://github.com/fvanclef",
    "followers_url": "https://api.github.com/users/fvanclef/followers",
    "following_url": "https://api.github.com/users/fvanclef/following{/other_user}",
    "gists_url": "https://api.github.com/users/fvanclef/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fvanclef/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fvanclef/subscriptions",
    "organizations_url": "https://api.github.com/users/fvanclef/orgs",
    "repos_url": "https://api.github.com/users/fvanclef/repos",
    "events_url": "https://api.github.com/users/fvanclef/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fvanclef/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2015-03-24T15:42:49Z",
  "updated_at": "2017-02-07T19:40:56Z",
  "closed_at": "2017-01-27T14:41:14Z",
  "author_association": "NONE",
  "body": "Hi, \n\nI am implementing a custom animation on svg and I have found a problem with this code in the _handleDoneLeaving function of ReactTransitionGroup\n\n``` javascript\n\n  _handleDoneLeaving: function(key) {\n    var component = this.refs[key];\n\n    if (component.componentDidLeave) {\n      component.componentDidLeave();\n    }\n\n    delete this.currentlyTransitioningKeys[key];\n\n    var currentChildMapping = ReactTransitionChildMapping.getChildMapping(\n      this.props.children\n    );\n\n    if (currentChildMapping && currentChildMapping.hasOwnProperty(key)) {\n      // This entered again before it fully left. Add it again.\n      this.performEnter(key);\n    } else {\n      var newChildren = assign({}, this.state.children);\n      delete newChildren[key];\n      this.setState({children: newChildren});  // where the problem \n    }\n  },\n\n```\n\nWhen there are many children to remove only the last one is actually removed. The reason is because setState is not updating immediately the children list, the assignment of this.state.children to newChildren is still referencing the full list for the next call. In fact only the last remove is effective.\n\nHere is a jsfiddle example \n\nhttp://jsfiddle.net/z4go3Lw3/4/\n\nThe initlal view is about 5 green circles, when clicking on the change button, 5 new circles must be added and the previous 5 must be removed. But only one is removed\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

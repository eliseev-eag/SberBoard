{
  "url": "https://api.github.com/repos/facebook/react/issues/11782",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/11782/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/11782/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/11782/events",
  "html_url": "https://github.com/facebook/react/pull/11782",
  "id": 279631625,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTU2NjQ0MDQz",
  "number": 11782,
  "title": "Updated misleading error message in production environment when adding ref to a functional component (#11761)",
  "user": {
    "login": "skiritsis",
    "id": 29357763,
    "node_id": "MDQ6VXNlcjI5MzU3NzYz",
    "avatar_url": "https://avatars0.githubusercontent.com/u/29357763?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/skiritsis",
    "html_url": "https://github.com/skiritsis",
    "followers_url": "https://api.github.com/users/skiritsis/followers",
    "following_url": "https://api.github.com/users/skiritsis/following{/other_user}",
    "gists_url": "https://api.github.com/users/skiritsis/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/skiritsis/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/skiritsis/subscriptions",
    "organizations_url": "https://api.github.com/users/skiritsis/orgs",
    "repos_url": "https://api.github.com/users/skiritsis/repos",
    "events_url": "https://api.github.com/users/skiritsis/events{/privacy}",
    "received_events_url": "https://api.github.com/users/skiritsis/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2017-12-06T05:28:00Z",
  "updated_at": "2018-01-05T18:08:02Z",
  "closed_at": "2018-01-05T18:07:59Z",
  "author_association": "CONTRIBUTOR",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/11782",
    "html_url": "https://github.com/facebook/react/pull/11782",
    "diff_url": "https://github.com/facebook/react/pull/11782.diff",
    "patch_url": "https://github.com/facebook/react/pull/11782.patch"
  },
  "body": "I have followed the execution flow backwards  from the stack trace thrown by the invariant which by the way looks like:\r\n```\r\n    ReactChildFiber ->at coerceRef\r\n    ReactChildFiber -> at reconcileSingleElement\r\n    ReactChildFiber -> at reconcileChildFibers\r\n    ReactFiberBeginWork -> at reconcileChildrenAtExpirationTime\r\n    ReactFiberBeginWork -> at reconcileChildren\r\n    ReactFiberBeginWork -> at mountIndeterminateComponent\r\n    ReactFiberBeginWork -> at beginWork\r\n    ReactFiberScheduler -> at performUnitOfWork\r\n    ReactFiberScheduler -> at workLoop\r\n```\r\n\r\nfor the following example:\r\n\r\n```\r\n        function Child() {\r\n            return <div ref=\"test\" />;\r\n        }\r\n        \r\n      ReactDOM.render(\r\n              <Child />,\r\n        document.getElementById('container')\r\n      );\r\n```\r\n\r\nand I believe that while we are not on `__DEV__` environment, since we do not set the owner for functional components, we do not have the necessary information (tag) at any point to safely deduce if the component is functional to throw the same error.\r\nhttps://github.com/facebook/react/blob/5bd2321ae3dd7d68ac02dee3c3f271e9d0ee8784/packages/react-reconciler/src/ReactChildFiber.js#L107-L114\r\n\r\nAs such I have updated the error message to properly cover both cases. Although not ideal to have the same error for multiple reasons, seems to was the case as well in React 15.x.\r\n\r\nPrevious error message:\r\n\r\n> Only a ReactOwner can have refs. You might be adding a ref to a component that was not created inside a componentâ€™s render method, or you have multiple copies of React loaded.\r\n\r\n@gaearon Should I update the documentation [link](https://reactjs.org/warnings/refs-must-have-owner.html) with the new message as well as an additional bullet point about functional components?\r\n\r\nPlease let me know if I overlooked something obvious. Any feedback is welcome.\r\n\r\nOn a different note, the following example:\r\n\r\n```\r\n    function Bar() {\r\n        return <div>Hello, world</div>;\r\n    }\r\n    class Foo extends React.Component {\r\n        render() {\r\n            return <Bar ref=\"foo\" />;\r\n        }\r\n    }\r\n\r\n    ReactDOM.render(\r\n            <Foo />,\r\n        document.getElementById('container')\r\n    );\r\n```\r\n\r\nis a different case that can be checked. Currently on `__DEV__` environment, we trigger the following warning (which is covered by the tests):\r\n\r\n```\r\nWarning: Stateless function components cannot be given refs. Attempts to access this ref will fail.\r\n\r\nCheck the render method of `Foo`.\r\n    in Bar (created by Foo)\r\n    in Foo\r\n```",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/16318",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/16318/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/16318/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/16318/events",
  "html_url": "https://github.com/facebook/react/issues/16318",
  "id": 478556845,
  "node_id": "MDU6SXNzdWU0Nzg1NTY4NDU=",
  "number": 16318,
  "title": "unexpected behavior with useState. when state is accessed from a callback function",
  "user": {
    "login": "thesimpledesigners",
    "id": 9967336,
    "node_id": "MDQ6VXNlcjk5NjczMzY=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/9967336?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/thesimpledesigners",
    "html_url": "https://github.com/thesimpledesigners",
    "followers_url": "https://api.github.com/users/thesimpledesigners/followers",
    "following_url": "https://api.github.com/users/thesimpledesigners/following{/other_user}",
    "gists_url": "https://api.github.com/users/thesimpledesigners/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/thesimpledesigners/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/thesimpledesigners/subscriptions",
    "organizations_url": "https://api.github.com/users/thesimpledesigners/orgs",
    "repos_url": "https://api.github.com/users/thesimpledesigners/repos",
    "events_url": "https://api.github.com/users/thesimpledesigners/events{/privacy}",
    "received_events_url": "https://api.github.com/users/thesimpledesigners/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-08-08T15:55:33Z",
  "updated_at": "2019-08-10T07:59:24Z",
  "closed_at": "2019-08-09T17:45:27Z",
  "author_association": "NONE",
  "body": "**Do you want to request a feature or report a bug?**\r\nPossible bug\r\n\r\n\r\n**What is the current behavior?**\r\nIm using a 3rd party jQuery plugin in combination with useState and useEffect hook to bind plugin events when component is mounted, this plugin calls a callback that update the component state, but callback is sort of closing on the initial state and with each call , values in state gets rest to their initial state\r\n\r\n**Minimal Code Sample**\r\n```javascript\r\nfunction Example(props) {\r\n    const start = moment();\r\n    const end = moment().add(7, \"days\");\r\n    const dateRangeRef = useRef(null);\r\n    // component state\r\n    const [state, setState] = useState({\r\n        start_date: null,\r\n        end_date: null,\r\n        other_var1: 0,\r\n        other_var2: 0\r\n    });\r\n    // date range picker handle\r\n    useEffect(() => {\r\n        // initiate daterange picker\r\n        const daterange = $(dateRangeRef.current).daterangepicker({\r\n            startDate: start,\r\n            endDate: end\r\n        });\r\n        \r\n        const callback = (ev, picker) => {\r\n            /* BUG */\r\n            // call to setState here will rest the other values in state to their initial state \r\n            setState({\r\n                ...state, // state here is referring to initial state\r\n                start_date: picker.startDate.format(\"YYYY-MM-DD\"),\r\n                end_date: picker.endDate.format(\"YYYY-MM-DD\")\r\n            });\r\n        };\r\n        daterange.on(\"apply.daterangepicker\", callback);\r\n    }, []);\r\n\r\n    return (\r\n        <div>\r\n            <input ref={dateRangeRef} type=\"text\" />\r\n        </div>\r\n    );\r\n}\r\nexport default Example;\r\n```\r\n\r\n**What is the expected behavior?**\r\nwhen callback is called start_date and end_date will be saved in state along other variables, but in this case other variables will be always reset I don't why such a behavior is happening\r\n\r\n*Which versions of React?**\r\n\r\n- **React Version** : 16.2.0 \r\n- **Browser** : Chrome \r\n- **Os** : Linux Ubuntu \r\n",
  "closed_by": {
    "login": "aweary",
    "id": 6886061,
    "node_id": "MDQ6VXNlcjY4ODYwNjE=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6886061?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aweary",
    "html_url": "https://github.com/aweary",
    "followers_url": "https://api.github.com/users/aweary/followers",
    "following_url": "https://api.github.com/users/aweary/following{/other_user}",
    "gists_url": "https://api.github.com/users/aweary/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aweary/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aweary/subscriptions",
    "organizations_url": "https://api.github.com/users/aweary/orgs",
    "repos_url": "https://api.github.com/users/aweary/repos",
    "events_url": "https://api.github.com/users/aweary/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aweary/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/11997",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/11997/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/11997/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/11997/events",
  "html_url": "https://github.com/facebook/react/issues/11997",
  "id": 287150575,
  "node_id": "MDU6SXNzdWUyODcxNTA1NzU=",
  "number": 11997,
  "title": "npm test fails - using expect.createSpy and ReactTestUtils.Simulate.submit",
  "user": {
    "login": "rohan-paul",
    "id": 12703975,
    "node_id": "MDQ6VXNlcjEyNzAzOTc1",
    "avatar_url": "https://avatars3.githubusercontent.com/u/12703975?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rohan-paul",
    "html_url": "https://github.com/rohan-paul",
    "followers_url": "https://api.github.com/users/rohan-paul/followers",
    "following_url": "https://api.github.com/users/rohan-paul/following{/other_user}",
    "gists_url": "https://api.github.com/users/rohan-paul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rohan-paul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rohan-paul/subscriptions",
    "organizations_url": "https://api.github.com/users/rohan-paul/orgs",
    "repos_url": "https://api.github.com/users/rohan-paul/repos",
    "events_url": "https://api.github.com/users/rohan-paul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rohan-paul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 155984160,
      "node_id": "MDU6TGFiZWwxNTU5ODQxNjA=",
      "url": "https://api.github.com/repos/facebook/react/labels/Status:%20Unconfirmed",
      "name": "Status: Unconfirmed",
      "color": "d4c5f9",
      "default": false
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-01-09T16:31:28Z",
  "updated_at": "2018-03-05T07:24:17Z",
  "closed_at": null,
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\nReport a bug.\r\n\r\n**What is the current behavior?**\r\nnpm test fails - using expect.createSpy and ReactTestUtils.Simulate.submit\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo** \r\n\r\nIn my App, have a CountdownForm component as below. The component creates an input form, where I input a number (which is total number of seconds) and the component returns the formatted version of that number in minutes and seconds. The component works fine in the project, giving me the desired output. But the test fails\r\n\r\nCode in CountdownForm component.\r\n\r\n```\r\nimport React from 'react';\r\nimport createReactClass from 'create-react-class';\r\n\r\n    var CountdownForm = createReactClass({\r\n      onSubmit: function(e) {\r\n        e.preventDefault();\r\n        var strSeconds = this.refs.seconds.value;\r\n\r\n        if(strSeconds.match(/^[0-9]*$/)) {\r\n          this.refs.seconds.value = '';\r\n          this.props.onSetCountdown(parseInt(strSeconds, 10));\r\n        }\r\n      },\r\n      render: function () {\r\n        return (\r\n          <div>\r\n            <form ref=\"form\" onSubmit={this.onSubmit} className=\"countdown-form\">\r\n              <input type=\"text\" ref=\"seconds\" placeholder=\"Enter time in seconds\"/>\r\n              <button className=\"button expanded\">Start</button>\r\n            </form>\r\n          </div>\r\n        );\r\n      }\r\n    });\r\n```\r\nAnd the below is the contents of my test file for the above component following [ReactTestUtil's Simulate doc](https://reactjs.org/docs/test-utils.html#simulate) and [expect.createSpy doc](https://github.com/mjackson/expect#spy-tohavebeencalledwith)\r\n\r\n```\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport expect, {createSpy, spyOn, isSpy} from 'expect';\r\nimport $ from 'jquery';\r\nimport CountdownForm from 'CountdownForm';\r\nimport ReactTestUtils from 'react-dom/test-utils';\r\n\r\ndescribe('CountdownForm', () => {\r\n\r\n  it('should call onSetCountdown if valid seconds entered', () => {\r\n    var spy = expect.createSpy;\r\n    var countdownForm = ReactTestUtils.renderIntoDocument(<CountdownForm onSetCountdown={spy}/>);\r\n    var $el = $(ReactDOM.findDOMNode(countdownForm));\r\n\r\n    countdownForm.refs.seconds.value = '109';\r\n    ReactTestUtils.Simulate.submit($el.find('form')[0]);\r\n\r\n    expect(spy).toHaveBeenCalledWith(109);\r\n  });\r\n```\r\nAnd when I run ``npm test`` get the below error for this specific test. I am thinking if I am missing something here, probably its around the line ``ReactTestUtils.Simulate.submit($el.find('form')[0])``\r\n\r\n```\r\nSUMMARY:\r\n✔ 6 tests completed\r\n✖ 2 tests failed\r\n\r\nFAILED TESTS:\r\n  CountdownForm\r\n    ✖ should call onSetCountdown if valid seconds entered\r\n      Chrome 63.0.3239 (Linux 0.0.0)\r\n    Error: Script error. (:0)\r\n        at Object.invokeGuardedCallbackDev (webpack-internal:///77:581:16)\r\n        at Object.invokeGuardedCallback (webpack-internal:///77:438:27)\r\n        at Object.invokeGuardedCallbackAndCatchFirstError (webpack-internal:///77:452:43)\r\n        at executeDispatch (webpack-internal:///77:836:19)\r\n        at executeDispatchesInOrder (webpack-internal:///77:858:5)\r\n        at executeDispatchesAndRelease (webpack-internal:///77:956:5)\r\n        at executeDispatchesAndReleaseSimulated (webpack-internal:///77:964:10)\r\n        at forEachAccumulated (webpack-internal:///77:937:8)\r\n        at Object.processEventQueue (webpack-internal:///77:1110:5)\r\n\r\n    ✖ should call onSetCountdown if valid seconds entered \r\n      Chrome 63.0.3239 (Linux 0.0.0)\r\n    Error: Script error. (:0)\r\n        at Object.invokeGuardedCallbackDev (webpack-internal:///77:581:16)\r\n        at Object.invokeGuardedCallback (webpack-internal:///77:438:27)\r\n        at Object.invokeGuardedCallbackAndCatchFirstError (webpack-internal:///77:452:43)\r\n        at executeDispatch (webpack-internal:///77:836:19)\r\n        at executeDispatchesInOrder (webpack-internal:///77:858:5)\r\n        at executeDispatchesAndRelease (webpack-internal:///77:956:5)\r\n        at executeDispatchesAndReleaseSimulated (webpack-internal:///77:964:10)\r\n        at forEachAccumulated (webpack-internal:///77:937:8)\r\n        at Object.processEventQueue (webpack-internal:///77:1110:5)\r\n\r\n07 01 2018 00:07:56.223:WARN [launcher]: Chrome was not killed in 2000 ms, sending SIGKILL.\r\n```\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nI am using Ubuntu 16-04 and Chrome Version 63.0.3239.108 (Official Build) (64-bit). And below from my package.json\r\n\r\n```\r\n    react\": \"^16.0.0\",\r\n    \"react-dom\": \"^16.0.0\",\r\n    \"react-router\": \"^4.2.0\",\r\n    \"react-router-dom\": \"^4.2.2\",\r\n    \"karma\": \"^1.7.1\",\r\n    \"karma-chrome-launcher\": \"^2.2.0\",\r\n    \"karma-mocha\": \"^1.3.0\",\r\n    \"karma-mocha-reporter\": \"^2.2.5\",\r\n    \"karma-sourcemap-loader\": \"^0.3.7\",\r\n    \"karma-webpack\": \"^2.0.6\",\r\n    \"mocha\": \"^4.0.1\",    \r\n    \"webpack\": \"^3.8.1\"`\r\n```\r\n\r\n  ",
  "closed_by": null
}

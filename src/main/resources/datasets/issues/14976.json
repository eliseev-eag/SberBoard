{
  "url": "https://api.github.com/repos/facebook/react/issues/14976",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14976/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14976/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14976/events",
  "html_url": "https://github.com/facebook/react/issues/14976",
  "id": 415593946,
  "node_id": "MDU6SXNzdWU0MTU1OTM5NDY=",
  "number": 14976,
  "title": "Varying number of hook calls",
  "user": {
    "login": "noobG",
    "id": 9032452,
    "node_id": "MDQ6VXNlcjkwMzI0NTI=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/9032452?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/noobG",
    "html_url": "https://github.com/noobG",
    "followers_url": "https://api.github.com/users/noobG/followers",
    "following_url": "https://api.github.com/users/noobG/following{/other_user}",
    "gists_url": "https://api.github.com/users/noobG/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/noobG/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/noobG/subscriptions",
    "organizations_url": "https://api.github.com/users/noobG/orgs",
    "repos_url": "https://api.github.com/users/noobG/repos",
    "events_url": "https://api.github.com/users/noobG/events{/privacy}",
    "received_events_url": "https://api.github.com/users/noobG/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-02-28T12:12:53Z",
  "updated_at": "2019-02-28T13:55:37Z",
  "closed_at": "2019-02-28T13:34:11Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\nFeature\r\n\r\n**What is the current behavior?**\r\nI understand React relies on call order when using hooks, but I don't understand why I'm not allowed to call an arbitrary number of (some) hooks as long as I preserve call order\r\n\r\nI'm making a tooltip component with an \"open\" prop that also awaits a \"target\" ref before rendering:\r\n\r\nWhat I tried:\r\n```\r\nexport default props => {\r\n\t// Set up lifecycle callbacks - makes perfect sense to me that this has to be called before any return statements\r\n\tuseEffect(...) \r\n\r\n\tif (!props.open) return null;\r\n\t// I can safely use \"props.target\" below this point...\r\n\tif (!props.target) return null; \r\n\r\n\tconst { x, y } = props.target.getBoundingClientRect(); \r\n\r\n\tconst style = useMemo(..., [x, y]);\r\n\r\n\treturn ...\r\n}\r\n```\r\n\r\nTo avoid an error about \"fewer/more hooks called than previous render\", I have to refactor the above into the following:\r\n```\r\nexport default props => {\r\n\tuseEffect(...)\r\n\r\n\t// Now I have to code defensively because I can't guarantee target is defined...\r\n\tconst { x, y } = props.target ? props.target.getBoundingClientRect() : {};\r\n\r\n\t// I also have to code defensively in the useMemo handler because now x and y can be undefined\r\n\tconst style = useMemo(..., [x, y]); \r\n\r\n\t// And now my return values are down here, which isn't necessarily where I want them to be if I want to \"section\" my code a certain way\r\n\tif (!props.open) return null;\r\n\tif (!props.target) return null;\r\n\r\n\treturn ...\r\n}\r\n```\r\nI understand why I need to declare \"lifecycle hooks\" like useEffect before any return statements, but I don't understand why certain hooks like useMemo and useCallback have to adhere to the same principle.\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

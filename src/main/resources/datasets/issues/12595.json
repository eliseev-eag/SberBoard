{
  "url": "https://api.github.com/repos/facebook/react/issues/12595",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/12595/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/12595/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/12595/events",
  "html_url": "https://github.com/facebook/react/issues/12595",
  "id": 312976106,
  "node_id": "MDU6SXNzdWUzMTI5NzYxMDY=",
  "number": 12595,
  "title": "Can't use AsyncStorage or Fetch inside getDerivedStateFromProps",
  "user": {
    "login": "sfyfedotcom",
    "id": 10885475,
    "node_id": "MDQ6VXNlcjEwODg1NDc1",
    "avatar_url": "https://avatars0.githubusercontent.com/u/10885475?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sfyfedotcom",
    "html_url": "https://github.com/sfyfedotcom",
    "followers_url": "https://api.github.com/users/sfyfedotcom/followers",
    "following_url": "https://api.github.com/users/sfyfedotcom/following{/other_user}",
    "gists_url": "https://api.github.com/users/sfyfedotcom/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sfyfedotcom/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sfyfedotcom/subscriptions",
    "organizations_url": "https://api.github.com/users/sfyfedotcom/orgs",
    "repos_url": "https://api.github.com/users/sfyfedotcom/repos",
    "events_url": "https://api.github.com/users/sfyfedotcom/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sfyfedotcom/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-04-10T15:30:46Z",
  "updated_at": "2018-04-10T15:35:08Z",
  "closed_at": "2018-04-10T15:35:08Z",
  "author_association": "NONE",
  "body": "I'm trying to migrate from using `componentWillReceiveProps` to `getDerivedStateFromProps`.\r\n\r\nI'm using [Tab Navigation](https://reactnavigation.org/docs/tab-based-navigation.html), adding a `route_index` property to the state with `onNavigationStateChange`. Then in the screen file for each tab, I detect if we're on the correct index and if so, load a value from storage and then fetch some data from an API. Here's how I'm currently doing this inside the tab's screen:\r\n\r\n```\r\nUNSAFE_componentWillReceiveProps (newProps) {\r\n    if (newProps.screenProps.route_index === 2) {\r\n      AsyncStorage.getItem('MyBar')\r\n      .then(myBarID => {\r\n        if (myBarID) {\r\n          GetBars(myBarID, (err, bars) => {\r\n            if (err) {\r\n              console.error(err)\r\n            } else if (bars && bars.length) {\r\n              this.setState(prev => {\r\n                prev.loadingBar = false\r\n                prev.myBar = bars[0]\r\n                return prev\r\n              })\r\n            }\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n```\r\n\r\nBut using the new `getDerivedStateFromProps` static function, it doesn't seem to be able to update the state within AsyncStorage or Fetch (`GetBars` is an imported service which is just a wrapper function for a fetch call against an API):\r\n\r\n```\r\n  static getDerivedStateFromProps (newProps, prevState) {\r\n    if (newProps.screenProps.route_index === 2) {\r\n      AsyncStorage.getItem('MyBar')\r\n      .then(myBarID => {\r\n        if (myBarID) {\r\n          GetBars(myBarID, (err, bars) => {\r\n            if (err) {\r\n              console.error(err)\r\n              return null\r\n            } else if (bars && bars.length) {\r\n              return { loadingBar: false, myBar: bars[0] }\r\n            } else {\r\n              return null\r\n            }\r\n          })\r\n        } else {\r\n          return null\r\n        }\r\n      })\r\n    } else {\r\n      return null\r\n    }\r\n  }\r\n```\r\n\r\nI tried using `componentWillMount`, but it only fires the first time the tab is loaded. I need to do an Storage and API call every time the user changes to a tab.",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

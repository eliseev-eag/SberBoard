{
  "url": "https://api.github.com/repos/facebook/react/issues/14262",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14262/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14262/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14262/events",
  "html_url": "https://github.com/facebook/react/issues/14262",
  "id": 381910682,
  "node_id": "MDU6SXNzdWUzODE5MTA2ODI=",
  "number": 14262,
  "title": "Hooks API - hook breaks when exported from module",
  "user": {
    "login": "pdeona",
    "id": 29342769,
    "node_id": "MDQ6VXNlcjI5MzQyNzY5",
    "avatar_url": "https://avatars2.githubusercontent.com/u/29342769?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pdeona",
    "html_url": "https://github.com/pdeona",
    "followers_url": "https://api.github.com/users/pdeona/followers",
    "following_url": "https://api.github.com/users/pdeona/following{/other_user}",
    "gists_url": "https://api.github.com/users/pdeona/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pdeona/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pdeona/subscriptions",
    "organizations_url": "https://api.github.com/users/pdeona/orgs",
    "repos_url": "https://api.github.com/users/pdeona/repos",
    "events_url": "https://api.github.com/users/pdeona/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pdeona/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-11-17T23:16:18Z",
  "updated_at": "2019-02-25T02:01:44Z",
  "closed_at": "2018-11-18T15:43:29Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\nBug\r\n\r\n**What is the current behavior?**\r\nI wrote a hook similar to the example in the following article:\r\nhttps://medium.com/@dan_abramov/making-sense-of-react-hooks-fdbde8803889\r\n\r\nWhen placed in a module and imported into another package, the following is thrown:\r\n\r\nHooks can only be called inside the body of a function component.\r\n\r\nI can confirm the same code (exactly the same) works when placed into the calling app and imported (i.e., `import withHook from src/hooks` works with the same definition for the hook, if the hook is in `src/hooks/index.js` instead of a `node_module`)\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nThe transpiled module: \r\n\r\n```js\r\n// index.js\r\n\r\nimport _slicedToArray from \"/Users/pdeona/Desktop/react-hook-test/hooks-test/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\r\nimport { useEffect, useState } from 'react';\r\nexport default (function () {\r\n  var _useState = useState(0),\r\n      _useState2 = _slicedToArray(_useState, 2),\r\n      state = _useState2[0],\r\n      setState = _useState2[1];\r\n\r\n  useEffect(function () {\r\n    console.log('hooked');\r\n  });\r\n  return [state, setState];\r\n});\r\n```\r\n\r\nThe app calling the hook: (created with CRNA 2, installed React, ReactDOM @next)\r\n\r\n```js\r\nimport React from 'react';\r\nimport withHook from 'withHook'\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\n\r\nfunction App () {\r\n  const [s, setS] = withHook()\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <p>\r\n          Edit <code>src/App.js</code> and save to reload.\r\n        </p>\r\n        <a\r\n          className=\"App-link\"\r\n          href=\"https://reactjs.org\"\r\n          target=\"_blank\"\r\n          rel=\"noopener noreferrer\"\r\n        >\r\n          Learn React\r\n        </a>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n```\r\n\r\n**What is the expected behavior?**\r\n\r\nThe hook runs.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\ntested on Chrome 71, server on Node 10.13.0\r\n\r\nmodule package.json:\r\n```\r\n{\r\n  \"name\": \"withHook\",\r\n  \"version\": \"0.0.1\",\r\n  \"description\": \"\",\r\n  \"main\": \"dist/index.js\",\r\n  \"scripts\": {\r\n    \"build\": \"babel index.js --out-dir dist --preset env\"\r\n  },\r\n  \"keywords\": [],\r\n  \"author\": \"\",\r\n  \"license\": \"ISC\",\r\n  \"dependencies\": {\r\n    \"@babel/cli\": \"^7.1.5\",\r\n    \"@babel/core\": \"^7.1.6\",\r\n    \"@babel/preset-env\": \"^7.1.6\",\r\n    \"react\": \"^16.7.0-alpha.2\"\r\n  }\r\n}\r\n\r\n```\r\n\r\napp package.json:\r\n\r\n```\r\n{\r\n  \"name\": \"hooks-test\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"dependencies\": {\r\n    \"react\": \"^16.7.0-alpha.2\",\r\n    \"react-dom\": \"^16.7.0-alpha.2\",\r\n    \"react-scripts\": \"2.1.1\",\r\n    \"withHook\": \"0.0.1\"\r\n  },\r\n  \"scripts\": {\r\n    \"start\": \"react-scripts start\",\r\n    \"build\": \"react-scripts build\",\r\n    \"test\": \"react-scripts test\",\r\n    \"eject\": \"react-scripts eject\"\r\n  },\r\n  \"eslintConfig\": {\r\n    \"extends\": \"react-app\"\r\n  },\r\n  \"browserslist\": [\r\n    \">0.2%\",\r\n    \"not dead\",\r\n    \"not ie <= 11\",\r\n    \"not op_mini all\"\r\n  ]\r\n}\r\n```",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/8560",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/8560/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/8560/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/8560/events",
  "html_url": "https://github.com/facebook/react/pull/8560",
  "id": 195113240,
  "node_id": "MDExOlB1bGxSZXF1ZXN0OTc2NTQwMzM=",
  "number": 8560,
  "title": "ReactNative fiber renderer",
  "user": {
    "login": "bvaughn",
    "id": 29597,
    "node_id": "MDQ6VXNlcjI5NTk3",
    "avatar_url": "https://avatars0.githubusercontent.com/u/29597?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bvaughn",
    "html_url": "https://github.com/bvaughn",
    "followers_url": "https://api.github.com/users/bvaughn/followers",
    "following_url": "https://api.github.com/users/bvaughn/following{/other_user}",
    "gists_url": "https://api.github.com/users/bvaughn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bvaughn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bvaughn/subscriptions",
    "organizations_url": "https://api.github.com/users/bvaughn/orgs",
    "repos_url": "https://api.github.com/users/bvaughn/repos",
    "events_url": "https://api.github.com/users/bvaughn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bvaughn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "sophiebits",
    "id": 6820,
    "node_id": "MDQ6VXNlcjY4MjA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6820?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sophiebits",
    "html_url": "https://github.com/sophiebits",
    "followers_url": "https://api.github.com/users/sophiebits/followers",
    "following_url": "https://api.github.com/users/sophiebits/following{/other_user}",
    "gists_url": "https://api.github.com/users/sophiebits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sophiebits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sophiebits/subscriptions",
    "organizations_url": "https://api.github.com/users/sophiebits/orgs",
    "repos_url": "https://api.github.com/users/sophiebits/repos",
    "events_url": "https://api.github.com/users/sophiebits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sophiebits/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "sophiebits",
      "id": 6820,
      "node_id": "MDQ6VXNlcjY4MjA=",
      "avatar_url": "https://avatars2.githubusercontent.com/u/6820?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sophiebits",
      "html_url": "https://github.com/sophiebits",
      "followers_url": "https://api.github.com/users/sophiebits/followers",
      "following_url": "https://api.github.com/users/sophiebits/following{/other_user}",
      "gists_url": "https://api.github.com/users/sophiebits/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sophiebits/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sophiebits/subscriptions",
      "organizations_url": "https://api.github.com/users/sophiebits/orgs",
      "repos_url": "https://api.github.com/users/sophiebits/repos",
      "events_url": "https://api.github.com/users/sophiebits/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sophiebits/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2016-12-12T23:10:02Z",
  "updated_at": "2016-12-15T16:51:52Z",
  "closed_at": "2016-12-15T04:05:17Z",
  "author_association": "CONTRIBUTOR",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/8560",
    "html_url": "https://github.com/facebook/react/pull/8560",
    "diff_url": "https://github.com/facebook/react/pull/8560.diff",
    "patch_url": "https://github.com/facebook/react/pull/8560.patch"
  },
  "body": "This PR adds a new, fiber-based renderer for native dubbed `ReactNativeFiber`. Existing native renderer has been renamed to `ReactNativeStack` and a new flags file `ReactNativeFeatureFlags` has been added to switch between the 2 renderers. (Other than injecting a `findNodeHandle` strategy `ReactNativeStack` has not been modified.)\r\n\r\nI've done some basic smoke-testings with Android and iOS and the fiber renderer seems to work well with the following applications: Catalyst, Ads Manager, and Facebook \"Events\" tab.\r\n\r\nI have also added/enhanced Flow types for `UIManager` with this PR. If it's desirable for that work to be split into a separate PR, let me know and I can break it off.\r\n\r\n## Known issues\r\n\r\n* The inspector does not work with the Fiber-based renderer. TheÂ react-native `InspectorUtils.getOwnerHierarchy` reaches into stack internals in a way that is not Fiber-compatible and causes a runtime error.\r\n* Testing various internal apps yields the following:\r\n  * Facebook app Events page seems fine.\r\n  * Catalyst seems mostly fine, but errors with \"_Unexpected context pop_\" when I open the \"App - UIExplorer Browser\" component.\r\n  * Ads Manager errors with \"_Unexpected context pop_\" on some pages.\r\n\r\n## Open question: How should we handle children?\r\n\r\n`ReactNativeFiber` currently creates wrapper objects to bundle each native tag with its children and `viewConfig`. This creates one wrapper object per native view which may be undesirable. We _could_ remove the wrapper object but we would need to pass some additional information to the `HostConfig` methods:\r\n* ~~Pass `type` to the following methods: `commitUpdate`. (This is necessary to get the `viewConfig` for `validAttributes` and `uiViewClassName`.)~~ **Update** Already done via PR #8563. However `viewConfig` can't be removed for the time being because `NativeMethodsMixin` depends on it.\r\n* Pass `children` to the following methods: `appendChild`, `finalizeInitialChildren`, `insertBefore`, `removeChild`. (This is necessary to add/set/move/remove children.)\r\n* Provide a hook to recursively call remove children (so that we can uncache all child nodes). (Without this the `RCTUIManager` errors with \"_Invalid view set to be the JS responder_\".)\r\n\r\nAs for tracking the `children` array there are 2 options to consider:\r\n\r\n### Option 1: Manage index information in Fiber\r\n\r\nFiber has enough information to pass the additional params to the `HostConfig` but it would need to calculate and/or store the child information in order to do so. The benefit provided to `ReactNativeFiber` may be outweighed by Fiber having to do this for other renderers that don't require the information.\r\n\r\n### Option 2: Update native bridge\r\n\r\nA better solution to this issue might be to change the iOS and Android bridges to move away from the index-based add/remove methods.\r\n\r\nFor example, iOS provides methods that could be used instead of our current index-based ones:\r\n* [`addSubview`](https://developer.apple.com/reference/uikit/uiview/1622616-addsubview) for `appendChild`\r\n* [`insertSubview(_:aboveSubview:)`](https://developer.apple.com/reference/uikit/uiview/1622570-inseratsubview) for `insertBefore`\r\n* [`removeFromSuperview`](https://developer.apple.com/reference/uikit/uiview/1622421-removefromsuperview) for `removeChild`\r\n\r\nThis would also need to be supported on the Android side, perhaps with the following methods:\r\n* [`addView`](https://developer.android.com/reference/android/view/ViewManager.html#addView) for `appendChild`\r\n* [`View` `getZ` and `setZ` methods](https://developer.android.com/reference/android/view/View.html#Z) for `insertBefore` (_should verify with someone more familiar with Android_)\r\n* [`removeView`](https://developer.android.com/reference/android/view/ViewManager.html#removeView) for `removeChild`",
  "closed_by": {
    "login": "bvaughn",
    "id": 29597,
    "node_id": "MDQ6VXNlcjI5NTk3",
    "avatar_url": "https://avatars0.githubusercontent.com/u/29597?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bvaughn",
    "html_url": "https://github.com/bvaughn",
    "followers_url": "https://api.github.com/users/bvaughn/followers",
    "following_url": "https://api.github.com/users/bvaughn/following{/other_user}",
    "gists_url": "https://api.github.com/users/bvaughn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bvaughn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bvaughn/subscriptions",
    "organizations_url": "https://api.github.com/users/bvaughn/orgs",
    "repos_url": "https://api.github.com/users/bvaughn/repos",
    "events_url": "https://api.github.com/users/bvaughn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bvaughn/received_events",
    "type": "User",
    "site_admin": false
  }
}

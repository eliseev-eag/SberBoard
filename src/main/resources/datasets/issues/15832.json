{
  "url": "https://api.github.com/repos/facebook/react/issues/15832",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15832/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15832/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15832/events",
  "html_url": "https://github.com/facebook/react/pull/15832",
  "id": 452884525,
  "node_id": "MDExOlB1bGxSZXF1ZXN0Mjg1Njg0NzAz",
  "number": 15832,
  "title": "[Fresh] Capture Hook signatures lazily on first render",
  "user": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-06-06T07:58:28Z",
  "updated_at": "2019-06-06T17:53:25Z",
  "closed_at": "2019-06-06T17:53:13Z",
  "author_association": "MEMBER",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/15832",
    "html_url": "https://github.com/facebook/react/pull/15832",
    "diff_url": "https://github.com/facebook/react/pull/15832.diff",
    "patch_url": "https://github.com/facebook/react/pull/15832.patch"
  },
  "body": "We compare \"signatures\" of components on a hot update to decide whether to preserve or throw away the state. Signatures are created from the order of Hook calls at build time. They include references to nested Hooks themselves, since a reorder inside a custom Hook should remount components containing it. But when do we read those references?\r\n\r\nPreviously, nested Hook call signatures were computed during the hot update, just before comparison with the next version. However, it's too late on React Native because of inline requires. `[useFoo]` becomes `[require('useFoo')]` so during hot update, we compare the next version with itself.\r\n\r\nThe fix is to make the signing resilient to timing. We now capture the list of Hooks during the first render of a component of a given type, instead of during the next hot update. To do this, I'm introducing another function call layer. The wrapper function is still used for wrapping â€” but also repurposed for marking the first render (and forcing signature calculation at that time). On next renders it becomes a noop. You can see the new compiled output in snapshots.\r\n\r\nI verified this solves the problem on RN. Editing Hooks in another file now correctly resets state, but only if you change the inner Hook call order.",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

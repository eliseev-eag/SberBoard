{
  "url": "https://api.github.com/repos/facebook/react/issues/17048",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/17048/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/17048/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/17048/events",
  "html_url": "https://github.com/facebook/react/issues/17048",
  "id": 504441649,
  "node_id": "MDU6SXNzdWU1MDQ0NDE2NDk=",
  "number": 17048,
  "title": "Bailouts for state updates behavior inconsistently for hooks",
  "user": {
    "login": "zxh19890103",
    "id": 11514991,
    "node_id": "MDQ6VXNlcjExNTE0OTkx",
    "avatar_url": "https://avatars1.githubusercontent.com/u/11514991?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zxh19890103",
    "html_url": "https://github.com/zxh19890103",
    "followers_url": "https://api.github.com/users/zxh19890103/followers",
    "following_url": "https://api.github.com/users/zxh19890103/following{/other_user}",
    "gists_url": "https://api.github.com/users/zxh19890103/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zxh19890103/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zxh19890103/subscriptions",
    "organizations_url": "https://api.github.com/users/zxh19890103/orgs",
    "repos_url": "https://api.github.com/users/zxh19890103/repos",
    "events_url": "https://api.github.com/users/zxh19890103/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zxh19890103/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2019-10-09T06:23:28Z",
  "updated_at": "2019-10-15T15:47:54Z",
  "closed_at": null,
  "author_association": "NONE",
  "body": "This is a bug I think.\r\n\r\nAs the title says, React didn't help me to merge the update requests.\r\n\r\n```js\r\nconst Player = ({ }) => {\r\n  const [name, setName] = useState('John Higgins',)\r\n  const [age, setAge] = useState(47)\r\n  const nextPlayer = () => {\r\n    setName('Mark Selby')\r\n    setAge(34)\r\n  }\r\n  console.log('render.')\r\n  return <p>\r\n    This player's name is {name}, {age} years.\r\n    <button type=\"button\" onClick={nextPlayer}>next</button>\r\n  </p>\r\n}\r\n```\r\n\r\nAfter the button clicked, it outputs:\r\n\r\n```shell\r\n>> render.\r\n>> render.\r\n```\r\n\r\nBut in fact, I got three.\r\n\r\n```shell\r\n>> render.\r\n>> render.\r\n>> render.\r\n```\r\n\r\nIt doesn't always be.\r\n\r\n\r\n## The actual code\r\n\r\n```ts\r\nconst List = ({}) => {\r\n\tconst [items, setItems] = useState<ListItem[]>([])\r\n\tconst [tick, setTick] = useState(0)\r\n\tconst [page, setPage] = useState(1)\r\n        \r\n        // # effect 001\r\n\tuseEffect(() => {\r\n           const refresh = tick > 1\r\n           load({ refresh, page })\r\n             .then(d => {\r\n                if (refresh) setItems(d) // replace\r\n                else setItems([...items, ...d]) // append\r\n             })\r\n        }, [tick, page])\r\n\r\n        // # effect 002\r\n        useEffect(() => {\r\n            testingScrollToBottom(() => {\r\n               setTick(0) // makes effect 001 applied.\r\n               setPage(page + 1) // makes effect 001 applied again.\r\n            })\r\n            return () => {\r\n                stopTestingScrollToBottom()\r\n            }\r\n        }, [page])\r\n        \r\n        return (\r\n            <div>\r\n                <button\r\n                    onClick={() => {\r\n                        setTick(tick + 1)\r\n                        setPage(1)\r\n                    }}>\r\n                    Refresh\r\n                </button>\r\n                { items.map(item => <Item item={item}/>) }\r\n            </div>\r\n        )\r\n}\r\n```\r\n\r\nFunction `testingScrollToBottom` is where the things happened. \r\n\r\nHere is what I did to avoid that:\r\n\r\n![image](https://user-images.githubusercontent.com/11514991/66693450-7a93a480-ecdb-11e9-80e4-4ee6caf931e8.png)\r\n\r\nBy the way, `testingScrollToBottom` uses `setTimeout`.",
  "closed_by": null
}

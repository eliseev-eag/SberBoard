{
  "url": "https://api.github.com/repos/facebook/react/issues/8619",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/8619/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/8619/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/8619/events",
  "html_url": "https://github.com/facebook/react/issues/8619",
  "id": 197064256,
  "node_id": "MDU6SXNzdWUxOTcwNjQyNTY=",
  "number": 8619,
  "title": "Refs callback is called twice on every render, even when component instance is reused",
  "user": {
    "login": "natevw",
    "id": 265902,
    "node_id": "MDQ6VXNlcjI2NTkwMg==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/265902?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/natevw",
    "html_url": "https://github.com/natevw",
    "followers_url": "https://api.github.com/users/natevw/followers",
    "following_url": "https://api.github.com/users/natevw/following{/other_user}",
    "gists_url": "https://api.github.com/users/natevw/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/natevw/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/natevw/subscriptions",
    "organizations_url": "https://api.github.com/users/natevw/orgs",
    "repos_url": "https://api.github.com/users/natevw/repos",
    "events_url": "https://api.github.com/users/natevw/events{/privacy}",
    "received_events_url": "https://api.github.com/users/natevw/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2016-12-22T00:10:34Z",
  "updated_at": "2017-07-06T16:27:20Z",
  "closed_at": "2017-07-03T12:53:23Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\n\r\nBug, perhaps just in documentation.\r\n\r\n**What is the current behavior?**\r\n\r\nThe documentation for [Refs and the DOM](https://facebook.github.io/react/docs/refs-and-the-dom.html) says:\r\n\r\n> The ref attribute takes a callback function, and the callback will be executed immediately after the component is mounted or unmounted.\r\n\r\nBut if I create a stateful component like:\r\n\r\n```\r\nclass ScrollHelper extends React.PureComponent {\r\n  \r\n  componentDidMount() {\r\n    console.log(\"ScrollHelper componentDidMount\")\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    console.log(\"ScrollHelper componentWillUnmount\")\r\n  }\r\n  \r\n  render() {\r\n    console.log(\"ScrollHelper render\")\r\n    return <div/>\r\n}\r\n```\r\n\r\nand use it via `<ScrollHelper ref={(obj) => console.log(\"ScrollHelper ref\", obj)}/>` within an app, I do not see the behavior documented, but rather the following pattern of logs:\r\n\r\n> // [first render]\r\n> ScrollHelper render\r\n> ScrollHelper componentDidMount\r\n> ScrollHelper ref \\<{props: etc…}>\r\n> // [some data changes elsewhere in the app]\r\n> ScrollHelper ref \\<null>\r\n> ScrollHelper render\r\n> ScrollHelper ref \\<{props: etc…}>\r\n> // [some data changes elsewhere in the app, again…]\r\n> ScrollHelper ref \\<null>\r\n> ScrollHelper render\r\n> ScrollHelper ref \\<{props: etc…}>\r\n> // [some data changes causing the ScrollHelper to actually unmount]\r\n> ScrollHelper ref \\<null>\r\n> ScrollHelper componentWillUnmount\r\n\r\n\r\n**What is the expected behavior?**\r\n\r\nAccording to the docs, I would expect my `refs` callback to be called exactly **two** times during the events above — once (with the component) after the \"ScrollHelper componentDidMount\" and once (with `null`) before the \"ScrollHelper componentWillUnmount\". Instead it gets \"reset\" basically every time the page is re-rendered — even though it's pretty clearly ending up with the same component instance each time! (I verified this is true via some additional code as well, but should be evident from the lack of additional \"componentDidMount\" logs anyway.)\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nreact@15.4.1, no idea what the behavior was earlier.\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

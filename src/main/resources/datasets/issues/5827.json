{
  "url": "https://api.github.com/repos/facebook/react/issues/5827",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/5827/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/5827/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/5827/events",
  "html_url": "https://github.com/facebook/react/issues/5827",
  "id": 126062065,
  "node_id": "MDU6SXNzdWUxMjYwNjIwNjU=",
  "number": 5827,
  "title": "Using Immutable state breaks TestUtils.Simulate",
  "user": {
    "login": "jpiv",
    "id": 10170807,
    "node_id": "MDQ6VXNlcjEwMTcwODA3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/10170807?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jpiv",
    "html_url": "https://github.com/jpiv",
    "followers_url": "https://api.github.com/users/jpiv/followers",
    "following_url": "https://api.github.com/users/jpiv/following{/other_user}",
    "gists_url": "https://api.github.com/users/jpiv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jpiv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jpiv/subscriptions",
    "organizations_url": "https://api.github.com/users/jpiv/orgs",
    "repos_url": "https://api.github.com/users/jpiv/repos",
    "events_url": "https://api.github.com/users/jpiv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jpiv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2016-01-11T23:26:37Z",
  "updated_at": "2016-01-12T02:10:02Z",
  "closed_at": "2016-01-12T02:10:02Z",
  "author_association": "NONE",
  "body": "I have a simple react component that has some checkbox inputs in a table.  For this component I an managing state using an Immutable library like is described here https://facebook.github.io/react/docs/advanced-performance.html.  \n\nI have a simple handleChange listener that updates the state of the component that looks like this:\n\n```\nhandleChange(e) {\n    console.log('handling change')\n\n    this.state = this.state.merge({\n        selectedChannels: 232,\n        audienceSize: 23\n    });\n    this.forceUpdate();\n}\n```\n\nI am attempting to Simulate an onChange event on this component using TestUtils.Simulate.change like so:\n\n```\nimport React from 'react';\nimport TestUtils from 'react/lib/ReactTestUtils';\nimport ChannelsTable from '../../app/components/ChannelsTable/index.jsx';\n\ndescribe('ChanneslTable', () => {\n    let ChannelsTableComponent;\n    let inputs;\n    let testOnChange = sinon.spy();\n    before(() => {\n        ChannelsTableComponent = TestUtils.renderIntoDocument(<ChannelsTable onChange={ testOnChange } />);\n        inputs = TestUtils\n            .scryRenderedDOMComponentsWithTag(ChannelsTableComponent, 'input');\n    });\n    it('Max Audience size should increase when a channel is selected', () => {\n        TestUtils.Simulate.change(inputs[0]);\n        TestUtils.Simulate.change(inputs[0]);\n    });\n});\n```\n\nWhen running the test handleChange is only called once and \"handling change\" is only logged one time.  If I remove either the `this.forceUpdate()` line or the line where I am setting the state, both changes are simulating successfully and \"handling change\" is logged out twice.\n\nThis is simplified version of the code that brought this to my attention but, produces the same results none the less.  I've been racking my brain all day trying to figure out what's causing this and unfortunately have had no success remedying this issue.\n",
  "closed_by": {
    "login": "jpiv",
    "id": 10170807,
    "node_id": "MDQ6VXNlcjEwMTcwODA3",
    "avatar_url": "https://avatars3.githubusercontent.com/u/10170807?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jpiv",
    "html_url": "https://github.com/jpiv",
    "followers_url": "https://api.github.com/users/jpiv/followers",
    "following_url": "https://api.github.com/users/jpiv/following{/other_user}",
    "gists_url": "https://api.github.com/users/jpiv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jpiv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jpiv/subscriptions",
    "organizations_url": "https://api.github.com/users/jpiv/orgs",
    "repos_url": "https://api.github.com/users/jpiv/repos",
    "events_url": "https://api.github.com/users/jpiv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jpiv/received_events",
    "type": "User",
    "site_admin": false
  }
}

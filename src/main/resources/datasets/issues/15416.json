{
  "url": "https://api.github.com/repos/facebook/react/issues/15416",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15416/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15416/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15416/events",
  "html_url": "https://github.com/facebook/react/issues/15416",
  "id": 433114466,
  "node_id": "MDU6SXNzdWU0MzMxMTQ0NjY=",
  "number": 15416,
  "title": "How to test multiple state changes with act?",
  "user": {
    "login": "dirv",
    "id": 307047,
    "node_id": "MDQ6VXNlcjMwNzA0Nw==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/307047?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dirv",
    "html_url": "https://github.com/dirv",
    "followers_url": "https://api.github.com/users/dirv/followers",
    "following_url": "https://api.github.com/users/dirv/following{/other_user}",
    "gists_url": "https://api.github.com/users/dirv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dirv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dirv/subscriptions",
    "organizations_url": "https://api.github.com/users/dirv/orgs",
    "repos_url": "https://api.github.com/users/dirv/repos",
    "events_url": "https://api.github.com/users/dirv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dirv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 139734344,
      "node_id": "MDU6TGFiZWwxMzk3MzQzNDQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/Component:%20Test%20Utils",
      "name": "Component: Test Utils",
      "color": "eb6420",
      "default": false
    },
    {
      "id": 40929155,
      "node_id": "MDU6TGFiZWw0MDkyOTE1NQ==",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Question",
      "name": "Type: Question",
      "color": "cc317c",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "threepointone",
    "id": 18808,
    "node_id": "MDQ6VXNlcjE4ODA4",
    "avatar_url": "https://avatars2.githubusercontent.com/u/18808?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/threepointone",
    "html_url": "https://github.com/threepointone",
    "followers_url": "https://api.github.com/users/threepointone/followers",
    "following_url": "https://api.github.com/users/threepointone/following{/other_user}",
    "gists_url": "https://api.github.com/users/threepointone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/threepointone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/threepointone/subscriptions",
    "organizations_url": "https://api.github.com/users/threepointone/orgs",
    "repos_url": "https://api.github.com/users/threepointone/repos",
    "events_url": "https://api.github.com/users/threepointone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/threepointone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "threepointone",
      "id": 18808,
      "node_id": "MDQ6VXNlcjE4ODA4",
      "avatar_url": "https://avatars2.githubusercontent.com/u/18808?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/threepointone",
      "html_url": "https://github.com/threepointone",
      "followers_url": "https://api.github.com/users/threepointone/followers",
      "following_url": "https://api.github.com/users/threepointone/following{/other_user}",
      "gists_url": "https://api.github.com/users/threepointone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/threepointone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/threepointone/subscriptions",
      "organizations_url": "https://api.github.com/users/threepointone/orgs",
      "repos_url": "https://api.github.com/users/threepointone/repos",
      "events_url": "https://api.github.com/users/threepointone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/threepointone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-04-15T06:29:03Z",
  "updated_at": "2019-04-15T12:17:47Z",
  "closed_at": "2019-04-15T12:11:17Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\nBug\r\n\r\n**What is the current behavior?**\r\nWith the new `act` function, I'm unsure how to test state transitions that occur _during_ an event handler processing. For example if I have this handler that is called on form submission:\r\n\r\n```\r\nconst [isSubmitting, setIsSubmitting] = useState(false);\r\nconst handleSubmit = async () => {\r\n  setIsSubmitting(true);\r\n  await fetcher();\r\n  setIsSubmitting(false);\r\n};\r\n\r\n```\r\nthen I want to be able to test that `isSubmitting` state is indeed set to true before `fetcher` is called.\r\n\r\nDue to the nature of `act` (I believe it defers all state changes until after its provided function has been run) I'm not sure that this is currently possible?\r\n\r\nPreviously I've been testing using `await new Promise(setTimeout)` to flush the current runtime task queue, which works fine for this use case.\r\n\r\nI _have_ found a way to make this work without triggering the `act` warning, but it feels like a hack. I have to wrap `act` around my expectation, not the submit.\r\n\r\n```\r\nit('displays indicator when form is submitting', async () => {\r\n  ReactTestUtils.Simulate.submit(form());\r\n  await act(async () => {\r\n    expect(container.querySelector('.submittingIndicator')).not.toBeNull();\r\n  });\r\n});\r\n```\r\n\r\nI've provided this test in a repo together with a couple of other tests which complete the feature - see the link below.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nhttps://github.com/dirv/react-act-toggle-state\r\n\r\n**What is the expected behavior?**\r\nThere's a way for me to test this which doesn't feel like a hack.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n16.9.0-alpha.0",
  "closed_by": {
    "login": "threepointone",
    "id": 18808,
    "node_id": "MDQ6VXNlcjE4ODA4",
    "avatar_url": "https://avatars2.githubusercontent.com/u/18808?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/threepointone",
    "html_url": "https://github.com/threepointone",
    "followers_url": "https://api.github.com/users/threepointone/followers",
    "following_url": "https://api.github.com/users/threepointone/following{/other_user}",
    "gists_url": "https://api.github.com/users/threepointone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/threepointone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/threepointone/subscriptions",
    "organizations_url": "https://api.github.com/users/threepointone/orgs",
    "repos_url": "https://api.github.com/users/threepointone/repos",
    "events_url": "https://api.github.com/users/threepointone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/threepointone/received_events",
    "type": "User",
    "site_admin": false
  }
}

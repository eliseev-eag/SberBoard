{
  "url": "https://api.github.com/repos/facebook/react/issues/15098",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15098/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15098/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15098/events",
  "html_url": "https://github.com/facebook/react/issues/15098",
  "id": 420421063,
  "node_id": "MDU6SXNzdWU0MjA0MjEwNjM=",
  "number": 15098,
  "title": "Security error on iOS due to cross origin iframe access",
  "user": {
    "login": "renanvalentin",
    "id": 2846918,
    "node_id": "MDQ6VXNlcjI4NDY5MTg=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/2846918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/renanvalentin",
    "html_url": "https://github.com/renanvalentin",
    "followers_url": "https://api.github.com/users/renanvalentin/followers",
    "following_url": "https://api.github.com/users/renanvalentin/following{/other_user}",
    "gists_url": "https://api.github.com/users/renanvalentin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/renanvalentin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/renanvalentin/subscriptions",
    "organizations_url": "https://api.github.com/users/renanvalentin/orgs",
    "repos_url": "https://api.github.com/users/renanvalentin/repos",
    "events_url": "https://api.github.com/users/renanvalentin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/renanvalentin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-03-13T10:23:53Z",
  "updated_at": "2019-03-14T11:38:39Z",
  "closed_at": "2019-03-14T11:38:38Z",
  "author_association": "CONTRIBUTOR",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\nBug\r\n\r\n**What is the current behavior?**\r\n\r\nOur application has credit card input fields hosted in iframes and we make use of `postMessage` restricted to a `targetOrigin`.\r\n\r\nThe problem is that `ReactInputSelection` tries to access the `contentDocument` of the iframe but this result in a security violation on iOS, breaking the post message flow.\r\n\r\n```javascript\r\n// react-dom/src/client/ReactInputSelection.js\r\nfunction getActiveElementDeep() {\r\n  let win = window;\r\n  let element = getActiveElement();\r\n  while (element instanceof win.HTMLIFrameElement) {\r\n    // Accessing the contentDocument of a HTMLIframeElement can cause the browser\r\n    // to throw, e.g. if it has a cross-origin src attribute\r\n    try {\r\n      win = element.contentDocument.defaultView;\r\n    } catch (e) {\r\n      return element;\r\n    }\r\n    element = getActiveElement(win.document);\r\n  }\r\n  return element;\r\n}\r\n```\r\n\r\nThis seems to work fine in most of the major browsers except on `iOS 11.2.1`. \r\nBy changing the code bellow to use `contentWindow` instead fixed the issue:\r\n\r\n```javascript\r\n // This results in 'Blocked a frame with origin' on iOS \r\n // and the post messages are not being sent\r\n win = element.contentDocument.defaultView;\r\n\r\n // fix the issue\r\n win = element.contentWindow;\r\n```\r\n\r\nSteps to reproduce:\r\n1 - Connect your phone to Safari's developer tools\r\n2 - Visit the code sandbox sample at https://codesandbox.io/s/vv8w1zwm90\r\n3 - Tap on the `input field` hosted on codepen\r\n4 - Tap on the `console` tab on code sandbox\r\n5 - It should log `Blocked a frame with origin \"https://codesandbox.io\" from accessing a frame with origin \"https://vv8w1zwm90.codesandbox.io\". Protocols, domains, and ports must match`\r\n\r\n**What is the expected behavior?**\r\nAccessing an iframe should not result into cross origin security error.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nReact 16.8.4 \r\niOS 11.2.1",
  "closed_by": {
    "login": "philipp-spiess",
    "id": 458591,
    "node_id": "MDQ6VXNlcjQ1ODU5MQ==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/458591?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/philipp-spiess",
    "html_url": "https://github.com/philipp-spiess",
    "followers_url": "https://api.github.com/users/philipp-spiess/followers",
    "following_url": "https://api.github.com/users/philipp-spiess/following{/other_user}",
    "gists_url": "https://api.github.com/users/philipp-spiess/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/philipp-spiess/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/philipp-spiess/subscriptions",
    "organizations_url": "https://api.github.com/users/philipp-spiess/orgs",
    "repos_url": "https://api.github.com/users/philipp-spiess/repos",
    "events_url": "https://api.github.com/users/philipp-spiess/events{/privacy}",
    "received_events_url": "https://api.github.com/users/philipp-spiess/received_events",
    "type": "User",
    "site_admin": false
  }
}

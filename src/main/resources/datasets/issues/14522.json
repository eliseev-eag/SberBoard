{
  "url": "https://api.github.com/repos/facebook/react/issues/14522",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14522/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14522/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14522/events",
  "html_url": "https://github.com/facebook/react/issues/14522",
  "id": 395331959,
  "node_id": "MDU6SXNzdWUzOTUzMzE5NTk=",
  "number": 14522,
  "title": "Error during setState callback unmount the entire app",
  "user": {
    "login": "alonfixlerfiverr",
    "id": 37267423,
    "node_id": "MDQ6VXNlcjM3MjY3NDIz",
    "avatar_url": "https://avatars1.githubusercontent.com/u/37267423?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alonfixlerfiverr",
    "html_url": "https://github.com/alonfixlerfiverr",
    "followers_url": "https://api.github.com/users/alonfixlerfiverr/followers",
    "following_url": "https://api.github.com/users/alonfixlerfiverr/following{/other_user}",
    "gists_url": "https://api.github.com/users/alonfixlerfiverr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alonfixlerfiverr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alonfixlerfiverr/subscriptions",
    "organizations_url": "https://api.github.com/users/alonfixlerfiverr/orgs",
    "repos_url": "https://api.github.com/users/alonfixlerfiverr/repos",
    "events_url": "https://api.github.com/users/alonfixlerfiverr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alonfixlerfiverr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 620368407,
      "node_id": "MDU6TGFiZWw2MjAzNjg0MDc=",
      "url": "https://api.github.com/repos/facebook/react/labels/Resolution:%20Needs%20More%20Information",
      "name": "Resolution: Needs More Information",
      "color": "fffde7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-01-02T18:10:30Z",
  "updated_at": "2019-01-02T22:16:12Z",
  "closed_at": "2019-01-02T22:16:12Z",
  "author_association": "NONE",
  "body": "I'm using React 16.7 and I've noticed that if an unexpected error happens during a setState callback in one of my inner component the entire app is unmounted.\r\nI tried wrapping the inner component and also my app's main component with an ErrorBoundary component. The error itself was caught in both the boundaries (where I just tried to re-render the UI) but that didn't prevent from my app to break. \r\nThe weird thing is that the setState callback is trigged inside of an event handler which is called after the page finished rendering.\r\nIf I move the faulty code from the callback and place it right after setState is called everything works as expected and nothing breaks.\r\n\r\nI've read https://github.com/facebook/react/issues/11409 and I would expect that since it happens in the callback of setState it would be treated as any other error happening not as part of a lifecycle method. Also, if it's part of a lifecycle method then I would expect my ErrorBoundary to catch without the app being unmounted.\r\n\r\nMy code looks something like this:\r\n\r\n     const MainComponent = () => (\r\n        <ErrorBoundary>\r\n          <InnerComponent/>\r\n        </ErrorBoundary>          \r\n      );\r\n\r\n     class InnerComponent extends React.Component {\r\n    \r\n        constructor() {\r\n            super();\r\n    \r\n            this.state = {\r\n                dummyState: false\r\n            };\r\n    \r\n            this.onClick = this.onClick.bind(this);\r\n        }\r\n    \r\n        onClick() {\r\n            this.setState({\r\n                dummyState: true\r\n            }, (args) => args.key1.key2);\r\n        }\r\n    \r\n        render() {\r\n            return (\r\n                <ErrorBoundary>\r\n                     <button onClick={this.onClick}>Error button</button>\r\n                </ErrorBoundary>\r\n            );\r\n        }\r\n    }\r\n\r\n    class ErrorBoundary extends Component {\r\n\r\n        static getDerivedStateFromError() {\r\n            return { hasError: true };\r\n        }\r\n\r\n        constructor(props) {\r\n            super(props);\r\n            this.state = { hasError: false};\r\n        }\r\n\r\n        componentDidCatch(error) {\r\n            console.log('report error');\r\n        }\r\n\r\n        render() {\r\n            if (this.state.hasError) {\r\n                // do nothing\r\n            }\r\n\r\n            return this.props.children;\r\n        }\r\n    }",
  "closed_by": {
    "login": "alonfixlerfiverr",
    "id": 37267423,
    "node_id": "MDQ6VXNlcjM3MjY3NDIz",
    "avatar_url": "https://avatars1.githubusercontent.com/u/37267423?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alonfixlerfiverr",
    "html_url": "https://github.com/alonfixlerfiverr",
    "followers_url": "https://api.github.com/users/alonfixlerfiverr/followers",
    "following_url": "https://api.github.com/users/alonfixlerfiverr/following{/other_user}",
    "gists_url": "https://api.github.com/users/alonfixlerfiverr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alonfixlerfiverr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alonfixlerfiverr/subscriptions",
    "organizations_url": "https://api.github.com/users/alonfixlerfiverr/orgs",
    "repos_url": "https://api.github.com/users/alonfixlerfiverr/repos",
    "events_url": "https://api.github.com/users/alonfixlerfiverr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alonfixlerfiverr/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/15774",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15774/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15774/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15774/events",
  "html_url": "https://github.com/facebook/react/issues/15774",
  "id": 450192173,
  "node_id": "MDU6SXNzdWU0NTAxOTIxNzM=",
  "number": 15774,
  "title": "useCallback doesn't memoize callback in shallow renderer",
  "user": {
    "login": "chenesan",
    "id": 7620906,
    "node_id": "MDQ6VXNlcjc2MjA5MDY=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/7620906?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chenesan",
    "html_url": "https://github.com/chenesan",
    "followers_url": "https://api.github.com/users/chenesan/followers",
    "following_url": "https://api.github.com/users/chenesan/following{/other_user}",
    "gists_url": "https://api.github.com/users/chenesan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chenesan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chenesan/subscriptions",
    "organizations_url": "https://api.github.com/users/chenesan/orgs",
    "repos_url": "https://api.github.com/users/chenesan/repos",
    "events_url": "https://api.github.com/users/chenesan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chenesan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1109410193,
      "node_id": "MDU6TGFiZWwxMTA5NDEwMTkz",
      "url": "https://api.github.com/repos/facebook/react/labels/Component:%20Hooks",
      "name": "Component: Hooks",
      "color": "c2f27b",
      "default": false
    },
    {
      "id": 204945357,
      "node_id": "MDU6TGFiZWwyMDQ5NDUzNTc=",
      "url": "https://api.github.com/repos/facebook/react/labels/Component:%20Shallow%20Renderer",
      "name": "Component: Shallow Renderer",
      "color": "eb6420",
      "default": false
    },
    {
      "id": 40929151,
      "node_id": "MDU6TGFiZWw0MDkyOTE1MQ==",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Bug",
      "name": "Type: Bug",
      "color": "b60205",
      "default": false
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-05-30T08:31:32Z",
  "updated_at": "2019-06-23T13:52:03Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\n\r\nbug\r\n\r\n**What is the current behavior?**\r\n\r\nIn shallow renderer, The returned callback from `useCallback` is not the same one between two rerendering even though the dependencies are the same. But `useMemo` will work as expected.\r\n\r\nFor example, the following test won't work:\r\n\r\n```js\r\n    function SomeComponent() {\r\n      const noop = React.useCallback(() => {}, []);\r\n\r\n      return (\r\n        <div onClick={noop} />\r\n      );\r\n    }\r\n\r\n    const shallowRenderer = createRenderer();\r\n    let firstResult = shallowRenderer.render(<SomeComponent />);\r\n    let secondResult = shallowRenderer.render(<SomeComponent />);\r\n\r\n    expect(firstResult).toEqual(secondResult);\r\n```\r\n\r\nIf `useCallback` returned the same callback between two rendering (I think) the assertion should pass.\r\n\r\nbut the same (almost) logic will work with `useMemo`, in the shallow renderer test suite (See https://github.com/facebook/react/blob/master/packages/react-test-renderer/src/__tests__/ReactShallowRendererHooks-test.js#L273-L291).\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nI created a branch in https://github.com/chenesan/react/tree/usecallback-not-work-properly-in-shallow-renderer and you can run the failed shallow renderer test in https://github.com/chenesan/react/commit/b2dff28909247342cfcb9ced2fbe24a0f9ca08b7#diff-d9a78422c03941578ae9ba487e8132cb .\r\n\r\n**What is the expected behavior?**\r\n\r\n`useCallback` should return the memoized callback when the dependencies unchanged even in shallow renderer.\r\n\r\nI tried to look into this and I found out that in shallow renderer `useCallback` just returns the original callback argument (See https://github.com/facebook/react/blob/master/packages/react-test-renderer/src/ReactShallowRenderer.js#L365-L371) but `useMemo` will compare the dependencies between rendering. I'm not sure if it's intended (So it's expected that `useCallback` will not memoize callback in shallow renderer). If it's triaged as a bug I'm glad to send a pr for this :)\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nreact@16.8.6",
  "closed_by": null
}

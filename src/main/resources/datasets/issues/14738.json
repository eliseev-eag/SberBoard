{
  "url": "https://api.github.com/repos/facebook/react/issues/14738",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14738/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14738/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14738/events",
  "html_url": "https://github.com/facebook/react/issues/14738",
  "id": 405247974,
  "node_id": "MDU6SXNzdWU0MDUyNDc5NzQ=",
  "number": 14738,
  "title": "Dependency-based reinitialization of useState",
  "user": {
    "login": "jonrimmer",
    "id": 183786,
    "node_id": "MDQ6VXNlcjE4Mzc4Ng==",
    "avatar_url": "https://avatars1.githubusercontent.com/u/183786?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jonrimmer",
    "html_url": "https://github.com/jonrimmer",
    "followers_url": "https://api.github.com/users/jonrimmer/followers",
    "following_url": "https://api.github.com/users/jonrimmer/following{/other_user}",
    "gists_url": "https://api.github.com/users/jonrimmer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jonrimmer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jonrimmer/subscriptions",
    "organizations_url": "https://api.github.com/users/jonrimmer/orgs",
    "repos_url": "https://api.github.com/users/jonrimmer/repos",
    "events_url": "https://api.github.com/users/jonrimmer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jonrimmer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 710375792,
      "node_id": "MDU6TGFiZWw3MTAzNzU3OTI=",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Discussion",
      "name": "Type: Discussion",
      "color": "fef2c0",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-01-31T13:34:17Z",
  "updated_at": "2019-03-14T03:19:44Z",
  "closed_at": "2019-02-08T16:51:59Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\n\r\nFeature\r\n\r\n**What is the current behavior?**\r\n\r\nConsider I want to have a dynamically calculated list of options, and a piece of state that represents the currently selected option. I can achieve this using hooks as follows:\r\n\r\n```js\r\nconst options = useMemo(() => {\r\n  // Calculate the options\r\n}, [dep1, dep2]);\r\n\r\nconst [choice, setChoice] = useState(options[0]);\r\n\r\nconst result = useMemo(() => {\r\n  // Calculate the displayed result\r\n}, [choice]);\r\n```\r\n\r\nHowever, a problem occurs if either `dep1` or `dep2` changes. The list of options changes, which means `choice` may no longer be valid. To fix this, I must split `choice` into a selected value and a memoized value that checks for validity:\r\n\r\n```js\r\nconst [selectedChoice, setSelectedChoice] = useState(options[0]);\r\n\r\nconst choice = useMemo(() => {\r\n  if (options.includes(selectedChoice) {\r\n    return selectedChoice;\r\n  } else {\r\n    setSelectedChoice(options[0]);\r\n    return options[0];\r\n  }\r\n}, [options, selectedChoice]);\r\n```\r\n\r\n**What is the expected behavior?**\r\n\r\nIt would useful if we could declare dependencies for `useState`, in the same way that we can for `useMemo`, and have the state reset back to the initial state if they change:\r\n\r\n```js\r\nconst [choice, setChoice] = useState(options[0], [options]);\r\n```\r\n\r\nIn order to allow preserving the current value if its valid, React could supply `prevState` to the initial state factory function, if any exists, e.g.\r\n\r\n```js\r\nconst [choice, setChoice] = useState(prevState => {\r\n  if (prevState && options.includes(prevState) {\r\n    return prevState;\r\n else {\r\n    return options[0];\r\n }\r\n}, [options]);\r\n```\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\n16.8.0-alpha.1\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

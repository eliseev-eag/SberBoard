{
  "url": "https://api.github.com/repos/facebook/react/issues/10446",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/10446/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/10446/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/10446/events",
  "html_url": "https://github.com/facebook/react/pull/10446",
  "id": 249770972,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTM1NDM2MTUz",
  "number": 10446,
  "title": "Throw error to warn of mistaken loading of prod + dev React bundles",
  "user": {
    "login": "flarnie",
    "id": 1114467,
    "node_id": "MDQ6VXNlcjExMTQ0Njc=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1114467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/flarnie",
    "html_url": "https://github.com/flarnie",
    "followers_url": "https://api.github.com/users/flarnie/followers",
    "following_url": "https://api.github.com/users/flarnie/following{/other_user}",
    "gists_url": "https://api.github.com/users/flarnie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/flarnie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/flarnie/subscriptions",
    "organizations_url": "https://api.github.com/users/flarnie/orgs",
    "repos_url": "https://api.github.com/users/flarnie/repos",
    "events_url": "https://api.github.com/users/flarnie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/flarnie/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/facebook/react/milestones/23",
    "html_url": "https://github.com/facebook/react/milestone/23",
    "labels_url": "https://api.github.com/repos/facebook/react/milestones/23/labels",
    "id": 1670888,
    "node_id": "MDk6TWlsZXN0b25lMTY3MDg4OA==",
    "number": 23,
    "title": "16.0",
    "description": "",
    "creator": {
      "login": "gaearon",
      "id": 810438,
      "node_id": "MDQ6VXNlcjgxMDQzOA==",
      "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gaearon",
      "html_url": "https://github.com/gaearon",
      "followers_url": "https://api.github.com/users/gaearon/followers",
      "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
      "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
      "organizations_url": "https://api.github.com/users/gaearon/orgs",
      "repos_url": "https://api.github.com/users/gaearon/repos",
      "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gaearon/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 69,
    "state": "closed",
    "created_at": "2016-03-29T02:12:16Z",
    "updated_at": "2017-10-04T11:52:38Z",
    "due_on": null,
    "closed_at": "2017-10-04T11:52:38Z"
  },
  "comments": 15,
  "created_at": "2017-08-11T23:34:04Z",
  "updated_at": "2018-05-25T17:51:21Z",
  "closed_at": "2017-08-16T18:44:31Z",
  "author_association": "CONTRIBUTOR",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/10446",
    "html_url": "https://github.com/facebook/react/pull/10446",
    "diff_url": "https://github.com/facebook/react/pull/10446.diff",
    "patch_url": "https://github.com/facebook/react/pull/10446.patch"
  },
  "body": "**what is the change?:**\r\nAdds an error indicating a gotcha where users end up loading both the 'prod' and 'dev' bundles in production.\r\n\r\nCredit to @gaearon for coming up with a clever way to check for this. :)\r\n\r\nI mainly just did the manual testing and fixed a couple of typos in his\r\nidea.\r\n\r\n**I'd like to do a follow-up PR to add a link and a page explaining this\r\nissue more and suggesting how to fix it. Would folks support that?**\r\n\r\n**why make this change?:**\r\n\r\nWe want to warn for an unfortunate gotcha for\r\nthe following situation -\r\n1. Wanting to shrink their JS bundle, an engineer runs it through\r\n   'uglifyjs' or some other minifier. They assume this will also do\r\n   dead-code-elimination, but the 'prod' and 'dev' checks are not\r\n   envified yet and dev-only code does not get removed.\r\n2. Then they run it through browserify's 'envify' or some other tool to\r\n   change all calls to 'process.env.NODE_ENV' to \"production\". This\r\n   makes their code ready to ship, except the 'dev' only dead code is\r\n   still in the bundle. Their bundle is twice as large as it needs to\r\n   be, due to the dead code.\r\n\r\nThis was a problem with the old build system before, but with our new\r\nbuild system output it's possible to detect and throw an informative\r\nerror in this case.\r\n\r\n**test plan:**\r\n1. run the build in react as usual; `yarn build`\r\n2. manually run 'uglifyjs -mt' on 'build/packages/react/index.js' to\r\n   simulate mistakenly minifying React before env variables are\r\n   resolved, which skips dead code elimination.\r\n3. run the fixtures build - `cd fixtures/packaging && node\r\n   ./build-all.js && serve ../..`\r\n4. Visit just the production browserify fixture -\r\n   http://localhost:5000/fixtures/packaging/browserify/prod/\r\n5. You should see the error thrown indicating this problem has occurred.\r\n<img width=\"1679\" alt=\"screen shot 2017-08-11 at 4 07 44 pm\" src=\"https://user-images.githubusercontent.com/1114467/29235327-c9060de0-7eb2-11e7-9381-d1d1b312dfab.png\">\r\n6. Do the above steps with NO uglifyjs step, and verify that no error is\r\n   thrown. When there is no minification applied, we don't assume that\r\n   this mix-up has occurred.\r\n<img width=\"1679\" alt=\"screen shot 2017-08-11 at 4 10 56 pm\" src=\"https://user-images.githubusercontent.com/1114467/29235329-d2ae9c9a-7eb2-11e7-9f37-dc926d39f467.png\">\r\n\r\n\r\n**issue:**\r\nfixes #9589",
  "closed_by": {
    "login": "flarnie",
    "id": 1114467,
    "node_id": "MDQ6VXNlcjExMTQ0Njc=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1114467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/flarnie",
    "html_url": "https://github.com/flarnie",
    "followers_url": "https://api.github.com/users/flarnie/followers",
    "following_url": "https://api.github.com/users/flarnie/following{/other_user}",
    "gists_url": "https://api.github.com/users/flarnie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/flarnie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/flarnie/subscriptions",
    "organizations_url": "https://api.github.com/users/flarnie/orgs",
    "repos_url": "https://api.github.com/users/flarnie/repos",
    "events_url": "https://api.github.com/users/flarnie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/flarnie/received_events",
    "type": "User",
    "site_admin": false
  }
}

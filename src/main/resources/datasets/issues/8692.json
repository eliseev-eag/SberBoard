{
  "url": "https://api.github.com/repos/facebook/react/issues/8692",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/8692/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/8692/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/8692/events",
  "html_url": "https://github.com/facebook/react/issues/8692",
  "id": 198890680,
  "node_id": "MDU6SXNzdWUxOTg4OTA2ODA=",
  "number": 8692,
  "title": "Expected onBeforeMountComponent() parent and onSetChildren() to be consistent",
  "user": {
    "login": "MicheleBertoli",
    "id": 1308971,
    "node_id": "MDQ6VXNlcjEzMDg5NzE=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/1308971?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MicheleBertoli",
    "html_url": "https://github.com/MicheleBertoli",
    "followers_url": "https://api.github.com/users/MicheleBertoli/followers",
    "following_url": "https://api.github.com/users/MicheleBertoli/following{/other_user}",
    "gists_url": "https://api.github.com/users/MicheleBertoli/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MicheleBertoli/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MicheleBertoli/subscriptions",
    "organizations_url": "https://api.github.com/users/MicheleBertoli/orgs",
    "repos_url": "https://api.github.com/users/MicheleBertoli/repos",
    "events_url": "https://api.github.com/users/MicheleBertoli/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MicheleBertoli/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2017-01-05T07:12:28Z",
  "updated_at": "2017-04-21T14:54:09Z",
  "closed_at": "2017-04-21T14:54:08Z",
  "author_association": "MEMBER",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\nIt looks like a bug.\r\n\r\n**What is the current behavior?**\r\nSetting the state before rendering a component with the test renderer, shows a warning in the console:\r\n\r\n> Warning: Exception thrown by hook while handling onSetChildren: Invariant Violation: Expected onBeforeMountComponent() parent and onSetChildren() to be consistent (3 has parents 0 and 2).\r\nInvariant Violation: Expected onBeforeMountComponent() parent and onSetChildren() to be consistent (3 has parents 0 and 2).\r\n\r\nIn the following example, it weirdly happens consistently the third time you run it, while in other more complex scenarios it does it earlier.\r\n\r\nThe steps to reproduce the issue are the following:\r\n\r\n1. first of all, create an app and install the renderer\r\n  ```sh\r\n  create-react-app my-app\r\n  cd my-app\r\n  yarn add react-test-renderer\r\n  ```\r\n\r\n2. then, add the following button to the `App`\r\n  ```jsx\r\n  import renderer from 'react-test-renderer'\r\n\r\n  // ...\r\n\r\n  <button\r\n    onClick={() => {\r\n      this.setState({})\r\n      renderer.create(<div />).toJSON()\r\n    }}\r\n  >üí•</button>\r\n  ```\r\n\r\nHere is a demo:\r\n\r\n![renderer](https://cloud.githubusercontent.com/assets/1308971/21671313/759126dc-d312-11e6-9261-24ee3387b65a.gif)\r\n\r\n‚ö†Ô∏è I understand this is not a common way of using React and the Test Renderer. \r\nI'm more interested in knowing the reasons behind the problem and eventually see if there are some workarounds to apply.\r\nWhat I'm trying to do is to serialize components and send them to an endpoint (see [snapguidist](https://github.com/MicheleBertoli/snapguidist)).\r\n\r\n**What is the expected behavior?**\r\nIdeally, there should not be any warning.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\n`react v15.4.1`\r\n`react-test-renderer v15.4.1`\r\n\r\nI have been able to reproduce the issue on the latest versions of Chrome, Firefox and Safari on MacOS.",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

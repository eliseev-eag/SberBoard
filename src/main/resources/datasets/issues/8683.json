{
  "url": "https://api.github.com/repos/facebook/react/issues/8683",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/8683/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/8683/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/8683/events",
  "html_url": "https://github.com/facebook/react/issues/8683",
  "id": 198768260,
  "node_id": "MDU6SXNzdWUxOTg3NjgyNjA=",
  "number": 8683,
  "title": "Composition Events(Chinese, Japanese IME) problem in controlled components(input, textarea)",
  "user": {
    "login": "eyesofkids",
    "id": 433742,
    "node_id": "MDQ6VXNlcjQzMzc0Mg==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/433742?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eyesofkids",
    "html_url": "https://github.com/eyesofkids",
    "followers_url": "https://api.github.com/users/eyesofkids/followers",
    "following_url": "https://api.github.com/users/eyesofkids/following{/other_user}",
    "gists_url": "https://api.github.com/users/eyesofkids/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eyesofkids/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eyesofkids/subscriptions",
    "organizations_url": "https://api.github.com/users/eyesofkids/orgs",
    "repos_url": "https://api.github.com/users/eyesofkids/repos",
    "events_url": "https://api.github.com/users/eyesofkids/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eyesofkids/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 127893911,
      "node_id": "MDU6TGFiZWwxMjc4OTM5MTE=",
      "url": "https://api.github.com/repos/facebook/react/labels/Component:%20DOM",
      "name": "Component: DOM",
      "color": "fef2c0",
      "default": false
    },
    {
      "id": 40929151,
      "node_id": "MDU6TGFiZWw0MDkyOTE1MQ==",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Bug",
      "name": "Type: Bug",
      "color": "b60205",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-01-04T17:46:39Z",
  "updated_at": "2018-08-29T17:10:24Z",
  "closed_at": "2018-08-29T17:10:24Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\n\r\nboth.\r\n\r\n**What is the current behavior?**\r\n\r\nThere is a existed issue [#3926](https://github.com/facebook/react/issues/3926) but it is just one of the problems in some kind of browsers.\r\n\r\nI have uploaded the detail, demo files, test results and temporary solution in [react-compositionevent](https://github.com/eyesofkids/react-compositionevent)\r\n\r\nThe main problem is when users type these words from IME(Chinese, Japanese or maybe Korean) and do something like search the database or filter out from some data, sometimes these functions will be unworkable. For example, if users type \"ni\" during the composition session, maybe it will be one of \"你尼泥腻\" in Chinese or one of \"にニ尼煮\" in Japanese. But in this moment, the `change` event also be fired. If the search or filter functions of the application are designed to be invoked when `change` event occured, there maybe something wrong logically. These functions should be invoked after users finished the composition session.\r\n\r\nIn React, there are three synthetic events - `onCompositionEnd`, `onCompositionStart` and `onCompositionUpdate`. If the input components(`<input...>` and `<textarea.../>`) are \"uncontrolled\", we can use them to help `onChange` to capture the text correctly. The only different point is Google Chrome change its events sequence after v53. Check [Cinput.js](https://github.com/eyesofkids/react-compositionevent/blob/master/uncontrolled/Cinput.js) and [Ctextarea.js](https://github.com/eyesofkids/react-compositionevent/blob/master/uncontrolled/Ctextarea.js) files.\r\n\r\nBut if these input components are \"controlled\", it will be hard to solve the problem.\r\n\r\nBecause these the `value` of a controlled component is came from `state`. We can't modify `state` directly and the only way to update state is using `this.setState()` to schedule update. But `this.setState()` may be asynchronous.\r\n\r\nAfter test, i found different OS/browsers could have different results. I have written some code to solve it. But i thought it isn't a good solution. It uses the browser detection and two properties of the `state` object. One is for input, another is for internal functions(search, filter...etc). It can't just use one property of the `state` object because i can't stop any `change` events, state need it to update the value of the input element. If i stop some change events during composition session, i would get nothing after typing these words from IME.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem via https://jsfiddle.net or similar (template: https://jsfiddle.net/reactjs/69z2wepo/).**\r\n\r\nYou can use online test demo: [https://eyesofkids.github.io/](https://eyesofkids.github.io/)\r\nor use a normal input component(controlled/uncontrolled) to test.\r\n\r\n**What is the expected behavior?**\r\n\r\nThe input(and textarea) controlled components in React should ensure these fired \"change\" and \"composition\" events is consistent in different browsers. I found there are 3 different results(events fired sequence) at least.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\n- React 15.4.1\r\n- browsers: chrome, firefox, safari, opera, ie, edge\r\n- OS: macOS, win7, win10",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

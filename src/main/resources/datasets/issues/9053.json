{
  "url": "https://api.github.com/repos/facebook/react/issues/9053",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/9053/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/9053/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/9053/events",
  "html_url": "https://github.com/facebook/react/pull/9053",
  "id": 209830876,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTA3NjczODk3",
  "number": 9053,
  "title": "ReactDOM DOMLazyTree: add fix for IE11 popup rendering issue",
  "user": {
    "login": "paulkoegel",
    "id": 513255,
    "node_id": "MDQ6VXNlcjUxMzI1NQ==",
    "avatar_url": "https://avatars1.githubusercontent.com/u/513255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulkoegel",
    "html_url": "https://github.com/paulkoegel",
    "followers_url": "https://api.github.com/users/paulkoegel/followers",
    "following_url": "https://api.github.com/users/paulkoegel/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulkoegel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulkoegel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulkoegel/subscriptions",
    "organizations_url": "https://api.github.com/users/paulkoegel/orgs",
    "repos_url": "https://api.github.com/users/paulkoegel/repos",
    "events_url": "https://api.github.com/users/paulkoegel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulkoegel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2017-02-23T17:33:13Z",
  "updated_at": "2017-04-21T14:18:15Z",
  "closed_at": "2017-04-21T14:18:15Z",
  "author_association": "NONE",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/9053",
    "html_url": "https://github.com/facebook/react/pull/9053",
    "diff_url": "https://github.com/facebook/react/pull/9053.diff",
    "patch_url": "https://github.com/facebook/react/pull/9053.patch"
  },
  "body": "When rendering to a popup in IE11, components with multiple children can break.\r\nOther browsers don't have this problem (render subtrees all at once while IE's get added step by step) and the problem also doesn't happen when rendering a problematic component to the main browser window.\r\n\r\n## Demo\r\n+ [Run the broken demo (requires IE11)](https://paulkogel.github.io/react-rendering-bug-ie11-popup-demo/)\r\n+ [Run the fixed demo](https://paulkogel.github.io/react-rendering-bug-ie11-popup-demo/fixed.html)\r\n+ Repository: [https://github.com/paulkogel/react-rendering-bug-ie11-popup-demo/](https://github.com/paulkogel/react-rendering-bug-ie11-popup-demo/)\r\n\r\n## TODO\r\n- [ ] **wait for feedback whether the current workaround is a good way to fix the issue**\r\n- [ ] add regression test\r\n\r\n**Screenshot of broken behaviour**\r\n![screenshot broken](https://raw.githubusercontent.com/paulkogel/react-rendering-bug-ie11-popup-demo/gh-pages/screenshot-broken.png)\r\n\r\n**Screenshot of fixed behaviour**\r\n![screenshot fixed](https://github.com/paulkogel/react-rendering-bug-ie11-popup-demo/raw/gh-pages/screenshot-fixed.png)\r\n\r\nReact and ReactDOM versions tested: 15.4.2 and current master.\r\n\r\n## Example for Problematic Markup\r\n```\r\nvar WillBreakInPopup = function() {\r\n  return React.createElement(\r\n    'div',\r\n    null,\r\n    'Hello Popup!', // 2 children cause trouble!\r\n    ' ...and more!'\r\n  );\r\n};\r\n```\r\n## Original Error Message\r\n\r\n```\r\nSCRIPT87: Invalid argument.\r\nFile: react-dom.js, Line: 1598, Column: 5\r\n```\r\n\r\n```\r\nvar insertTreeBefore = createMicrosoftUnsafeLocalFunction(function (parentNode, tree, referenceNode) {\r\n  // DocumentFragments aren't actually part of the DOM after insertion so\r\n  // appending children won't update the DOM. We need to ensure the fragment\r\n  // is properly populated first, breaking out of our lazy approach for just\r\n  // this level. Also, some <object> plugins (like Flash Player) will read\r\n  // <param> nodes immediately upon insertion into the DOM, so <object>\r\n  // must also be populated prior to insertion into the DOM.\r\n  if (tree.node.nodeType === DOCUMENT_FRAGMENT_NODE_TYPE || tree.node.nodeType === ELEMENT_NODE_TYPE && tree.node.nodeName.toLowerCase() === 'object' && (tree.node.namespaceURI == null || tree.node.namespaceURI === DOMNamespaces.html)) {\r\n    insertTreeChildren(tree);\r\n    parentNode.insertBefore(tree.node, referenceNode); // ERRONEOUS LINE\r\n  } else {\r\n    parentNode.insertBefore(tree.node, referenceNode);\r\n    insertTreeChildren(tree);\r\n  }\r\n});\r\n```\r\n\r\n## Workaround / Fix (!?)\r\n\r\n```diff\r\n-    parentNode.insertBefore(tree.node, referenceNode); // ERRONEOUS LINE\r\n+    if (referenceNode) {\r\n+      parentNode.insertBefore(tree.node, referenceNode);\r\n+    } else {\r\n+      parentNode.appendChild(tree.node);\r\n+    }\r\n```\r\n\r\n**Explanation:** when `referenceNode` is `null` it will insert `tree.node` at the end of `parentNode` and can be replaced with `appendChild`. For some reason `appendChild` doesn't crash rendering and fixes the issue.\r\nI'm not really sure what causes `insertBefore` to crash when rendering to the popout. Replacing it with `appendChild` fixes things in our app and tests still pass.\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

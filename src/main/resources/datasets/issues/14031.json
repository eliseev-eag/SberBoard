{
  "url": "https://api.github.com/repos/facebook/react/issues/14031",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14031/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14031/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14031/events",
  "html_url": "https://github.com/facebook/react/issues/14031",
  "id": 375414683,
  "node_id": "MDU6SXNzdWUzNzU0MTQ2ODM=",
  "number": 14031,
  "title": "React hooks + old way components = cached state value (ðŸ˜±ðŸ˜±ðŸ˜±)",
  "user": {
    "login": "rockmandash",
    "id": 7580792,
    "node_id": "MDQ6VXNlcjc1ODA3OTI=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/7580792?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rockmandash",
    "html_url": "https://github.com/rockmandash",
    "followers_url": "https://api.github.com/users/rockmandash/followers",
    "following_url": "https://api.github.com/users/rockmandash/following{/other_user}",
    "gists_url": "https://api.github.com/users/rockmandash/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rockmandash/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rockmandash/subscriptions",
    "organizations_url": "https://api.github.com/users/rockmandash/orgs",
    "repos_url": "https://api.github.com/users/rockmandash/repos",
    "events_url": "https://api.github.com/users/rockmandash/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rockmandash/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2018-10-30T10:21:14Z",
  "updated_at": "2019-03-08T13:56:55Z",
  "closed_at": "2018-10-30T20:46:24Z",
  "author_association": "NONE",
  "body": "Please see this demo.\r\n[![Edit React Hooks Problem](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/13y9zv4ko7)\r\nAs you can see, I have an old way component looks like this\r\n```javascript\r\nimport React, { Component } from \"react\";\r\n\r\nclass OldLibrary extends Component {\r\n  componentDidMount() {\r\n    setInterval(this.props.onProgress, 50);\r\n  }\r\n  render() {\r\n    return null;\r\n  }\r\n}\r\nexport default OldLibrary;\r\n```\r\nA simple component setting interval when mount.\r\n\r\nNow I have a component use React Hooks\r\n```javascript\r\nfunction App() {\r\n  const [value, setValue] = useState(0);\r\n  const onProgress = () => {\r\n    console.log(value);\r\n    // this will always console logging 0 no matter what\r\n  };\r\n  const onClick = () => {\r\n    setValue(value + 1);\r\n    // Click me and state changes, but onProgress won't notice\r\n  };\r\n  return (\r\n    <>\r\n      <OldLibrary onProgress={onProgress} />\r\n      <button onClick={onClick}>Click</button>\r\n    </>\r\n  );\r\n}\r\n```\r\nThis code above, no matter how I click the button, onProgress will always console logging initial value(which is 0), it's just like the state is being cached or something I don't know.\r\n\r\nuseRef won't help too.\r\n```javascript\r\nfunction App() {\r\n  const [value, setValue] = useState(0);\r\n  const onProgress = useRef(() => {\r\n    console.log(value);\r\n  });\r\n  const onClick = () => {\r\n    setValue(value + 1);\r\n  };\r\n  return (\r\n    <>\r\n      <OldLibrary onProgress={onProgress.current} />\r\n      <button onClick={onClick}>Click</button>\r\n    </>\r\n  );\r\n}\r\n```\r\n\r\nBut if we use the old way, it will work just fine.\r\n```javascript\r\nclass App extends Component {\r\n  state = {\r\n    value: 0\r\n  };\r\n  onClick = () => {\r\n    this.setState({ value: this.state.value + 1 });\r\n  };\r\n  onProgress = () => {\r\n    console.log(this.state.value);\r\n    // I will console logging different value when state changes\r\n  };\r\n  render() {\r\n    return (\r\n      <>\r\n        <OldLibrary onProgress={this.onProgress} />\r\n        <button onClick={this.onClick}>Click</button>\r\n      </>\r\n    );\r\n  }\r\n}\r\n```\r\n\r\nThank you for listening my question.\r\nPlease help, I can't live without hooks ðŸ˜­ðŸ˜­ðŸ˜­",
  "closed_by": {
    "login": "sophiebits",
    "id": 6820,
    "node_id": "MDQ6VXNlcjY4MjA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6820?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sophiebits",
    "html_url": "https://github.com/sophiebits",
    "followers_url": "https://api.github.com/users/sophiebits/followers",
    "following_url": "https://api.github.com/users/sophiebits/following{/other_user}",
    "gists_url": "https://api.github.com/users/sophiebits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sophiebits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sophiebits/subscriptions",
    "organizations_url": "https://api.github.com/users/sophiebits/orgs",
    "repos_url": "https://api.github.com/users/sophiebits/repos",
    "events_url": "https://api.github.com/users/sophiebits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sophiebits/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/5631",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/5631/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/5631/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/5631/events",
  "html_url": "https://github.com/facebook/react/issues/5631",
  "id": 121360575,
  "node_id": "MDU6SXNzdWUxMjEzNjA1NzU=",
  "number": 5631,
  "title": "null owner in addComponentAsRefTo hard to fix",
  "user": {
    "login": "joIivier",
    "id": 6048710,
    "node_id": "MDQ6VXNlcjYwNDg3MTA=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/6048710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/joIivier",
    "html_url": "https://github.com/joIivier",
    "followers_url": "https://api.github.com/users/joIivier/followers",
    "following_url": "https://api.github.com/users/joIivier/following{/other_user}",
    "gists_url": "https://api.github.com/users/joIivier/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/joIivier/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joIivier/subscriptions",
    "organizations_url": "https://api.github.com/users/joIivier/orgs",
    "repos_url": "https://api.github.com/users/joIivier/repos",
    "events_url": "https://api.github.com/users/joIivier/events{/privacy}",
    "received_events_url": "https://api.github.com/users/joIivier/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2015-12-09T22:57:49Z",
  "updated_at": "2016-10-30T11:23:36Z",
  "closed_at": "2016-01-04T19:49:02Z",
  "author_association": "NONE",
  "body": "I am migrating my UI from react-1.13.3 to 1.14.3 and encountered the following error messages when loading my page:\n\n```\nUncaught Error: Invariant Violation: addComponentAsRefTo(...): Only a ReactOwner can have refs. You might be adding a ref to a component that was not created inside a component's `render` method, or you have multiple copies of React loaded (details: https://fb.me/react-refs-must-have-owner).\n```\n\nI tried to fix it but I still have it with the following simple component:\n\n```\nconst Test = React.createClass({\n\n  handleClick() {\n    console.log(this.refs.test.value);\n  },\n  render() {\n    return <div><input ref=\"test\" onClick={this.handleClick}/></div>;\n  }\n});\n\nexport default {\n  render(targetId) {\n    return ReactDOM.render(<Test hint=\"root\"/>, document.getElementById(targetId));\n  }\n};\n```\n\nSo clearly my ref is set in the `render` method in this code that fails.\n\nI investigated about the possibility of having twice React loaded and `npm ls|grep react@` has only one line. I am not sure this proves anything since we have a complex build that generates our code (and probably the issue is somewhere in our build), but I ensured React code is only once in our output script, I also put a breakpoint in ReactCurrentOwner line 20 and was hit only once. I don't know if this is sufficient but for me we load React only once, so I went deeper.\n\nWhen debugging I see that in the call to `addComponentAsRefTo: function (component, ref, owner)`, `owner` is `null`. I then put breakpoints when `ReactCurrentOwner.current` is set to a non null value (ReactCompositeComponent lines 146 and 605, ReactMultiChild line 196 and 211). When I start my application, the breakpoint in ReactCompositeComponent:146 is hit twice (and at this time, this._currentElement.props is `{hint:'root}` but each time it is reset to null on line 150. The call to addComponentAsRefTo is done outside these two windows where the owner is not null.\n\nWhat can I do to investigate more? \n",
  "closed_by": {
    "login": "jimfb",
    "id": 9595985,
    "node_id": "MDQ6VXNlcjk1OTU5ODU=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/9595985?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jimfb",
    "html_url": "https://github.com/jimfb",
    "followers_url": "https://api.github.com/users/jimfb/followers",
    "following_url": "https://api.github.com/users/jimfb/following{/other_user}",
    "gists_url": "https://api.github.com/users/jimfb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jimfb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jimfb/subscriptions",
    "organizations_url": "https://api.github.com/users/jimfb/orgs",
    "repos_url": "https://api.github.com/users/jimfb/repos",
    "events_url": "https://api.github.com/users/jimfb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jimfb/received_events",
    "type": "User",
    "site_admin": false
  }
}

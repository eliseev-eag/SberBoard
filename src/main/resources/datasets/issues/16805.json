{
  "url": "https://api.github.com/repos/facebook/react/issues/16805",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/16805/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/16805/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/16805/events",
  "html_url": "https://github.com/facebook/react/issues/16805",
  "id": 494590272,
  "node_id": "MDU6SXNzdWU0OTQ1OTAyNzI=",
  "number": 16805,
  "title": "useState and ES module",
  "user": {
    "login": "larafale",
    "id": 503577,
    "node_id": "MDQ6VXNlcjUwMzU3Nw==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/503577?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/larafale",
    "html_url": "https://github.com/larafale",
    "followers_url": "https://api.github.com/users/larafale/followers",
    "following_url": "https://api.github.com/users/larafale/following{/other_user}",
    "gists_url": "https://api.github.com/users/larafale/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/larafale/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/larafale/subscriptions",
    "organizations_url": "https://api.github.com/users/larafale/orgs",
    "repos_url": "https://api.github.com/users/larafale/repos",
    "events_url": "https://api.github.com/users/larafale/events{/privacy}",
    "received_events_url": "https://api.github.com/users/larafale/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-09-17T12:23:35Z",
  "updated_at": "2019-09-17T15:31:54Z",
  "closed_at": "2019-09-17T15:31:54Z",
  "author_association": "NONE",
  "body": "**Do you want to request a *feature* or report a *bug*?**\r\nA bug, more a question\r\n\r\n**What is the current behavior?**\r\nI can't make `useState` to work when using ES module browser scripts.\r\n\r\n**What is the expected behavior?**\r\nI'm trying to make a minimal working exemple of `useState` hook but from an ES module script tag\r\n\r\nmy `index.html` file:\r\n```html\r\n<html>\r\n  <head>\r\n    <script src=\"https://unpkg.com/react@16/umd/react.development.js\" crossorigin></script>\r\n    <script src=\"https://unpkg.com/react-dom@16/umd/react-dom.development.js\" crossorigin></script>\r\n  </head>\r\n  <body>\r\n\r\n    <div id=\"root\"></div>\r\n\r\n    <script async type=\"module\">\r\n      import MyComponent from '/dist/index.js'\r\n      ReactDOM.render(MyComponent(), document.getElementById('root'))\r\n    </script>\r\n\r\n  </body>\r\n</html>\r\n```\r\n\r\nI get the following error:\r\n```js\r\nreact.development.js:1621 Uncaught (in promise) Invariant Violation: Invalid hook call. Hooks can only be called inside of the body of a function component. This could happen for one of the following reasons:\r\n1. You might have mismatching versions of React and the renderer (such as React DOM)\r\n2. You might be breaking the Rules of Hooks\r\n3. You might have more than one copy of React in the same app\r\n```\r\n\r\nHere is the source of my component:\r\n(There is no import react in the source, React is not included in the ES build, I only have one instance of React which is the one included in the html script tag bellow)\r\n```javascript\r\nexport default function Example() {\r\n  const [count, setCount] = React.useState(0);\r\n\r\n  return (\r\n    <div>\r\n      <p>You clicked {count} times</p>\r\n      <button onClick={() => setCount(count + 1)}>\r\n        Click me\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n```\r\n\r\nThis is the basic ES module I generate with `rollup` to include in the html file, don't know if that helps:\r\n```js\r\n(function(l, i, v, e) { v = l.createElement(i); v.async = 1; v.src = '//' + (location.host || 'localhost').split(':')[0] + ':35729/livereload.js?snipver=1'; e = l.getElementsByTagName(i)[0]; e.parentNode.insertBefore(v, e)})(document, 'script');\r\nfunction _slicedToArray(arr, i) {\r\n  return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest();\r\n}\r\n\r\nfunction _arrayWithHoles(arr) {\r\n  if (Array.isArray(arr)) return arr;\r\n}\r\n\r\nfunction _iterableToArrayLimit(arr, i) {\r\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\r\n    return;\r\n  }\r\n\r\n  var _arr = [];\r\n  var _n = true;\r\n  var _d = false;\r\n  var _e = undefined;\r\n\r\n  try {\r\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\r\n      _arr.push(_s.value);\r\n\r\n      if (i && _arr.length === i) break;\r\n    }\r\n  } catch (err) {\r\n    _d = true;\r\n    _e = err;\r\n  } finally {\r\n    try {\r\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\r\n    } finally {\r\n      if (_d) throw _e;\r\n    }\r\n  }\r\n\r\n  return _arr;\r\n}\r\n\r\nfunction _nonIterableRest() {\r\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\r\n}\r\n\r\nfunction Example() {\r\n  var _React$useState = React.useState(0),\r\n      _React$useState2 = _slicedToArray(_React$useState, 2),\r\n      count = _React$useState2[0],\r\n      setCount = _React$useState2[1];\r\n\r\n  return React.createElement(\"div\", null, React.createElement(\"p\", null, \"You clicked \", count, \" times\"), React.createElement(\"button\", {\r\n    onClick: function onClick() {\r\n      return setCount(count + 1);\r\n    }\r\n  }, \"Click me\"));\r\n}\r\n\r\nexport default Example;\r\n```\r\n\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nchrome, react@16, react-dom@16\r\n",
  "closed_by": {
    "login": "larafale",
    "id": 503577,
    "node_id": "MDQ6VXNlcjUwMzU3Nw==",
    "avatar_url": "https://avatars3.githubusercontent.com/u/503577?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/larafale",
    "html_url": "https://github.com/larafale",
    "followers_url": "https://api.github.com/users/larafale/followers",
    "following_url": "https://api.github.com/users/larafale/following{/other_user}",
    "gists_url": "https://api.github.com/users/larafale/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/larafale/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/larafale/subscriptions",
    "organizations_url": "https://api.github.com/users/larafale/orgs",
    "repos_url": "https://api.github.com/users/larafale/repos",
    "events_url": "https://api.github.com/users/larafale/events{/privacy}",
    "received_events_url": "https://api.github.com/users/larafale/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/14721",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14721/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14721/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14721/events",
  "html_url": "https://github.com/facebook/react/issues/14721",
  "id": 404453615,
  "node_id": "MDU6SXNzdWU0MDQ0NTM2MTU=",
  "number": 14721,
  "title": "Hooks error on React library compiled with Rollup.js",
  "user": {
    "login": "davegomez",
    "id": 282903,
    "node_id": "MDQ6VXNlcjI4MjkwMw==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/282903?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davegomez",
    "html_url": "https://github.com/davegomez",
    "followers_url": "https://api.github.com/users/davegomez/followers",
    "following_url": "https://api.github.com/users/davegomez/following{/other_user}",
    "gists_url": "https://api.github.com/users/davegomez/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davegomez/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davegomez/subscriptions",
    "organizations_url": "https://api.github.com/users/davegomez/orgs",
    "repos_url": "https://api.github.com/users/davegomez/repos",
    "events_url": "https://api.github.com/users/davegomez/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davegomez/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2019-01-29T19:36:51Z",
  "updated_at": "2019-10-10T18:31:06Z",
  "closed_at": "2019-01-29T21:19:30Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\nDisclaimer: I'm not sure if this is an specific bug from React's Hooks or it is something I'm missing in my Rollup.js configuration but I've been trying a lot of different things and always end up in the same error.\r\n\r\n`Hooks can only be called inside the body of a function component.`\r\n\r\nI'm building a React Component library using the alpha version of React and Hooks, and using Rollup.js v1.1.2 as a bundler with the next configuration:\r\n\r\n```javascript\r\nimport { readdirSync } from 'fs';\r\nimport path from 'path';\r\nimport babel from 'rollup-plugin-babel';\r\nimport commonjs from 'rollup-plugin-commonjs';\r\nimport external from 'rollup-plugin-peer-deps-external';\r\nimport replace from 'rollup-plugin-replace';\r\nimport resolve from 'rollup-plugin-node-resolve';\r\nimport { terser } from 'rollup-plugin-terser';\r\n\r\nconst CODES = [\r\n  'THIS_IS_UNDEFINED',\r\n  'MISSING_GLOBAL_NAME',\r\n  'CIRCULAR_DEPENDENCY',\r\n];\r\n\r\nconst getChunks = URI =>\r\n  readdirSync(path.resolve(URI))\r\n    .filter(x => x.includes('.js'))\r\n    .reduce((a, c) => ({ ...a, [c.replace('.js', '')]: `src/${c}` }), {});\r\n\r\nconst discardWarning = warning => {\r\n  if (CODES.includes(warning.code)) {\r\n    return;\r\n  }\r\n\r\n  console.error(warning);\r\n};\r\n\r\nconst env = process.env.NODE_ENV;\r\n\r\nconst plugins = [\r\n  external(),\r\n  babel({\r\n    exclude: 'node_modules/**',\r\n  }),\r\n  resolve(),\r\n  replace({ 'process.env.NODE_ENV': JSON.stringify(env) }),\r\n  commonjs(),\r\n  env === 'production' && terser(),\r\n];\r\n\r\nexport default [\r\n  {\r\n    onwarn: discardWarning,\r\n    input: 'src/index.js',\r\n    output: {\r\n      esModule: false,\r\n      file: 'umd/library-name.js',\r\n      format: 'umd',\r\n      name: 'libraryName',\r\n    },\r\n    plugins,\r\n  },\r\n  {\r\n    onwarn: discardWarning,\r\n    input: getChunks('src'),\r\n    output: [\r\n      { dir: 'esm', format: 'esm', sourcemap: true },\r\n      { dir: 'cjs', format: 'cjs', sourcemap: true },\r\n    ],\r\n    plugins,\r\n  },\r\n];\r\n```\r\n\r\nFor the examples page I created an internal project using `create-react-app` and I'm importing the library in the `package.json` using `link:..`\r\n\r\nThe page breaks as soon as it gets to the first Hooks call `var svgRef = useRef();` with the error mentioned above, but this only happens when I'm using the bundled code from the ESM file not when I'm using the library code directly. That's why I'm not sure if it is a Rollup misconfiguration or a React Hooks bug.\r\n\r\nI appreciate any help or guidance on this.\r\n\r\nReact v16.8.0-alpha.1\r\nReact DOM v16.8.0-alpha.1\r\nOS: macOS\r\nBrowser: Chrome\r\nNode.js v11.8.0\r\n\r\nI did test it with a previous alpha version of React and it happens the same.",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/15951",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15951/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15951/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15951/events",
  "html_url": "https://github.com/facebook/react/issues/15951",
  "id": 459147004,
  "node_id": "MDU6SXNzdWU0NTkxNDcwMDQ=",
  "number": 15951,
  "title": "Portal and animations (and other side effects)",
  "user": {
    "login": "intellild",
    "id": 8379858,
    "node_id": "MDQ6VXNlcjgzNzk4NTg=",
    "avatar_url": "https://avatars2.githubusercontent.com/u/8379858?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/intellild",
    "html_url": "https://github.com/intellild",
    "followers_url": "https://api.github.com/users/intellild/followers",
    "following_url": "https://api.github.com/users/intellild/following{/other_user}",
    "gists_url": "https://api.github.com/users/intellild/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/intellild/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/intellild/subscriptions",
    "organizations_url": "https://api.github.com/users/intellild/orgs",
    "repos_url": "https://api.github.com/users/intellild/repos",
    "events_url": "https://api.github.com/users/intellild/events{/privacy}",
    "received_events_url": "https://api.github.com/users/intellild/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-06-21T11:16:23Z",
  "updated_at": "2019-08-27T00:16:13Z",
  "closed_at": null,
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\nMaybe feature ?\r\n\r\n**What is the current behavior?**\r\n```jsx\r\n// the portal component\r\nclass Modal extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n    this.el = document.createElement('div');\r\n  }\r\n\r\n  componentDidMount() {\r\n    modalRoot.appendChild(this.el);\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    modalRoot.removeChild(this.el);\r\n  }\r\n\r\n  render() {\r\n    return ReactDOM.createPortal(\r\n      this.props.children,\r\n      this.el,\r\n    );\r\n  }\r\n}\r\n\r\nclass Child extends Component {\r\n  elRef = createRef();\r\n\r\n  componentDidMount() {\r\n    // some animations here\r\n  }\r\n\r\n  render() {\r\n    return <div ref={this.elRef}></div>;\r\n  }\r\n}\r\n```\r\n`Modal`'s componentDidMount is fired after Child's componentDidMount. When Child performing animations, everything is not in the DOM tree, whitch causes problems.\r\nSame issue with hooks. Same issue with other side effects related to Child's DOM.\r\n\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\n**What is the expected behavior?**\r\nMaybe provide a way to perform side effects before component mount, and guranteed clean up? For example:\r\n```js\r\nfunction App() {\r\n  useSomething(() => {\r\n    // called before mount, parent fires before child\r\n    return () => {\r\n      // called after unmount, child fires before parent\r\n    }\r\n  }, []);\r\n}\r\n```\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n",
  "closed_by": null
}

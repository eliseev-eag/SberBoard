{
  "url": "https://api.github.com/repos/facebook/react/issues/15815",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15815/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15815/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15815/events",
  "html_url": "https://github.com/facebook/react/issues/15815",
  "id": 451940844,
  "node_id": "MDU6SXNzdWU0NTE5NDA4NDQ=",
  "number": 15815,
  "title": "`useEffect` doesn't work for `keydown` event listener",
  "user": {
    "login": "zhaoyi0113",
    "id": 3355579,
    "node_id": "MDQ6VXNlcjMzNTU1Nzk=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/3355579?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhaoyi0113",
    "html_url": "https://github.com/zhaoyi0113",
    "followers_url": "https://api.github.com/users/zhaoyi0113/followers",
    "following_url": "https://api.github.com/users/zhaoyi0113/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhaoyi0113/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhaoyi0113/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhaoyi0113/subscriptions",
    "organizations_url": "https://api.github.com/users/zhaoyi0113/orgs",
    "repos_url": "https://api.github.com/users/zhaoyi0113/repos",
    "events_url": "https://api.github.com/users/zhaoyi0113/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhaoyi0113/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-06-04T11:24:10Z",
  "updated_at": "2019-06-04T23:18:51Z",
  "closed_at": "2019-06-04T23:18:51Z",
  "author_association": "NONE",
  "body": "I have a stateless component which needs to listen on keyboard event. It adds keydown listener when the component is mounted and remove it when the component is unmounted. There is a state test is boolean value. It is set to true when the component is mounted. But in the keydown event listener, its value always false. It looks like the listener doesn't take the state reference. What's wrong with my code?\r\n\r\n```\r\nconst { useEffect, useState } = React;\r\n\r\n\r\nconst Comp = () => {\r\n  const [test, setTest] = useState(false);\r\n  const keyPressHandler = (e) => {\r\n    setTest(!test);\r\n    console.log(test);\r\n  }\r\n  useEffect(() => {\r\n    setTest(true);\r\n    window.addEventListener('keydown', keyPressHandler);\r\n    return () => {\r\n      window.removeEventListener('keydown', keyPressHandler);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"test\">\r\n      hello {test + \"\"}\r\n    </div>\r\n  );\r\n};\r\n```\r\n\r\nA live example can be found at: https://codepen.io/zhaoyi0113/pen/mYozVp",
  "closed_by": {
    "login": "zhaoyi0113",
    "id": 3355579,
    "node_id": "MDQ6VXNlcjMzNTU1Nzk=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/3355579?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhaoyi0113",
    "html_url": "https://github.com/zhaoyi0113",
    "followers_url": "https://api.github.com/users/zhaoyi0113/followers",
    "following_url": "https://api.github.com/users/zhaoyi0113/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhaoyi0113/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhaoyi0113/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhaoyi0113/subscriptions",
    "organizations_url": "https://api.github.com/users/zhaoyi0113/orgs",
    "repos_url": "https://api.github.com/users/zhaoyi0113/repos",
    "events_url": "https://api.github.com/users/zhaoyi0113/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhaoyi0113/received_events",
    "type": "User",
    "site_admin": false
  }
}

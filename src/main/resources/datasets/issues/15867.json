{
  "url": "https://api.github.com/repos/facebook/react/issues/15867",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15867/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15867/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15867/events",
  "html_url": "https://github.com/facebook/react/issues/15867",
  "id": 455146732,
  "node_id": "MDU6SXNzdWU0NTUxNDY3MzI=",
  "number": 15867,
  "title": "React Hook cannot call a function in the useEffect and function component to setState operationï¼Ÿ",
  "user": {
    "login": "luojinghui",
    "id": 12367406,
    "node_id": "MDQ6VXNlcjEyMzY3NDA2",
    "avatar_url": "https://avatars1.githubusercontent.com/u/12367406?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luojinghui",
    "html_url": "https://github.com/luojinghui",
    "followers_url": "https://api.github.com/users/luojinghui/followers",
    "following_url": "https://api.github.com/users/luojinghui/following{/other_user}",
    "gists_url": "https://api.github.com/users/luojinghui/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luojinghui/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luojinghui/subscriptions",
    "organizations_url": "https://api.github.com/users/luojinghui/orgs",
    "repos_url": "https://api.github.com/users/luojinghui/repos",
    "events_url": "https://api.github.com/users/luojinghui/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luojinghui/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-06-12T10:58:16Z",
  "updated_at": "2019-06-14T09:55:17Z",
  "closed_at": "2019-06-14T09:55:17Z",
  "author_association": "NONE",
  "body": "Save question [#15865](https://github.com/facebook/react/issues/15865)\r\n\r\nI have a function that needs to be called when componentDidMount and handleClick.\r\n\r\nOn the class component, there is no problem, but I converted to a React Hook function, inside the useEffect, mocking componentDidMount and calling this function. Outside the element, by clicking on the event, we also need to call this function to trigger the new calculation.\r\n\r\n```jsx\r\nfunction App() {\r\n  const [elePositionArr, setElePositionArr] = useState([\r\n    { left: 0, top: 0 },\r\n    { left: 0, top: 0 },\r\n    { left: 0, top: 0 }\r\n  ]);\r\n  const stageRef = useRef(null);\r\n  const Stage = useRef({ w: 0, h: 0 });\r\n  const currentIndex = useRef(0);\r\n\r\n  useEffect(() => {\r\n    // Record the size of the stage when componentDidMount, Important!!!\r\n    const stageW = stageRef.current.scrollWidth;\r\n    const stageH = stageRef.current.scrollHeight;\r\n\r\n    Stage.current = { w: stageW, h: stageH };\r\n\r\n    const index = Math.floor(Math.random() * 3);\r\n    currentIndex.current = index;\r\n    // Randomly set the position of the element\r\n    setCenterPosition(index);\r\n  }, []);\r\n\r\n  // Centering a block element\r\n  function setCenterPosition(index) {\r\n    let cacheEle = elePositionArr;\r\n    // calc center postion\r\n    const centerOfLeft = Stage.current.w / 2 - 25;\r\n    const centerOfTop = Stage.current.h / 2 - 25;\r\n\r\n    cacheEle = cacheEle.map((item, i) => {\r\n      const randomWNum = Math.floor(Math.random() * Stage.current.w) - 50;\r\n      const randomHNum = Math.floor(Math.random() * Stage.current.h) - 50;\r\n      const randomLeft = randomWNum <= 50 ? 50 : randomWNum;\r\n      const randomTop = randomHNum <= 50 ? 50 : randomHNum;\r\n      let newItem;\r\n\r\n      if (index === i) {\r\n        newItem = { left: centerOfLeft, top: centerOfTop };\r\n      } else {\r\n        newItem = { left: randomLeft, top: randomTop };\r\n      }\r\n\r\n      return newItem;\r\n    });\r\n\r\n    setElePositionArr(cacheEle);\r\n  }\r\n\r\n  // click nav li, then setElePositionArr\r\n  function handleClickLi(index) {\r\n    if (currentIndex.current !== index) {\r\n      setCenterPosition(index);\r\n      currentIndex.current = index;\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"container\">\r\n      <div className=\"stage\" ref={stageRef}>\r\n        {elePositionArr.map((item, index) => (\r\n          <div className=\"ele\" key={index} style={item}>\r\n            {index}\r\n          </div>\r\n        ))}\r\n      </div>\r\n      <ul className=\"nav\">\r\n        {elePositionArr.map((item, index) => (\r\n          <li\r\n            className={currentIndex.current === index ? \"active-li\" : \"\"}\r\n            onClick={() => {\r\n              handleClickLi(index);\r\n            }}\r\n            key={\"li\" + index}\r\n          >\r\n            {index}\r\n          </li>\r\n        ))}\r\n      </ul>\r\n    </div>\r\n  );\r\n}\r\n```\r\nSo, React Hook will prompt:\r\n```\r\nReact Hook useEffect has a missing dependency: 'setCenterPosition'.\r\nEither include it or remove the dependency array. (react-hooks/exhaustive-deps)\r\n```\r\nI didn't find a suitable answer in the [8. Hooks FAQ](https://reactjs.org/docs/hooks-faq.html#is-it-safe-to-omit-functions-from-the-list-of-dependencies). Can someone help me?\r\n\r\n**codesandbox**\r\nhttps://codesandbox.io/s/trusting-kowalevski-oet4b\r\n",
  "closed_by": {
    "login": "luojinghui",
    "id": 12367406,
    "node_id": "MDQ6VXNlcjEyMzY3NDA2",
    "avatar_url": "https://avatars1.githubusercontent.com/u/12367406?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luojinghui",
    "html_url": "https://github.com/luojinghui",
    "followers_url": "https://api.github.com/users/luojinghui/followers",
    "following_url": "https://api.github.com/users/luojinghui/following{/other_user}",
    "gists_url": "https://api.github.com/users/luojinghui/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luojinghui/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luojinghui/subscriptions",
    "organizations_url": "https://api.github.com/users/luojinghui/orgs",
    "repos_url": "https://api.github.com/users/luojinghui/repos",
    "events_url": "https://api.github.com/users/luojinghui/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luojinghui/received_events",
    "type": "User",
    "site_admin": false
  }
}

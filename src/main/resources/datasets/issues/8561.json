{
  "url": "https://api.github.com/repos/facebook/react/issues/8561",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/8561/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/8561/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/8561/events",
  "html_url": "https://github.com/facebook/react/issues/8561",
  "id": 195124988,
  "node_id": "MDU6SXNzdWUxOTUxMjQ5ODg=",
  "number": 8561,
  "title": "onChange not registering state change with paste then delaying new state changes",
  "user": {
    "login": "sinthetix",
    "id": 5157195,
    "node_id": "MDQ6VXNlcjUxNTcxOTU=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/5157195?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sinthetix",
    "html_url": "https://github.com/sinthetix",
    "followers_url": "https://api.github.com/users/sinthetix/followers",
    "following_url": "https://api.github.com/users/sinthetix/following{/other_user}",
    "gists_url": "https://api.github.com/users/sinthetix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sinthetix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sinthetix/subscriptions",
    "organizations_url": "https://api.github.com/users/sinthetix/orgs",
    "repos_url": "https://api.github.com/users/sinthetix/repos",
    "events_url": "https://api.github.com/users/sinthetix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sinthetix/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2016-12-13T00:17:38Z",
  "updated_at": "2016-12-13T00:36:57Z",
  "closed_at": "2016-12-13T00:34:44Z",
  "author_association": "NONE",
  "body": "## Bug Report\r\n### onChange not registering state change with paste then delaying new state changes\r\n\r\n**Current Behavior:**\r\nI have a textinput box that has an `onChange` which takes a function as a prop (which sets state in a parent component). onChange is not registering an initial copy and paste. Oddly, when I type an extra key after what I pasted, it returns the string `.length` count of the original paste and _not_ the count with the additional character. It appears that React is one change behind, despite registering that something changed. \r\n\r\nTo make this more clear, I added some console.logs to see the behavior and found this:\r\n\r\n1. With the initial paste, it's triggering the onChange event (in this case, `setAccountKey()`) but, despite explicitly setting state, it's not setting it. The key I'm pasting is 72 characters (verified by irb), but `this.state.accountKey.length` is displaying as 0.\r\n2. When I type another character (making 73 characters), it's triggering the state change that _should have_ been initiated in step one and returning `this.state.accountKey.length` as 72 and `this.state.accountKey` as the original pasted key.\r\n3. When I type yet another character, it is again one step behind and now printing what it should have printed in step 2. \r\n\r\nHere's the abridged code:\r\n```jsx\r\nimport React, { Component, PropTypes } from 'react';\r\nimport Router from 'react-router';\r\nimport AuthForm from '../components/AuthForm';\r\nimport KeyEntry from '../components/KeyEntry';\r\n\r\nexport default class AuthorizationContainer extends Component {\r\n  constructor(props, context) {\r\n    super(props, context);\r\n    this.state = {\r\n      accountKey: '',\r\n    };\r\n    this.setAccountKey = this.setAccountKey.bind(this);\r\n    this.keyLengthValid = this.keyLengthValid.bind(this);\r\n  }\r\n\r\n  setAccountKey(event) {\r\n    let text = event.target.value;\r\n    this.setState({ accountKey: text });\r\n    console.log('I got here!');\r\n    // 'I got here' did display on initial paste\r\n    this.keyLengthValid();\r\n    console.log(this.state.accountKey);\r\n    console.log(this.keyLengthValid());\r\n    console.log(this.state.accountKey.length);\r\n\r\n  }\r\n\r\n  keyLengthValid() {\r\n    return this.state.accountKey.length === 72;\r\n  }\r\n\r\n  render() {\r\n    return (\r\n      <AuthForm onSubmitKey={ this.handleSubmitKey }>\r\n        <KeyEntry setAccountKey={ this.setAccountKey } />\r\n      </AuthForm>\r\n    );\r\n  }\r\n};\r\n\r\nAuthorizationContainer.contextTypes = {\r\n    router: PropTypes.object.isRequired,\r\n};\r\n\r\n////////////////////////\r\n\r\nimport React, { PropTypes, Component } from 'react';\r\n\r\nexport default class KeyEntry extends Component {\r\n  constructor(props) {\r\n    super(props);\r\n  }\r\n  render () {\r\n    return (\r\n      <textarea onChange={this.props.setAccountKey} placeholder=\"Please enter a valid API key.\" />\r\n  );\r\n }\r\n};\r\n\r\nKeyEntry.propTypes = {\r\n  setAccountKey: PropTypes.func.isRequired,\r\n};\r\n```\r\n\r\n**Expected behavior:**\r\nOn paste, accountKey state would be the key pasted and have a length of 72.\r\n\r\n**Versions Tested:**\r\nReact version: 15.4.1\r\nChrome version: 54.0.2840.98\r\n\r\nSimilar issue: #7211 ",
  "closed_by": {
    "login": "sinthetix",
    "id": 5157195,
    "node_id": "MDQ6VXNlcjUxNTcxOTU=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/5157195?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sinthetix",
    "html_url": "https://github.com/sinthetix",
    "followers_url": "https://api.github.com/users/sinthetix/followers",
    "following_url": "https://api.github.com/users/sinthetix/following{/other_user}",
    "gists_url": "https://api.github.com/users/sinthetix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sinthetix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sinthetix/subscriptions",
    "organizations_url": "https://api.github.com/users/sinthetix/orgs",
    "repos_url": "https://api.github.com/users/sinthetix/repos",
    "events_url": "https://api.github.com/users/sinthetix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sinthetix/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/5807",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/5807/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/5807/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/5807/events",
  "html_url": "https://github.com/facebook/react/issues/5807",
  "id": 125589541,
  "node_id": "MDU6SXNzdWUxMjU1ODk1NDE=",
  "number": 5807,
  "title": "<input> Ctrl+Z broken on a-synchronous setState()",
  "user": {
    "login": "rogierschouten",
    "id": 7348032,
    "node_id": "MDQ6VXNlcjczNDgwMzI=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/7348032?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rogierschouten",
    "html_url": "https://github.com/rogierschouten",
    "followers_url": "https://api.github.com/users/rogierschouten/followers",
    "following_url": "https://api.github.com/users/rogierschouten/following{/other_user}",
    "gists_url": "https://api.github.com/users/rogierschouten/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rogierschouten/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rogierschouten/subscriptions",
    "organizations_url": "https://api.github.com/users/rogierschouten/orgs",
    "repos_url": "https://api.github.com/users/rogierschouten/repos",
    "events_url": "https://api.github.com/users/rogierschouten/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rogierschouten/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2016-01-08T11:07:43Z",
  "updated_at": "2017-10-03T23:17:33Z",
  "closed_at": "2017-10-03T23:17:33Z",
  "author_association": "NONE",
  "body": "The example below is a simple page with just one <input> element. Typing in the <input> goes just fine. However, Ctrl+Z (undo) is broken in Chrome and IE:  in Chrome, it doesn't remove the first typed letter. In IE, it actually only adds stuff.\n\n``` javascript\nvar React = require(\"react\");\n\nvar MyInput = React.createClass({\n    render: function() {\n        var _this = this;\n        return (React.createElement(\"input\", {\n            \"onChange\": function (event) {\n                var value = event.target.value;\n                setTimeout(function () {\n                    _this.setState({ value: value });\n                }, 0);\n            }, \n            \"type\": \"text\",\n            \"value\": this.state.value\n        }));\n    }\n});\n\nReactDOM.render(\n  React.createElement(MyInput, null),\n  document.getElementById('all-content')\n);\n```\n\nThe culprit here is my a-synchronous setState() call - remove the setTimeout() and it works properly. However it is React that breaks this: the browsers can handle a-sync updates just fine without React:\n\n``` html\n<!doctype html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"utf-8\"/>\n    <script>\n        function onInput(event) {\n            var value = event.target.value;\n            var input = document.getElementById(\"myinput\");\n            setTimeout(function() {\n                input.value = value;\n            }, 0);\n        }\n    </script>\n</head>\n<body>\n    <input type=\"text\" id=\"myinput\" onInput=\"onInput(event)\">\n</body>\n</html>\n```\n\nThis example works just fine, even with the setTimeout() present.\n\nThe above are simplified examples, not my actual use case (a flux-like store framework that sends updates a-synchronously in an animation frame / React.addons.batchedUpdates to be able to condense change events and improve performance).  \n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/15298",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15298/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15298/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15298/events",
  "html_url": "https://github.com/facebook/react/issues/15298",
  "id": 428364441,
  "node_id": "MDU6SXNzdWU0MjgzNjQ0NDE=",
  "number": 15298,
  "title": "Context API not working as expected",
  "user": {
    "login": "champi-dev",
    "id": 25520803,
    "node_id": "MDQ6VXNlcjI1NTIwODAz",
    "avatar_url": "https://avatars0.githubusercontent.com/u/25520803?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/champi-dev",
    "html_url": "https://github.com/champi-dev",
    "followers_url": "https://api.github.com/users/champi-dev/followers",
    "following_url": "https://api.github.com/users/champi-dev/following{/other_user}",
    "gists_url": "https://api.github.com/users/champi-dev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/champi-dev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/champi-dev/subscriptions",
    "organizations_url": "https://api.github.com/users/champi-dev/orgs",
    "repos_url": "https://api.github.com/users/champi-dev/repos",
    "events_url": "https://api.github.com/users/champi-dev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/champi-dev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-04-02T17:58:17Z",
  "updated_at": "2019-04-02T19:16:05Z",
  "closed_at": "2019-04-02T19:16:05Z",
  "author_association": "NONE",
  "body": "**bug**\r\nhttps://codesandbox.io/s/kxw33x77v5\r\n\r\n**Current Behaviour**\r\nWhen the method `setAlertMessage` gets triggered the Context's state changes as expected (a console.log inside the method reveals that the state has changed) but the component doesn't receive the updated state\r\n\r\n**Steps to reproduce**\r\n`innerContext.js`\r\n```javascript\r\nimport React from 'react'\r\n\r\nconst state = {\r\n  display: true,\r\n  status: '', // success or error\r\n  message: ''\r\n}\r\n\r\nconst methods = {\r\n  setAlertMessage ({ display, status, message }) {\r\n    state.display = display\r\n    state.status = status\r\n    state.message = message\r\n  }\r\n}\r\n\r\nexport const innerContextValue = {\r\n  state,\r\n  methods\r\n}\r\n\r\nconst InnerContext = React.createContext({})\r\nexport const Provider = InnerContext.Provider\r\nexport const Consumer = InnerContext.Consumer\r\n```\r\n\r\n`AlertMessage.js`\r\n```javascript\r\nimport React, { Component } from 'react'\r\nimport { Provider, Consumer, innerContextValue } from './innerContext'\r\nimport styled from 'styled-components'\r\n\r\nimport shared from '../../styles/shared'\r\nimport closeIcon from '../../assets/close-icon-white.svg'\r\n\r\nconst AlertMsgComponent = styled.div`\r\n  width: 66%;\r\n  height: 6.4rem;\r\n  z-index: 100;  \r\n  border-radius: 0.4rem;\r\n  position: fixed;  \r\n  top: -100%;\r\n  left: 50%;\r\n  transform: translateX(-50%);\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  padding: 0 2.4rem;\r\n  transition: top 300ms ease-in-out;\r\n\r\n  &.visible {\r\n    top: 1.6rem;\r\n  }\r\n\r\n  &.error {\r\n    background: ${shared.colors.dangerAlt};\r\n  }\r\n\r\n  &.success {\r\n    background: ${shared.colors.primary.dark};\r\n  }\r\n`\r\n\r\nconst AlertMsgText = styled.span`\r\n  font-size: 1.6rem;\r\n  color: ${shared.colors.secondary};\r\n`\r\n\r\nconst AlertClose = styled.img`\r\n  cursor: pointer;\r\n  width: 2.4rem;\r\n  height: 2.4rem;\r\n`\r\n\r\nclass AlertMessage extends Component {\r\n  render () {\r\n    return (\r\n      <Provider value={innerContextValue}>\r\n        <Consumer>\r\n          {\r\n            ({ state, methods }) => (\r\n              <AlertMsgComponent\r\n                className={`${state.status} ${state.display ? 'visible' : ''}`}\r\n              >\r\n                <AlertMsgText>{state.message}</AlertMsgText>\r\n                <AlertClose\r\n                  src={closeIcon}\r\n                  alt=''\r\n                  onClick={() => methods.setAlertMessage({ display: false, message: '', status: '' })}\r\n                />\r\n              </AlertMsgComponent>\r\n            )\r\n          }\r\n        </Consumer>\r\n      </Provider>\r\n    )\r\n  }\r\n}\r\n\r\nexport default AlertMessage\r\n```\r\n\r\n**Expected Behaviour**\r\nAlertMsgComponent's className should drop the class 'visible' once setAlertMessage gets triggered\r\n\r\n**React versions**\r\n`package.json`\r\n```json\r\n{\r\n  \"name\": \"rise-webapp\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"dependencies\": {\r\n    \"axios\": \"^0.18.0\",\r\n    \"eslint-config-standard\": \"^12.0.0\",\r\n    \"eslint-config-standard-react\": \"^7.0.2\",\r\n    \"eslint-plugin-import\": \"^2.16.0\",\r\n    \"eslint-plugin-node\": \"^8.0.1\",\r\n    \"eslint-plugin-promise\": \"^4.0.1\",\r\n    \"eslint-plugin-react\": \"^7.12.4\",\r\n    \"eslint-plugin-standard\": \"^4.0.0\",\r\n    \"formik\": \"^1.5.1\",\r\n    \"react\": \"^16.7.0\",\r\n    \"react-dom\": \"^16.7.0\",\r\n    \"react-router\": \"^4.3.1\",\r\n    \"react-router-dom\": \"^4.3.1\",\r\n    \"react-scripts\": \"2.1.3\",\r\n    \"styled-components\": \"^4.1.3\",\r\n    \"yup\": \"^0.26.10\"\r\n  },\r\n  \"scripts\": {\r\n    \"start\": \"react-scripts start\",\r\n    \"build\": \"react-scripts build\",\r\n    \"test\": \"react-scripts test\",\r\n    \"eject\": \"react-scripts eject\",\r\n    \"format-code\": \"eslint --fix --ext .js --ignore-path .gitignore .\"\r\n  },\r\n  \"browserslist\": [\r\n    \">0.2%\",\r\n    \"not dead\",\r\n    \"not ie <= 11\",\r\n    \"not op_mini all\"\r\n  ],\r\n  \"devDependencies\": {\r\n    \"eslint-plugin-babel\": \"^5.3.0\"\r\n  }\r\n}\r\n```\r\n",
  "closed_by": {
    "login": "champi-dev",
    "id": 25520803,
    "node_id": "MDQ6VXNlcjI1NTIwODAz",
    "avatar_url": "https://avatars0.githubusercontent.com/u/25520803?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/champi-dev",
    "html_url": "https://github.com/champi-dev",
    "followers_url": "https://api.github.com/users/champi-dev/followers",
    "following_url": "https://api.github.com/users/champi-dev/following{/other_user}",
    "gists_url": "https://api.github.com/users/champi-dev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/champi-dev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/champi-dev/subscriptions",
    "organizations_url": "https://api.github.com/users/champi-dev/orgs",
    "repos_url": "https://api.github.com/users/champi-dev/repos",
    "events_url": "https://api.github.com/users/champi-dev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/champi-dev/received_events",
    "type": "User",
    "site_admin": false
  }
}

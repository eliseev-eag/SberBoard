{
  "url": "https://api.github.com/repos/facebook/react/issues/12734",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/12734/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/12734/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/12734/events",
  "html_url": "https://github.com/facebook/react/issues/12734",
  "id": 319658969,
  "node_id": "MDU6SXNzdWUzMTk2NTg5Njk=",
  "number": 12734,
  "title": "Child component correctly deletes parent's state's object entry, but wrong child is unmounted upon re-render",
  "user": {
    "login": "DavideValdo",
    "id": 26572302,
    "node_id": "MDQ6VXNlcjI2NTcyMzAy",
    "avatar_url": "https://avatars1.githubusercontent.com/u/26572302?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DavideValdo",
    "html_url": "https://github.com/DavideValdo",
    "followers_url": "https://api.github.com/users/DavideValdo/followers",
    "following_url": "https://api.github.com/users/DavideValdo/following{/other_user}",
    "gists_url": "https://api.github.com/users/DavideValdo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DavideValdo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DavideValdo/subscriptions",
    "organizations_url": "https://api.github.com/users/DavideValdo/orgs",
    "repos_url": "https://api.github.com/users/DavideValdo/repos",
    "events_url": "https://api.github.com/users/DavideValdo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DavideValdo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-05-02T18:15:57Z",
  "updated_at": "2018-05-02T18:23:42Z",
  "closed_at": "2018-05-02T18:23:41Z",
  "author_association": "NONE",
  "body": "I have an `Order` component which keeps a Javascript object in `this.state.newItems` and renders `OrderItem` components for each of it's child\r\n\r\n`OrderItem` also receives callbacks to operate on the parent's state\r\n\r\nI am getting a behavior such as the javascript object being updated correctly on delete, but the wrong node is unmounted\r\n\r\nVideo:\r\nhttps://streamable.com/bjesf\r\n\r\nRelevant code:\r\n```\r\nexport default class Order extends Component {\r\n  constructor (props) {\r\n    super (props)\r\n\r\n    this.state = {\r\n        newItems: null\r\n    }\r\n\r\n    if (this.props.isNew)\r\n        this.data = null\r\n    else {\r\n        this.data = { ... this.props }\r\n    }\r\n  }\r\n\r\n  /* _commit = () => {\r\n    console.log(this.data)\r\n    if (this.data.trim().length > 0)\r\n      socket.emit('article:client:insert', { name: this.data })\r\n  } */\r\n\r\n  addNewOrderItem = async () => {\r\n    let _ = this.state.newItems ? { ... this.state.newItems } : {}\r\n\r\n    _[Date.now().toString()] = {\r\n        articleData: {\r\n          isNew: true,\r\n          unitaryPrice: 0.0\r\n        }\r\n    }\r\n\r\n    await this.setState({\r\n        newItems: _\r\n    })\r\n\r\n    console.log(this.state.newItems)\r\n  }\r\n\r\n  deleteNewOrderItem = async id => {\r\n      let _ = { ...this.state.newItems }\r\n\r\n      console.log(\"Deleting \" + id)\r\n      delete _[id]\r\n\r\n      await this.setState({\r\n        newItems: _\r\n      })\r\n\r\n      console.log(this.state.newItems)\r\n  }\r\n\r\n  updateNewOrderItem = async (id, value) => {\r\n      let _ = { ...this.state.newItems }\r\n      _[id] = value\r\n\r\n      await this.setState({\r\n        newItems: _\r\n      })\r\n\r\n      console.log(this.state.newItems)\r\n  }\r\n\r\n  renderNewItems () {\r\n      if (!this.state.newItems) return null\r\n\r\n      let _ = []\r\n      for (let _id in this.state.newItems)\r\n          _.push(\r\n            <OrderItem \r\n                articleData={this.state.newItems[_id].articleData}\r\n                id={_id}\r\n                onUpdate={this.updateNewOrderItem}\r\n                onDelete={this.deleteNewOrderItem}\r\n            />\r\n          )\r\n      \r\n      return _\r\n  }\r\n\r\n  render () {\r\n    const { data } = this\r\n\r\n    return (\r\n       // ...\r\n        {\r\n            this.renderNewItems()\r\n        }\r\n       // ...\r\n    )\r\n  }\r\n}\r\n```\r\n```\r\nexport default class OrderItem extends React.Component {\r\n  state = {\r\n    base64img: null\r\n  }\r\n\r\n  constructor (props) {\r\n    super (props)\r\n    this.setData(props)\r\n  }\r\n\r\n  componentWillUnmount () {\r\n    console.log(\"Will unmount \" + this.props.id)\r\n  }\r\n\r\n  setData (props) {\r\n    this.data = { ...props }\r\n    delete this.data.onDelete\r\n    delete this.data.onUpdate\r\n  }\r\n\r\n  handleImageInsert = (event) => {\r\n    let objectFile = event.target.files[0]\r\n    if (!objectFile) return\r\n\r\n    let reader = new FileReader()\r\n\r\n    reader.onload = upload => \r\n      this.setState({\r\n        base64img: upload.target.result\r\n      })\r\n\r\n    reader.readAsDataURL(objectFile)\r\n    this.data.articleData.newImage = objectFile\r\n\r\n    this.updateData()\r\n  }\r\n\r\n  handleUnitaryPriceChange = e => {\r\n      let newPrice = parseFloat(e.target.value)\r\n      if (newPrice != NaN) {\r\n        this.data.articleData.unitaryPrice = newPrice\r\n        this.updateData()\r\n      }\r\n  }\r\n\r\n  handleBriefChange = e => {\r\n    this.data.articleData.brief = e.target.value\r\n    this.updateData()\r\n  }\r\n\r\n  handleTableChange = update => {\r\n    this.data = { ... this.data, ... update }\r\n    this.updateData()\r\n  }\r\n\r\n  updateData = () => {\r\n    this.props.onUpdate(this.props.id, this.data)\r\n  }\r\n\r\n  confirmDelete = () => {\r\n    this.props.onDelete(this.props.id)\r\n  }\r\n\r\n  render () {\r\n    const { data: { articleData } } = this\r\n\r\n    return (\r\n      <div>\r\n        <input\r\n          ref={ref => this.fileUploadRef = ref}\r\n          onChange={this.handleImageInsert}\r\n          style={{ display: 'none' }}\r\n          type=\"file\"\r\n          accept=\"image/*\"\r\n        />\r\n        <div className=\"orderTableImageColumn\">\r\n          {\r\n            this.state.base64img &&\r\n            <img src={this.state.base64img} style={{width: '100%'}} />\r\n          }\r\n          <div className=\"orderTableImageColumnControls\">\r\n            <Button\r\n              variant=\"raised\"\r\n              className=\"print-hide\"\r\n              color=\"primary\"\r\n              style={{ display: 'inline-block' }}\r\n              onClick={() => this.fileUploadRef.click()}\r\n            >\r\n              <PhotoCamera />\r\n            </Button>&nbsp;&nbsp;\r\n            <Button\r\n              variant=\"raised\"\r\n              className=\"print-hide\"\r\n              color=\"primary\"\r\n              style={{ display: 'inline-block', backgroundColor: 'red' }}\r\n              onClick={this.confirmDelete}\r\n            >\r\n              <Delete />\r\n            </Button>\r\n          </div>\r\n        </div>\r\n        <div\r\n          style={{\r\n            whiteSpace: 'normal',\r\n            wordWrap: 'break-word',\r\n            width: '65%',\r\n            padding: '2%',\r\n            paddingLeft: '1%',\r\n            verticalAlign: 'top',\r\n            display: 'inline-block'\r\n          }}>\r\n            <div style={{display: 'inline-block', width: '50%'}}>\r\n              {\r\n                !(articleData.isPending || articleData.isNew) && <span className='tableLabelSmall'>SKU</span>\r\n              }\r\n\r\n              <br /><br />\r\n              <textarea \r\n                name=\"brief\"\r\n                className='articleBriefTextarea'\r\n                onChange={this.handleBriefChange}\r\n                value={articleData.brief ? articleData.brief : 'Descrizione'}\r\n                />\r\n            </div>\r\n            <div style={{\r\n              display: 'inline-block', \r\n              width: '47%',\r\n              marginLeft: '1%',\r\n              padding: '1%',\r\n              verticalAlign: 'top',\r\n              backgroundColor: 'gold'\r\n            }}>\r\n              <span className='tableLabelSmall'>PREZZO UNITARIO €</span>&nbsp;&nbsp;\r\n              <input \r\n                type=\"text\" \r\n                style={{padding: '5px', marginBottom: '3px'}} \r\n                oninput=\"this.value = this.value.replace(/[^0-9.]/g, ''); this.value = this.value.replace(/(\\..*)\\./g, '$1');\" \r\n                name=\"unitaryPrice\"\r\n                placeholder='0'\r\n                onChange={this.handleUnitaryPriceChange}\r\n              />\r\n              <br />\r\n              <textarea\r\n                name=\"needs\"\r\n                className='articleBriefTextarea'\r\n                value={articleData.needs ? articleData.needs : 'Materiali, accessori, necessità'}\r\n              />\r\n            </div>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n```\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/7178",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/7178/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/7178/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/7178/events",
  "html_url": "https://github.com/facebook/react/pull/7178",
  "id": 163550801,
  "node_id": "MDExOlB1bGxSZXF1ZXN0NzYwODI3NDY=",
  "number": 7178,
  "title": "Flat bundle using Rollup",
  "user": {
    "login": "keyz",
    "id": 2268452,
    "node_id": "MDQ6VXNlcjIyNjg0NTI=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/2268452?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/keyz",
    "html_url": "https://github.com/keyz",
    "followers_url": "https://api.github.com/users/keyz/followers",
    "following_url": "https://api.github.com/users/keyz/following{/other_user}",
    "gists_url": "https://api.github.com/users/keyz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/keyz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/keyz/subscriptions",
    "organizations_url": "https://api.github.com/users/keyz/orgs",
    "repos_url": "https://api.github.com/users/keyz/repos",
    "events_url": "https://api.github.com/users/keyz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/keyz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "zpao",
    "id": 8445,
    "node_id": "MDQ6VXNlcjg0NDU=",
    "avatar_url": "https://avatars1.githubusercontent.com/u/8445?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zpao",
    "html_url": "https://github.com/zpao",
    "followers_url": "https://api.github.com/users/zpao/followers",
    "following_url": "https://api.github.com/users/zpao/following{/other_user}",
    "gists_url": "https://api.github.com/users/zpao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zpao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zpao/subscriptions",
    "organizations_url": "https://api.github.com/users/zpao/orgs",
    "repos_url": "https://api.github.com/users/zpao/repos",
    "events_url": "https://api.github.com/users/zpao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zpao/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "zpao",
      "id": 8445,
      "node_id": "MDQ6VXNlcjg0NDU=",
      "avatar_url": "https://avatars1.githubusercontent.com/u/8445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zpao",
      "html_url": "https://github.com/zpao",
      "followers_url": "https://api.github.com/users/zpao/followers",
      "following_url": "https://api.github.com/users/zpao/following{/other_user}",
      "gists_url": "https://api.github.com/users/zpao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zpao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zpao/subscriptions",
      "organizations_url": "https://api.github.com/users/zpao/orgs",
      "repos_url": "https://api.github.com/users/zpao/repos",
      "events_url": "https://api.github.com/users/zpao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zpao/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 28,
  "created_at": "2016-07-03T07:12:56Z",
  "updated_at": "2017-03-10T02:08:32Z",
  "closed_at": "2017-03-10T02:08:32Z",
  "author_association": "CONTRIBUTOR",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/7178",
    "html_url": "https://github.com/facebook/react/pull/7178",
    "diff_url": "https://github.com/facebook/react/pull/7178.diff",
    "patch_url": "https://github.com/facebook/react/pull/7178.patch"
  },
  "body": "This implements #6351 using [Rollup](https://www.youtube.com/watch?v=UhQz-0QVmQ0). It could be used to replace our Browserify build step (i.e., it takes pre-built files from `./build/modules`) and it's pretty similar to #4230.\n\nFirstly I moved all our non-top-level requires to the top level and `__DEV__` on their usage (we only have 5 files that have that). Since we no longer have dynamic parts in our require/exports, they are pretty much ES6-compliant. Then there's a Babel pass for Rollup to firstly rewrite all require/exports to ES6 import/exports, and finally it bundles to a flat file (in UMD format). It sounds weird to transpile files from ES5 to ES6 but using this babel pass results in smaller file sizes comparing with using Rollup's CommonJS plugin.\n\nThis decreases our gzipped minified (prod) file size by ~10% and some of the benchmarks look pretty good.\n\ncc @facebook/react-core \n### Size Comparison\n\n```\nRunning \"compare_size:files\" (compare_size) task\n   raw     gz Sizes\n  1199    641 build/react-dom-server.js\n   734    445 build/react-dom-server.min.js\n  1180    632 build/react-dom.js\n   715    436 build/react-dom.min.js\n668011 157714 build/react-with-addons.js\n157020  46842 build/react-with-addons.min.js\n601268 143463 build/react.js\n134356  40475 build/react.min.js\n\n   raw     gz Compared to master @ e5513eceff9ce8ae24f1d4de934408e2cc47311b\n     =      = build/react-dom-server.js\n     =      = build/react-dom-server.min.js\n     =      = build/react-dom.js\n     =      = build/react-dom.min.js\n-112191-16858 build/react-with-addons.js\n -4003   -942 build/react-with-addons.min.js\n-100276-13997 build/react.js\n-15062  -4011 build/react.min.js\n```\n### Benchmarks\n\n```\nComparing min.txt (control) vs rollup.txt (test)\nSignificant differences marked by ***\n% change from control to test, with 99% CIs:\n\n* factory_ms_jsc_jit\n    % change: -32.37% [-34.96%, -29.78%]  ***\n    means: 16.6517 (control), 11.263 (test)\n* factory_ms_jsc_nojit\n    % change: -32.88% [-35.85%, -29.91%]  ***\n    means: 15.6549 (control), 10.509 (test)\n* factory_ms_node\n    % change: -33.34% [-35.78%, -30.90%]  ***\n    means: 50.0445 (control), 33.3632 (test)\n* ssr_pe_cold_ms_jsc_jit\n    % change:  -1.71% [ -5.26%,  +1.84%]\n    means: 26.7829 (control), 26.3289 (test)\n* ssr_pe_cold_ms_jsc_nojit\n    % change:  +2.23% [ -3.06%,  +7.52%]\n    means: 28.3938 (control), 29.0334 (test)\n* ssr_pe_cold_ms_node\n    % change:  +1.36% [ -1.29%,  +4.02%]\n    means: 51.2295 (control), 51.9317 (test)\n```\n\nTODO:\n- [x] Let Babel throw if there are non-top-level requires/exports\n- [x] Instead of having Rollup config files, make it a script that can be executed by gulp/grunt\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

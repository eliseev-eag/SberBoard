{
  "url": "https://api.github.com/repos/facebook/react/issues/14182",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14182/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14182/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14182/events",
  "html_url": "https://github.com/facebook/react/pull/14182",
  "id": 379348066,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MjI5ODQwMDky",
  "number": 14182,
  "title": "Use unique thread ID for each partial render to access Context",
  "user": {
    "login": "sebmarkbage",
    "id": 63648,
    "node_id": "MDQ6VXNlcjYzNjQ4",
    "avatar_url": "https://avatars2.githubusercontent.com/u/63648?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sebmarkbage",
    "html_url": "https://github.com/sebmarkbage",
    "followers_url": "https://api.github.com/users/sebmarkbage/followers",
    "following_url": "https://api.github.com/users/sebmarkbage/following{/other_user}",
    "gists_url": "https://api.github.com/users/sebmarkbage/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sebmarkbage/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sebmarkbage/subscriptions",
    "organizations_url": "https://api.github.com/users/sebmarkbage/orgs",
    "repos_url": "https://api.github.com/users/sebmarkbage/repos",
    "events_url": "https://api.github.com/users/sebmarkbage/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sebmarkbage/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 19,
  "created_at": "2018-11-09T22:44:58Z",
  "updated_at": "2018-11-23T16:14:10Z",
  "closed_at": "2018-11-09T23:38:21Z",
  "author_association": "MEMBER",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/14182",
    "html_url": "https://github.com/facebook/react/pull/14182",
    "diff_url": "https://github.com/facebook/react/pull/14182.diff",
    "patch_url": "https://github.com/facebook/react/pull/14182.patch"
  },
  "body": "Fixes #13874\r\n\r\nAlternative to #13877\r\n\r\nThis first adds an allocator that keeps track of a unique ThreadID index for each currently executing partial renderer. IDs are not just growing but are reused as streams are destroyed.\r\n\r\nThis ensures that IDs are kept nice and compact.\r\n\r\n_One minor breakage is that it is no longer safe to just let streams be GC:ed for clean up. Typically, they you would never drop a stream on the floor. It's either exhausted or errors._\r\n\r\nThis lets us use an \"array\" for each Context object to store the current values. The look up for these are fast because they're just looking up an offset in a tightly packed \"array\".\r\n\r\nI don't use an actual Array object to store the values. Instead, I rely on that VMs (notably V8) treat storage of numeric index property access as a separate \"elements\" allocation.\r\n\r\nThis lets us avoid an extra indirection.\r\n\r\nHowever, we must ensure that these arrays are not holey to preserve this feature.\r\n\r\nTo do that I store the `_threadCount` on each context (effectively it takes the place of the `.length` property on an array, and also lets me use that pun). It's unclear whether a \"real\" `.length` would be faster if it could avoid the internal bounds check.\r\n\r\nThis lets us first validate that the context has enough slots before we access the slot. If not, we fill in the slots with the default value.\r\n\r\nThis *should* be a fast approach, in theory, but I haven't actually confirmed that the builds don't deopt somewhere yet.\r\n\r\ncc @leebyron ",
  "closed_by": {
    "login": "sebmarkbage",
    "id": 63648,
    "node_id": "MDQ6VXNlcjYzNjQ4",
    "avatar_url": "https://avatars2.githubusercontent.com/u/63648?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sebmarkbage",
    "html_url": "https://github.com/sebmarkbage",
    "followers_url": "https://api.github.com/users/sebmarkbage/followers",
    "following_url": "https://api.github.com/users/sebmarkbage/following{/other_user}",
    "gists_url": "https://api.github.com/users/sebmarkbage/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sebmarkbage/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sebmarkbage/subscriptions",
    "organizations_url": "https://api.github.com/users/sebmarkbage/orgs",
    "repos_url": "https://api.github.com/users/sebmarkbage/repos",
    "events_url": "https://api.github.com/users/sebmarkbage/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sebmarkbage/received_events",
    "type": "User",
    "site_admin": false
  }
}

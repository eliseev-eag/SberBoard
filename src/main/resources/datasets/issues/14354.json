{
  "url": "https://api.github.com/repos/facebook/react/issues/14354",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14354/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14354/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14354/events",
  "html_url": "https://github.com/facebook/react/issues/14354",
  "id": 385560200,
  "node_id": "MDU6SXNzdWUzODU1NjAyMDA=",
  "number": 14354,
  "title": "Hooks: callback in useEffect is not always fired in same time.",
  "user": {
    "login": "morlay",
    "id": 1667873,
    "node_id": "MDQ6VXNlcjE2Njc4NzM=",
    "avatar_url": "https://avatars0.githubusercontent.com/u/1667873?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/morlay",
    "html_url": "https://github.com/morlay",
    "followers_url": "https://api.github.com/users/morlay/followers",
    "following_url": "https://api.github.com/users/morlay/following{/other_user}",
    "gists_url": "https://api.github.com/users/morlay/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/morlay/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/morlay/subscriptions",
    "organizations_url": "https://api.github.com/users/morlay/orgs",
    "repos_url": "https://api.github.com/users/morlay/repos",
    "events_url": "https://api.github.com/users/morlay/events{/privacy}",
    "received_events_url": "https://api.github.com/users/morlay/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 710722093,
      "node_id": "MDU6TGFiZWw3MTA3MjIwOTM=",
      "url": "https://api.github.com/repos/facebook/react/labels/Type:%20Needs%20Investigation",
      "name": "Type: Needs Investigation",
      "color": "fbca04",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-11-29T03:59:58Z",
  "updated_at": "2019-01-18T03:31:12Z",
  "closed_at": "2019-01-18T03:31:11Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n**Do you want to request a *feature* or report a *bug*?**\r\nmaybe a **bug**?\r\n\r\n**What is the current behavior?**\r\nsee bellow.\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\n```js\r\nimport React from \"react\";\r\nimport { render } from \"react-dom\";\r\nimport { useState, useLayoutEffect, useEffect } from \"react\";\r\n\r\nfunction App() {\r\n  const [mounted, setMount] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    console.log(\"App effect\");\r\n    setMount(s => s + \"App mounted;\");\r\n  }, []);\r\n\r\n  useLayoutEffect(() => {\r\n    console.log(\"App layout effect\");\r\n    setMount(s => s + \"App layout mounted;\");\r\n  }, []);\r\n\r\n  return <div>{mounted}</div>;\r\n}\r\n\r\nfunction App2() {\r\n  const [mounted, setMount] = useState(\"\");\r\n\r\n  useEffect(() => {\r\n    console.log(\"App2 effect\");\r\n    setMount(s => s + \"App2 mounted;\");\r\n  }, []);\r\n\r\n  useLayoutEffect(() => {\r\n    console.log(\"App2 layout effect\");\r\n  }, []);\r\n\r\n  return <div>{mounted}</div>;\r\n}\r\n\r\ntest(\"test App\", () => {\r\n  const node = mount(<App />);\r\n  console.log(\"mounted\", node.innerHTML);\r\n});\r\n\r\ntest(\"test App2\", () => {\r\n  const node = mount(<App2 />);\r\n  console.log(\"mounted\", node.innerHTML);\r\n});\r\n\r\nfunction mount(e) {\r\n  const node = document.createElement(\"div\");\r\n  render(e, node);\r\n  return node;\r\n}\r\n```\r\n[![Edit 3vv85q81x6](https://codesandbox.io/static/img/play-codesandbox.svg)](https://codesandbox.io/s/3vv85q81x6)\r\nrun the tests, and see the log.\r\n\r\n**What is the expected behavior?**\r\n```\r\nApp layout effect \r\nApp effect \r\nmounted <div>App layout mounted;App mounted;</div> \r\nApp2 layout effect \r\nApp2 effect\r\nmounted <div>App2 mounted;</div> \r\n```\r\nBut got \r\n\r\n![image](https://user-images.githubusercontent.com/1667873/49198532-77970a80-f3ce-11e8-8952-54562bc2d1e8.png)\r\n\r\nafter useEffect callback firing in `App2`, we can't get re-rendered dom.\r\nbtw, in codesandbox, log the `App2 effect`, but in local node env, will lost the log `App2 effect` \r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n \r\n* react 16.7.0-alpha.2\r\n* react-dom 16.7.0-alpha.2\r\n* node 10.13.0\r\n* macOS mojave 10.14.1\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/15379",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/15379/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/15379/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/15379/events",
  "html_url": "https://github.com/facebook/react/issues/15379",
  "id": 431787431,
  "node_id": "MDU6SXNzdWU0MzE3ODc0MzE=",
  "number": 15379,
  "title": "\"not wrapped in act(...)\" warning triggered by an async change in useEffect; Not sure how to fix.",
  "user": {
    "login": "rally25rs",
    "id": 38535,
    "node_id": "MDQ6VXNlcjM4NTM1",
    "avatar_url": "https://avatars3.githubusercontent.com/u/38535?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rally25rs",
    "html_url": "https://github.com/rally25rs",
    "followers_url": "https://api.github.com/users/rally25rs/followers",
    "following_url": "https://api.github.com/users/rally25rs/following{/other_user}",
    "gists_url": "https://api.github.com/users/rally25rs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rally25rs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rally25rs/subscriptions",
    "organizations_url": "https://api.github.com/users/rally25rs/orgs",
    "repos_url": "https://api.github.com/users/rally25rs/repos",
    "events_url": "https://api.github.com/users/rally25rs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rally25rs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 139734344,
      "node_id": "MDU6TGFiZWwxMzk3MzQzNDQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/Component:%20Test%20Utils",
      "name": "Component: Test Utils",
      "color": "eb6420",
      "default": false
    },
    {
      "id": 40929152,
      "node_id": "MDU6TGFiZWw0MDkyOTE1Mg==",
      "url": "https://api.github.com/repos/facebook/react/labels/Resolution:%20Duplicate",
      "name": "Resolution: Duplicate",
      "color": "cccccc",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-04-11T01:20:55Z",
  "updated_at": "2019-10-08T12:19:48Z",
  "closed_at": "2019-04-11T12:51:19Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\n\r\nNot really either; perhaps just an issue with the `act` design?\r\n\r\n**What is the current behavior?**\r\n\r\nI receive the `Warning: An update to ... inside a test was not wrapped in act(...).` warning if a component under test has a `useEffect` that makes a change to itself async (I assume because the component updates itself after the `act` block)\r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nI think I've distilled this as far as I can:\r\n\r\n```javascript\r\n// This is the component under test\r\nfunction TestComponent() {\r\n  const [initialized, setInitialized] = React.useState(false);\r\n\r\n  // this function would really be a jest mock.fn of an async http request.\r\n  // just put it here to simplify the test.\r\n  const loadData = () => {\r\n    return new Promise(resolve => {\r\n      resolve();\r\n    });\r\n  };\r\n\r\n  React.useEffect(() => {\r\n    initialize();\r\n  }, []);\r\n\r\n  async function initialize() {\r\n    await loadData();\r\n    setInitialized(true); // <-- this change seems to trigger the `act` warning, but I can't wrap it in an act...\r\n  }\r\n\r\n  return <span>{initialized ? 'loaded' : 'loading...'}</span>;\r\n}\r\n\r\n// And this is the test for the above component\r\n\r\n  beforeEach(() => {\r\n    container = document.createElement('div');\r\n    document.body.appendChild(container);\r\n  });\r\n\r\n  afterEach(() => {\r\n    document.body.removeChild(container);\r\n    container = null;\r\n  });\r\n\r\n  test('act works in this case', () => {\r\n    act(() => {\r\n      ReactDOM.render(<TestComponent />, container);\r\n    });\r\n  });\r\n```\r\n\r\n**What is the expected behavior?**\r\n\r\nThe render is happening within the act, but I'm assuming the `setInitialized` is probably being fired async after the `act` exits.\r\n\r\nI'm not entirely sure how to handle this case, since I can't put an `act` inside the component being tested. Any recommendations or guidance would be much appreciated.\r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\n    \"react\": \"16.8.6\",\r\n    \"react-dom\": \"16.8.6\",\r\n    \"jest\": \"24.7.1\",",
  "closed_by": {
    "login": "threepointone",
    "id": 18808,
    "node_id": "MDQ6VXNlcjE4ODA4",
    "avatar_url": "https://avatars2.githubusercontent.com/u/18808?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/threepointone",
    "html_url": "https://github.com/threepointone",
    "followers_url": "https://api.github.com/users/threepointone/followers",
    "following_url": "https://api.github.com/users/threepointone/following{/other_user}",
    "gists_url": "https://api.github.com/users/threepointone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/threepointone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/threepointone/subscriptions",
    "organizations_url": "https://api.github.com/users/threepointone/orgs",
    "repos_url": "https://api.github.com/users/threepointone/repos",
    "events_url": "https://api.github.com/users/threepointone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/threepointone/received_events",
    "type": "User",
    "site_admin": false
  }
}

{
  "url": "https://api.github.com/repos/facebook/react/issues/9376",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/9376/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/9376/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/9376/events",
  "html_url": "https://github.com/facebook/react/pull/9376",
  "id": 220387051,
  "node_id": "MDExOlB1bGxSZXF1ZXN0MTE0OTM4MTI5",
  "number": 9376,
  "title": "Check displayName when comparing trees in test utils",
  "user": {
    "login": "vitalets",
    "id": 1473072,
    "node_id": "MDQ6VXNlcjE0NzMwNzI=",
    "avatar_url": "https://avatars3.githubusercontent.com/u/1473072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vitalets",
    "html_url": "https://github.com/vitalets",
    "followers_url": "https://api.github.com/users/vitalets/followers",
    "following_url": "https://api.github.com/users/vitalets/following{/other_user}",
    "gists_url": "https://api.github.com/users/vitalets/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vitalets/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vitalets/subscriptions",
    "organizations_url": "https://api.github.com/users/vitalets/orgs",
    "repos_url": "https://api.github.com/users/vitalets/repos",
    "events_url": "https://api.github.com/users/vitalets/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vitalets/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 196858374,
      "node_id": "MDU6TGFiZWwxOTY4NTgzNzQ=",
      "url": "https://api.github.com/repos/facebook/react/labels/CLA%20Signed",
      "name": "CLA Signed",
      "color": "e7e7e7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2017-04-08T09:06:04Z",
  "updated_at": "2017-04-13T18:09:20Z",
  "closed_at": "2017-04-13T16:27:10Z",
  "author_association": "CONTRIBUTOR",
  "pull_request": {
    "url": "https://api.github.com/repos/facebook/react/pulls/9376",
    "html_url": "https://github.com/facebook/react/pull/9376",
    "diff_url": "https://github.com/facebook/react/pull/9376.diff",
    "patch_url": "https://github.com/facebook/react/pull/9376.patch"
  },
  "body": "The core reason of this change is that [src/test/ReactComponentTreeTestUtils.js][1] does not check `displayName` when comparing two component trees. It means that some tests are irrelevant. For example, I can change [this line][2] from `\"Unknown\"` to `\"blablabla\"` and test will pass.\r\n\r\nWhen I added check of `displayName` and runned tests I found two other problems:\r\n\r\n* **Problem 1**  \r\n   In several tests we [clear component name][3] as:\r\n   ```js\r\n   delete Qux.name;\r\n   ```\r\n   But for derived class this does not work as expected. Instead `Qux.name` returns the name of parent class. Example:\r\n   ```js\r\n   class B {}\r\n   class A extends B {}\r\n   console.log(A.name) // \"A\"\r\n   delete A.name\r\n   console.log(A.name) // \"B\"\r\n   ```\r\n   To fix it I replaced `delete Qux.name` with:\r\n   ```js\r\n   Object.defineProperty(Qux, 'name', {value: null});\r\n   ```\r\n\r\n* **Problem 2**  \r\n  Getting `displayName` of zero component is invalid. It is tested [here][4] but actually test does not check display name:\r\n   ```js\r\n    it('reports a zero as a child', () => {\r\n      var element = <div>{0}</div>;\r\n      var tree = {\r\n        displayName: 'div',\r\n        element,\r\n        children: [\r\n          {\r\n            displayName: '#text', // can be changed to 'blablabla'!\r\n            text: '0',\r\n          },\r\n        ],\r\n      };\r\n      assertTreeMatches([element, tree]);\r\n    });\r\n   ```\r\n   This is because element is [treated as boolean][5] in `getDisplayName()`:\r\n   ```js\r\n    var element = ReactComponentTreeHook.getElement(id);\r\n    if (!element) {  // breaks for element = 0\r\n      return null;\r\n    }\r\n    return getDisplayName(element);\r\n   ```\r\n   It makes `getDisplayName()` a bit inconsistent:\r\n   ```js \r\n   <div>{0}</div> // returns null\r\n   <div>{1}</div> // returns '#empty'\r\n   ```\r\n   I fixed it by removing this check totally. I seems better to always return `string` from `getDisplayName()`.\r\n\r\n[1]: https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/test/ReactComponentTreeTestUtils.js#L28\r\n\r\n[2]: https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/renderers/__tests__/ReactComponentTreeHook-test.js#L281\r\n\r\n[3]: https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/renderers/__tests__/ReactComponentTreeHook-test.js#L354\r\n\r\n[4]: https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/renderers/__tests__/ReactComponentTreeHook-test.js#L648\r\n\r\n[5]: https://github.com/facebook/react/blob/72196da82915bee400edb1599d4223926aa2a8a0/src/isomorphic/hooks/ReactComponentTreeHook.js#L361",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}

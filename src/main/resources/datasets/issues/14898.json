{
  "url": "https://api.github.com/repos/facebook/react/issues/14898",
  "repository_url": "https://api.github.com/repos/facebook/react",
  "labels_url": "https://api.github.com/repos/facebook/react/issues/14898/labels{/name}",
  "comments_url": "https://api.github.com/repos/facebook/react/issues/14898/comments",
  "events_url": "https://api.github.com/repos/facebook/react/issues/14898/events",
  "html_url": "https://github.com/facebook/react/issues/14898",
  "id": 412500474,
  "node_id": "MDU6SXNzdWU0MTI1MDA0NzQ=",
  "number": 14898,
  "title": "Hooks error on bundle SSR, but works fine on client",
  "user": {
    "login": "vemundeldegard",
    "id": 36489034,
    "node_id": "MDQ6VXNlcjM2NDg5MDM0",
    "avatar_url": "https://avatars0.githubusercontent.com/u/36489034?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vemundeldegard",
    "html_url": "https://github.com/vemundeldegard",
    "followers_url": "https://api.github.com/users/vemundeldegard/followers",
    "following_url": "https://api.github.com/users/vemundeldegard/following{/other_user}",
    "gists_url": "https://api.github.com/users/vemundeldegard/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vemundeldegard/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vemundeldegard/subscriptions",
    "organizations_url": "https://api.github.com/users/vemundeldegard/orgs",
    "repos_url": "https://api.github.com/users/vemundeldegard/repos",
    "events_url": "https://api.github.com/users/vemundeldegard/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vemundeldegard/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 620368407,
      "node_id": "MDU6TGFiZWw2MjAzNjg0MDc=",
      "url": "https://api.github.com/repos/facebook/react/labels/Resolution:%20Needs%20More%20Information",
      "name": "Resolution: Needs More Information",
      "color": "fffde7",
      "default": false
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-02-20T15:58:48Z",
  "updated_at": "2019-05-02T07:49:59Z",
  "closed_at": "2019-02-26T14:38:52Z",
  "author_association": "NONE",
  "body": "<!--\r\n  Note: if the issue is about documentation or the website, please file it at:\r\n  https://github.com/reactjs/reactjs.org/issues/new\r\n-->\r\n\r\n**Do you want to request a *feature* or report a *bug*?**\r\n\r\nBug\r\n\r\n**What is the current behavior?**\r\n\r\nFirst i run `npm run build` in /client, then I start the server in another window by going to /server and run `npm start`. When I go to a page that uses hooks (http://localhost:3000/para), I get an error. See below. \r\n\r\nInterestingly it works fine when I use class components and good old state (http://localhost:3000/dyna).  When I run` npm start` on the client side, both state and hooks work fine. But it does not work from static markup. \r\n\r\nSmall piece of the simple hooks page:\r\n\r\n```\r\nconst ParaPage = () => {\r\n\r\n  const [pages, setPages] = useState(null);\r\n\r\n  Sanity.fetch(`\r\n  *[_type == \"sider\" && hidden == false]{\r\n      _id,\r\n      name,\r\n      path,\r\n  } | order(_createdAt asc)\r\n  `)\r\n    .then(res => {\r\n      setPages(res)\r\n    })\r\n    .catch(err => {\r\n      setPages(err)\r\n    })\r\n\r\n}\r\n```\r\n\r\n> (node:1551) UnhandledPromiseRejectionWarning: Invariant Violation: Hooks can only be called inside the body of a function component. (https://fb.me/react-invalid-hook-call)\r\n>     at invariant (/Users/vemundeldegard/siste/client/node_modules/react/cjs/react.development.js:88:15)\r\n>     at resolveDispatcher (/Users/vemundeldegard/siste/client/node_modules/react/cjs/react.development.js:1436:28)\r\n>     at useState (/Users/vemundeldegard/siste/client/node_modules/react/cjs/react.development.js:1461:20)\r\n>     at ParaPage (/Users/vemundeldegard/siste/client/lib/ParaPage.js:21:39)\r\n>     at processChild (/Users/vemundeldegard/siste/server/node_modules/react-dom/cjs/react-dom-server.node.development.js:2871:14)\r\n>     at resolve (/Users/vemundeldegard/siste/server/node_modules/react-dom/cjs/react-dom-server.node.development.js:2795:5)\r\n>     at ReactDOMServerRenderer.render (/Users/vemundeldegard/siste/server/node_modules/react-dom/cjs/react-dom-server.node.development.js:3175:22)\r\n>     at ReactDOMServerRenderer.read (/Users/vemundeldegard/siste/server/node_modules/react-dom/cjs/react-dom-server.node.development.js:3134:29)\r\n>     at renderToString (/Users/vemundeldegard/siste/server/node_modules/react-dom/cjs/react-dom-server.node.development.js:3619:27)\r\n>     at /Users/vemundeldegard/siste/server/lib/react-renderer.js:64:15\r\n> (node:1551) UnhandledPromiseRejectionWarning: Unhandled promise rejection. This error originated either by throwing inside of an async function without a catch block, or by rejecting a promise which was not handled with .catch(). (rejection id: 4)\r\n> \r\n> \r\n\r\n**If the current behavior is a bug, please provide the steps to reproduce and if possible a minimal demo of the problem. Your bug will get fixed much faster if we can run your code and it doesn't have dependencies other than React. Paste the link to your JSFiddle (https://jsfiddle.net/Luktwrdm/) or CodeSandbox (https://codesandbox.io/s/new) example below:**\r\n\r\nSee repo here: https://github.com/vemundeldegard/ssr-hooks\r\n\r\n**What is the expected behavior?**\r\n\r\nTo render the hooks just as good as state. \r\n\r\n**Which versions of React, and which browser / OS are affected by this issue? Did this work in previous versions of React?**\r\n\r\nRunning React 16.8.2 on Mac OS 10.14\r\n",
  "closed_by": {
    "login": "gaearon",
    "id": 810438,
    "node_id": "MDQ6VXNlcjgxMDQzOA==",
    "avatar_url": "https://avatars0.githubusercontent.com/u/810438?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gaearon",
    "html_url": "https://github.com/gaearon",
    "followers_url": "https://api.github.com/users/gaearon/followers",
    "following_url": "https://api.github.com/users/gaearon/following{/other_user}",
    "gists_url": "https://api.github.com/users/gaearon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gaearon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gaearon/subscriptions",
    "organizations_url": "https://api.github.com/users/gaearon/orgs",
    "repos_url": "https://api.github.com/users/gaearon/repos",
    "events_url": "https://api.github.com/users/gaearon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gaearon/received_events",
    "type": "User",
    "site_admin": false
  }
}
